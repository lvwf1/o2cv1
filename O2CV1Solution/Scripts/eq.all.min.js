if (!window.JSON) {
	window.JSON = {
		stringify: function(e) {
			var d = typeof(e);
			if (d != "object" || e === null) {
				if (d == "string") {
					e = '"' + e + '"'
				}
				return String(e)
			} else {
				var f, b, c = [],
					a = (e && e.constructor == Array);
				for (f in e) {
					b = e[f];
					d = typeof(b);
					if (d == "string") {
						b = '"' + b + '"'
					} else {
						if (d == "object" && b !== null) {
							b = JSON.stringify(b)
						}
					}
					c.push((a ? "" : '"' + f + '":') + String(b))
				}
				return (a ? "[" : "{") + String(c) + (a ? "]" : "}")
			}
		},
		parse: function(str) {
			if (str === "") {
				str = '""'
			}
			eval("var p=" + str + ";");
			return p
		}
	}
}(function() {
	var e = 10700;
	var d = 10900;
	var a;
	var a = (typeof(jQuery) !== "undefined");
	if (a) {
		var b = jQuery.fn.jquery.split(".");
		var c = (10000 * parseInt(b[0])) + (100 * parseInt(b[1])) + parseInt(b[2] || 0);
		a = c >= e
	}
	if (!a) {
		alert("jQuery is not loaded or has wrong version.");
		return false
	}
	a = (jQuery.ui && jQuery.ui.version) ? true : false;
	if (a) {
		var b = jQuery.ui.version.split(".");
		var c = (10000 * parseInt(b[0])) + (100 * parseInt(b[1])) + parseInt(b[2] || 0);
		a = c >= d
	}
	if (!a) {
		alert("jQuery.UI is not loaded or has wrong version.");
		return false
	}
	return true
})();
(function(d, c) {
	var b = c.EQ = c.EQ || {};
	var a = {
		Locale: "en",
		AltMenuAttribute: "Attribute",
		AltMenuConstantExpression: "Constant expression",
		ButtonApply: "Apply",
		ButtonCancel: "Cancel",
		ButtonOK: "OK",
		ButtonClear: "Clear",
		ButtonEnable: "Toggle enable",
		ButtonDelete: "Delete",
		ButtonAddCondition: "Add condition",
		ButtonAddPredicate: "Add group of conditions",
		CmdAddConditionAfter: "Add a new condition after the current row",
		CmdAddConditionInto: "Add a new condition",
		CmdAddPredicateAfter: "Open a bracket after the current row",
		CmdAddPredicateInto: "Open a bracket",
		CmdClickToAddCondition: "[Add new condition]",
		CmdDeleteRow: "Delete this row",
		ErrIncorrectPredicateTitleFormat: "Incorrect predicate title format",
		ErrNotNumber: " is not a number",
		ErrIncorrectInteger: "Incorrect integer value",
		ErrIncorrectNumberList: "Incorrect list format",
		False: "False",
		LinkTypeAll: "all",
		LinkTypeAny: "any",
		LinkTypeNone: "none",
		LinkTypeNotAll: "not all",
		ConjAll: "and",
		ConjAny: "or",
		ConjNotAll: "and",
		ConjNone: "or",
		MsgApplySelection: "[Apply selection]",
		MsgAs: "as",
		MsgEmptyList: "(empty list)",
		MsgEmptyListValue: "[select value]",
		MsgEmptyScalarValue: "[enter value]",
		MsgSubQueryValue: "[edit sub-query]",
		MsgEmptyAttrValue: "[select attribute]",
		MsgOf: "of",
		PredicateTitle: "{lt} of the following apply",
		RootPredicateTitle: "Select records where {lt} of the following apply",
		StrAddConditions: "Add conditions",
		SubQueryDialogTitle: "Edit sub-query",
		SubQueryColumnTitle: "Column:",
		SubQueryEmptyColumn: "[select column]",
		SubQueryQueryPanelCaption: "Conditions",
		True: "True",
		ButtonSorting: "Sorting",
		ButtonToAggr: "Change to aggregate column",
		ButtonToSimple: "Change to simple column",
		CmdAscending: "Ascending",
		CmdClickToAddColumn: "[Add new column]",
		CmdDeleteColumn: "Delete column",
		CmdDeleteSorting: "Delete sorting",
		CmdDescending: "Descending",
		CmdGroupSort: "Sorting",
		CmdNotSorted: "Not sorted",
		ColTypeAggrFunc: "Aggregate function",
		ColTypeCompound: "Calculated",
		ColTypeGroup: "Column type",
		ColTypeSimple: "Simple column",
		HeaderExpression: "Expression",
		HeaderSorting: "Sorting",
		HeaderTitle: "Title",
		SortHeaderColumn: "Column",
		SortHeaderSorting: "Sorting",
		StrAddColumns: "Add columns",
		CmdMoveToStart: "Move to start",
		CmdMoveRight: "Move right",
		CmdMoveLeft: "Move left",
		CmdMoveToEnd: "Move to the end",
		ButtonMenu: "Show menu",
		CmdToSimple: "Not aggregated",
		CmdMoveToFirst: "Move to the first",
		CmdMoveToPrev: "Move to the previous",
		CmdMoveToNext: "Move to the next",
		CmdMoveToLast: "Move to the last",
		StrNoFilterDefined: "No filter defined",
		StrNoFilterClickToAdd: "No filter defined. Click to add a new condition",
		Today: "Today",
		Yesterday: "Yesterday",
		Tomorrow: "Tomorrow",
		FirstDayOfMonth: "First day of the month",
		LastDayOfMonth: "Last day of the month",
		FirstDayOfWeek: "First day of the week",
		FirstDayOfYear: "First day of the year",
		FirstDayOfNextWeek: "First day of the next week",
		FirstDayOfNextMonth: "First day of the next month",
		FirstDayOfNextYear: "First day of the next week",
		Now: "Now",
		HourStart: "This hour start",
		Midnight: "Midnight",
		Noon: "Noon"
	};
	b.core = {
		texts: {
			Entities: {},
			Attributes: {},
			Operators: {}
		},
		constLists: {
			SpecDateValues: [{
				id: "${Today}",
				key: "Today",
				isDefault: true
			}, {
				id: "${Yesterday}",
				key: "Yesterday"
			}, {
				id: "${Tomorrow}",
				key: "Tomorrow"
			}, {
				id: "${FirstDayOfMonth}",
				key: "FirstDayOfMonth"
			}, {
				id: "${FirstDayOfYear}",
				key: "FirstDayOfYear"
			}],
			SpecTimeValues: [{
				id: "${Now}",
				key: "Now",
				isDefault: true
			}, {
				id: "${HourStart}",
				key: "HourStart"
			}, {
				id: "${Midnight}",
				key: "Midnight"
			}, {
				id: "${Noon}",
				key: "Noon"
			}],
			BooleanValues: [{
				id: "${false}",
				key: "False"
			}, {
				id: "${true}",
				key: "True",
				isDefault: true
			}]
		},
		predicateLinkTypeList: [{
			id: "All",
			key: "LinkTypeAll"
		}, {
			id: "Any",
			key: "LinkTypeAny"
		}, {
			id: "None",
			key: "LinkTypeNone"
		}, {
			id: "NotAll",
			key: "LinkTypeNotAll"
		}],
		_numericTypes: ["Byte", "Word", "Int", "Int32", "Int64", "Float", "Currency"],
		_intTypes: ["Byte", "Word", "Int", "Int32", "Int64"],
		getText: function() {
			var h = b.core.texts;
			var g = "";
			if (arguments) {
				var f = false;
				var j = arguments.length;
				var e;
				for (e = 0; e < j; e++) {
					g = h[arguments[e]];
					if (!g) {
						f = true;
						break
					} else {
						h = g
					}
				}
				if (f) {
					h = a;
					for (e = 0; e < j; e++) {
						g = h[arguments[e]];
						if (!g) {
							break
						} else {
							h = g
						}
					}
				}
			}
			return g
		},
		getShiftToFitWindow: function(g, i) {
			var f = d(c).width();
			var h = g + i;
			var e = 0;
			if (h > f) {
				e = f - h - 10;
				if (g + e < 0) {
					e = 10 - g
				}
			}
			return e
		},
		isNumericType: function(f) {
			var e = d.inArray(f, this._numericTypes);
			return (e >= 0)
		},
		isIntType: function(f) {
			var e = d.inArray(f, this._intTypes);
			return (e >= 0)
		},
		isNumeric: function(e) {
			return d.isNumeric(e)
		},
		areCompatibleDataTypes: function(f, e) {
			return !f || !e || (f == e) || (f == "Date" && e == "DateTime") || (f == "DateTime" && e == "Date")
		},
		combinePath: function(g, f) {
			var e = g;
			if (e != null && e.length > 0) {
				if (e.charAt(e.length - 1) != "/") {
					e += "/"
				}
				e += f
			} else {
				e = f
			}
			return e
		},
		moveArrayItem: function(f, h, e) {
			if (e >= f.length) {
				var g = e - f.length;
				while ((g--) + 1) {
					f.push(undefined)
				}
			}
			f.splice(e, 0, f.splice(h, 1)[0])
		},
		queryChanged: function(f, e) {
			b.client.queryChanged(f, e)
		},
		getEmptyQueryObject: function() {
			var e = {
				root: {
					linkType: "All",
					enabled: true,
					conditions: []
				},
				columns: [],
				justsorted: []
			};
			return e
		},
		parseOperatorFormat: function(f) {
			var g = b.core.getText("Operators", f.id, "displayFormat");
			if (!g) {
				g = f.displayFormat
			}
			var e = [];
			var h = new b.core.FormatParser(g);
			while (h.next()) {
				if (h.token === "operator") {
					e.push({
						type: "operator",
						text: h.tokenText
					})
				} else {
					if (h.token === "expression") {
						e.push({
							type: "expression",
							index: h.exprNum - 1
						})
					} else {
						if (h.token === "text") {
							e.push({
								type: "text",
								text: h.tokenText
							})
						}
					}
				}
			}
			return e
		},
		isPropSet: function(f, e) {
			return f[e] || f[e.toLowerCase()] || f[e.toUpperCase()]
		}
	};
	b.core.FormatParser = function(e) {
		this.start(e)
	};
	b.core.FormatParser.prototype = {
		start: function(e) {
			this.formatStr = e;
			this.pos = 0;
			this.exprNum = 0;
			this.tokenText = ""
		},
		skipSpaces: function() {
			while (this.pos < this.formatStr.length && this.formatStr.charAt(this.pos) === " ") {
				this.pos++
			}
		},
		next: function() {
			this.skipSpaces();
			if (this.pos >= this.formatStr.length) {
				return false
			}
			var g = 0;
			if (this.formatStr.charAt(this.pos) === "{") {
				g = this.formatStr.indexOf("}", this.pos);
				if (g < 0) {
					return false
				}
				this.tokenText = this.formatStr.substring(this.pos, g + 1);
				if (this.tokenText.indexOf("{expr") === 0) {
					this.token = "expression";
					this.exprNum = parseInt(this.tokenText.substring(5, this.tokenText.length))
				}
				this.pos = g + 1
			} else {
				if (this.formatStr.charAt(this.pos) === "[" && this.pos < this.formatStr.length - 1 && this.formatStr.charAt(this.pos + 1) === "[") {
					this.pos += 2;
					g = this.formatStr.indexOf("]]", this.pos);
					this.token = "operator";
					this.tokenText = this.formatStr.substring(this.pos, g);
					this.pos = g + 2
				} else {
					this.token = "text";
					var f = this.formatStr.indexOf("{", this.pos);
					if (f < 0) {
						f = this.formatStr.length
					}
					var e = this.formatStr.indexOf("[[", this.pos);
					if (e < 0) {
						e = this.formatStr.length
					}
					g = Math.min(f, e);
					this.tokenText = d.trim(this.formatStr.substring(this.pos, g));
					this.pos = g
				}
			}
			return true
		}
	};
	b.core.DataModel = function(e) {
		if (e) {
			this.setObject(e)
		} else {
			this.setObject({
				aggrFunctions: [],
				operators: [],
				rootEntity: {}
			})
		}
	};
	b.core.DataModel.prototype = {
		nullAttribute: {
			id: "",
			caption: "{Unrecognized attribute}",
			dataType: "String",
			description: "",
			size: 0,
			operators: [],
			uic: false,
			uir: false,
			uis: false
		},
		nullOperator: {
			id: "",
			caption: "{Unrecognized operator}",
			displayFormat: "{expr1} [[{unrecognized operator}]] {expr2}",
			exprType: "Unknown",
			paramCount: 2,
			valueKind: "Scalar"
		},
		dateMacroList: ["${Today}", "${Yesterday}", "${Tomorrow}", "${FirstDayOfMonth}", "${LastDayOfMonth}", "${FirstDayOfWeek}", "${FirstDayOfYear}", "${FirstDayOfNextWeek}", "${FirstDayOfNextMonth}", "${FirstDayOfNextYear}"],
		timeMacroList: ["${Now}", "${HourStart}", "${Midnight}", "${Noon}"],
		getObject: function() {
			return this.model
		},
		setObject: function(e) {
			if (e) {
				if (typeof e === "string") {
					this.model = JSON.parse(e)
				} else {
					this.model = e
				}
				this.runThroughEntities(function(f) {
					if (f.UIC != undefined && f.uic == undefined) {
						f.uic = f.UIC
					}
					if (f.UIR != undefined && f.uir == undefined) {
						f.uir = f.UIR
					}
					if (f.UIS != undefined && f.uis == undefined) {
						f.uis = f.UIS
					}
				}, function(f) {
					if (f.UIC != undefined && f.uic == undefined) {
						f.uic = f.UIC
					}
					if (f.UIR != undefined && f.uir == undefined) {
						f.uir = f.UIR
					}
					if (f.UIS != undefined && f.uis == undefined) {
						f.uis = f.UIS
					}
				})
			}
		},
		isEmpty: function() {
			return this.model == null
		},
		getId: function() {
			return this.model.id
		},
		getName: function() {
			return this.model.name
		},
		getRootEntity: function() {
			return this.model ? this.model.rootEntity : {}
		},
		getAttributeById: function(f) {
			var e = this.getEntityAttrById(this.getRootEntity(), f);
			if (!e) {
				e = this.nullAttribute
			}
			return e
		},
		checkAttrProperty: function(g, f) {
			var e = (typeof g === "object") ? g : this.getAttributeById(g);
			if (e) {
				if (e[f]) {
					return true
				} else {
					if (e.lookupAttr) {
						g = e.lookupAttr;
						e = this.getAttributeById(g);
						return e && e[f]
					}
				}
			} else {
				return false
			}
		},
		getEntityAttrById: function(f, h) {
			var e;
			if (f.attributes) {
				var g = f.attributes.length;
				for (e = 0; e < g; e++) {
					if (f.attributes[e].id == h) {
						return f.attributes[e]
					}
				}
			}
			if (f.subEntities) {
				var i = f.subEntities.length;
				for (e = 0; e < i; e++) {
					res = this.getEntityAttrById(f.subEntities[e], h);
					if (res) {
						return res
					}
				}
			}
			return null
		},
		getFullEntityPathByAttr: function(f, e) {
			e = e || " ";
			return this.getEntityPathByAttr(this.getRootEntity(), f, e)
		},
		getEntityPathByAttr: function(f, h, n) {
			if (!f) {
				return ""
			}
			n = n || " ";
			var l = "";
			if (f.caption) {
				var i = b.core.getText("Entities", f.caption);
				l = i ? i : f.caption
			}
			var m;
			if (f.attributes) {
				var e = f.attributes.length;
				for (m = 0; m < e; m++) {
					if (f.attributes[m].id == h) {
						return l
					}
				}
			}
			if (f.subEntities) {
				var g = f.subEntities.length;
				for (m = 0; m < g; m++) {
					var k = f.subEntities[m];
					var j = this.getEntityPathByAttr(k, h, n);
					if (j !== "") {
						if (l !== "") {
							j = l + n + j
						}
						return j
					}
				}
			}
			return ""
		},
		getAttributeText: function(f, g) {
			var i = b.core.getText("Attributes", f.id);
			if (!i) {
				i = f.caption
			}
			if (!g) {
				return i
			}
			var e = g.replace(new RegExp("{attr}", "g"), i);
			var h = this.getFullEntityPathByAttr(f.id, ".");
			e = e.replace(new RegExp("{entity}", "g"), h);
			return e
		},
		_listByEntityWithFilter: function(h, m) {
			var o = [];
			var n;
			var l = null;
			if (h.subEntities) {
				var i = h.subEntities.length;
				for (var e = 0; e < i; e++) {
					l = h.subEntities[e];
					if (!m || m(l)) {
						n = b.core.getText("Entities", l.name);
						if (!n) {
							n = l.caption
						}
						var k = {
							id: l.name,
							text: n,
							items: []
						};
						k.items = this._listByEntityWithFilter(l, m);
						if (k.items.length > 0) {
							o.push(k)
						}
					}
				}
			}
			var j = null;
			if (h.attributes) {
				var g = h.attributes.length;
				for (var f = 0; f < g; f++) {
					j = h.attributes[f];
					if (!m || m(j)) {
						n = b.core.getText("Attributes", j.id);
						if (!n) {
							n = j.caption
						}
						o.push({
							id: j.id,
							text: n,
							dataType: j.dataType
						})
					}
				}
			}
			return o
		},
		_listByEntity: function(i, e) {
			var e = e || {};
			var o = [];
			var n;
			var m = null;
			if (i.subEntities) {
				var j = i.subEntities.length;
				for (var f = 0; f < j; f++) {
					m = i.subEntities[f];
					if (e.addUIC !== false && m.uic !== false || e.addUIR !== false && m.uir !== false || e.addUIS !== false && m.uis !== false) {
						n = b.core.getText("Entities", m.name);
						if (!n) {
							n = m.caption
						}
						var l = {
							id: m.name,
							text: n,
							items: []
						};
						l.items = this._listByEntity(m, e);
						o.push(l)
					}
				}
			}
			var k = null;
			if (i.attributes) {
				var h = i.attributes.length;
				for (var g = 0; g < h; g++) {
					k = i.attributes[g];
					if (e.addUIC !== false && k.uic !== false || e.addUIR !== false && k.uir !== false || e.addUIS !== false && k.uis !== false) {
						n = b.core.getText("Attributes", k.id);
						if (!n) {
							n = k.caption
						}
						o.push({
							id: k.id,
							text: n,
							dataType: k.dataType
						})
					}
				}
			}
			return o
		},
		getEntitiesTree: function(e) {
			return this._listByEntity(this.getRootEntity(), e)
		},
		getEntitiesTreeWithFilter: function(e) {
			return this._listByEntityWithFilter(this.getRootEntity(), e)
		},
		_findItemById: function(h, g) {
			var f = h.length;
			for (var e = 0; e < f; e++) {
				if (h[e].id === g) {
					return h[e]
				}
			}
			return null
		},
		getFirstUICAttr: function() {
			return this.getFirstUICAttrInEntity(this.getRootEntity())
		},
		getFirstUICAttrInEntity: function(g) {
			if (g.uic !== false) {
				var f = 0;
				if (g.attributes) {
					var h = g.attributes.length;
					for (f = 0; f < h; f++) {
						if (g.attributes[f].uic) {
							return g.attributes[f]
						}
					}
				}
				if (g.subEntities) {
					var i = g.subEntities.length;
					for (f = 0; f < i; f++) {
						var e = this.getFirstUICAttrInEntity(g.subEntities[f]);
						if (e) {
							return e
						}
					}
				}
			}
			return null
		},
		runThroughEntities: function(e, f) {
			var g = {
				stop: false
			};
			var h = function(k) {
					if (f) {
						f(k, g)
					}
					var j = 0;
					if (k.attributes) {
						var l = k.attributes.length;
						for (j = 0;
						(j < l) && !g.stop; j++) {
							var i = k.attributes[j];
							e(i, g);
							if (g.stop) {
								return
							}
						}
					}
					if (k.subEntities) {
						var m = k.subEntities.length;
						for (j = 0;
						(j < m) && !g.stop; j++) {
							h(k.subEntities[j])
						}
					}
				};
			h(this.getRootEntity())
		},
		getFirstAttributeByFilter: function(f) {
			var e = null;
			this.runThroughEntities(function(g, h) {
				if (f(g)) {
					h.stop = true;
					e = g
				}
			});
			return e
		},
		findOperatorById: function(f) {
			if (this.model.operators) {
				var g = this.model.operators.length;
				for (var e = 0; e < g; e++) {
					if (this.model.operators[e].id == f) {
						return this.model.operators[e]
					}
				}
			}
			return null
		},
		getOperatorById: function(e) {
			var f = this.findOperatorById(e);
			if (!f) {
				f = this.nullOperator
			}
			return f
		},
		getDefaultOperatorIdForAttr: function(e) {
			if (e.defaultOperator) {
				return e.defaultOperator
			} else {
				if (e.operators.length > 0) {
					return e.operators[0]
				} else {
					return this.nullOperator.id
				}
			}
		},
		getDefaultOperatorForAttr: function(e) {
			operatorId = this.getDefaultOperatorIdForAttr(e);
			return this.getOperatorById(operatorId)
		},
		getOperand: function(f, g, h) {
			var e = {
				kind: g && g.defaultOperand ? g.defaultOperand.kind : "Scalar",
				dataType: g && g.defaultOperand ? g.defaultOperand.dataType : "Unknown",
				defValue: g && g.defaultOperand && g.defaultOperand.defValue ? g.defaultOperand.defValue : "",
				editor: g && g.defaultOperand && g.defaultOperand.editor ? d.extend({}, g.defaultOperand.editor) : {
					type: "Unknown"
				}
			};
			if ((!e.dataType || e.dataType === "Unknown") && f) {
				e.dataType = f.dataType
			}
			if (g && (h !== undefined)) {
				if (g.operands && g.operands[h - 1]) {
					d.extend(e, g.operands[h - 1])
				}
			}
			if (!e.editor.type || e.editor.type == "Unknown") {
				if (f && f.defaultEditor) {
					e.editor = d.extend({}, f.defaultEditor)
				}
			}
			if (!e.editor.type || e.editor.type == "Unknown") {
				if (e.dataType) {
					if (e.dataType == "Date" || e.dataType == "DateTime" || e.dataType == "Time") {
						e.editor.type = "DATETIME"
					} else {
						e.editor.type = "EDIT"
					}
				} else {
					e.editor.type = "EDIT"
				}
			}
			return e
		},
		getAggrFunctions: function() {
			return this.model ? this.model.aggrFunctions : []
		},
		getAggrFunctionCaption: function(g) {
			var e = b.core.getText("Aggr" + g.replace(" ", "") + "_Caption");
			if (e) {
				return e
			}
			var f = this._findItemById(this.model.aggrFunctions, g);
			if (!f || !f.caption) {
				return g
			}
			return f.caption
		},
		getAggrFunctionFormat: function(g) {
			var f = b.core.getText("Aggr" + g.replace(" ", "") + "_Format");
			if (f) {
				return f
			}
			var e = this._findItemById(this.model.aggrFunctions, g);
			if (!e || !e.displayFormat) {
				return ""
			}
			return e.displayFormat
		},
		getMacroDateValue: function(f) {
			var g = new Date();
			if (d.inArray(f, this.dateMacroList) >= 0) {
				switch (f) {
				case "${Today}":
					break;
				case "${Yesterday}":
					g.setDate(g.getDate() - 1);
					break;
				case "${Tomorrow}":
					g.setDate(g.getDate() + 1);
					break;
				case "${FirstDayOfMonth}":
					g.setDate(1);
					break;
				case "${LastDayOfMonth}":
					g.setMonth(g.getMonth() + 1, 0);
					break;
				case "${FirstDayOfWeek}":
					var e = g.getDay();
					e = (e == 0) ? 6 : e - 1;
					g.setDate(g.getDate() - e);
					break;
				case "${FirstDayOfYear}":
					g.setMonth(0, 1);
					break;
				case "${FirstDayOfNextWeek}":
					var e = g.getDay();
					e = (e == 0) ? 1 : 8 - e;
					g.setDate(g.getDate() + e);
					break;
				case "${FirstDayOfNextMonth}":
					g.setMonth(g.getMonth() + 1, 1);
					break;
				case "${FirstDayOfNextYear}":
					g.setFullYear(g.getFullYear() + 1, 0, 1);
					break
				}
				return g
			}
			return null
		},
		getDateOrMacroDateValue: function(e) {
			var f = this.getMacroDateValue(e);
			return f ? f : e
		},
		getMacroTimeValue: function(e) {
			var f = new Date();
			if (d.inArray(e, this.timeMacroList) >= 0) {
				switch (e) {
				case "${Now}":
					break;
				case "${HourStart}":
					f.setMinutes(0, 0, 0);
					break;
				case "${Midnight}":
					f.setHours(0, 0, 0, 0);
					break;
				case "${Noon}":
					f.setHours(12, 0, 0, 0);
					break
				}
				return f
			}
			return null
		},
		getTimeOrMacroTimeValue: function(f) {
			var e = this.getMacroTimeValue(f);
			return e ? e : f
		}
	};
	b.core.Query = function(f, g, e) {
		if (f) {
			this.model = f
		} else {
			this.model = new b.core.DataModel()
		}
		g = g || b.core.getEmptyQueryObject();
		this._listCache = {};
		this._updating = 0;
		e = e || {};
		this.attrClassName = e.attrClassName || "ENTATTR";
		this.clientListRequestHandler = e.clientListRequestHandler;
		this.serverListRequestHandler = e.serverListRequestHandler;
		this._queryChangedCallbacks = d.Callbacks("unique");
		this.setObject(g)
	};
	b.core.Query.prototype = {
		getObject: function() {
			return this.query
		},
		setObject: function(f, e) {
			if (f) {
				if (typeof f === "string") {
					this.query = JSON.parse(f)
				} else {
					this.query = f
				}
				if (!e) {
					this.fireChangedEvent({
						changeType: "query"
					})
				}
			}
		},
		getModel: function() {
			return this.model
		},
		setModel: function(e) {
			this.model = e;
			this.clear()
		},
		loadModelObject: function(e) {
			this.model.setObject(e)
		},
		toJSON: function() {
			var e = this.getModel();
			this.query.modelId = e ? e.getId() : null;
			this.query.modelName = e ? e.getName() : null;
			return JSON.stringify(this.query)
		},
		isEmptyConditions: function() {
			return !this.query.root || !this.query.root.conditions || this.query.root.conditions.length === 0
		},
		isEmptyColumns: function() {
			return !this.query.root || !this.query.root.columns || this.query.root.columns.length === 0
		},
		beginUpdate: function() {
			this._updating++
		},
		endUpdate: function() {
			this._updating--
		},
		isUpdating: function() {
			return this._updating > 0
		},
		clear: function(e) {
			this.beginUpdate();
			try {
				this.clearColumns();
				this.clearConditions()
			} finally {
				this.endUpdate();
				if (!e) {
					this.fireChangedEvent({
						changeType: "clear"
					})
				}
			}
		},
		clearColumns: function() {
			this.query.columns = [];
			this.query.justsorted = [];
			this.fireChangedEvent({
				changeType: "columns.clear"
			})
		},
		clearConditions: function() {
			this.query.root = {
				linkType: "All",
				enabled: true,
				conditions: []
			};
			this.fireChangedEvent({
				changeType: "conditions.clear"
			})
		},
		getId: function() {
			return this.query ? this.query.id : ""
		},
		setId: function(e) {
			if (this.query) {
				this.query.id = e
			}
		},
		getName: function() {
			return this.query ? this.query.name : ""
		},
		setName: function(e) {
			if (this.query) {
				this.query.name = e
			}
		},
		getColumns: function() {
			return this.query ? this.query.columns : []
		},
		addColumn: function(g, e) {
			if (!this.query) {
				return
			}
			var f = this.query.columns;
			if (typeof e == "number") {
				f.splice.apply(f, [e, 0].concat(g))
			} else {
				f.push.apply(f, [].concat(g))
			}
			this.fireChangedEvent({
				changeType: "column.add",
				column: g
			})
		},
		moveColumn: function(h, g) {
			var e = this.getColumns();
			var f = e[h];
			b.core.moveArrayItem(e, h, g);
			this.fireChangedEvent({
				changeType: "column.move",
				column: f
			})
		},
		removeColumn: function(g) {
			var f = this.getColumns();
			var e = d.inArray(g, f);
			if (e >= 0) {
				f.splice(e, 1);
				this.fireChangedEvent({
					changeType: "column.remove",
					column: g
				})
			}
		},
		getRootPredicate: function() {
			return this.query.root
		},
		addSimpleCondition: function(k) {
			var f = k.predicate || this.getRootPredicate();
			var h = this.getModel();
			if (!h) {
				return null
			}
			var j = k.attr;
			var e = h.getAttributeById(j);
			if (!e) {
				return null
			}
			var g = k.operator;
			var l;
			if (!g) {
				l = h.getDefaultOperatorForAttr(e)
			} else {
				l = h.getOperatorById(g)
			}
			if (!l) {
				return null
			}
			var i = this._createSimpleConditionObject(e, l, k.value);
			f.conditions.push(i);
			this.fireChangedEvent({
				changeType: "condition.add",
				condition: i
			});
			return i
		},
		_createValueExpr: function(f, g, i, j) {
			var h = this.getModel();
			var k = h.getOperand(f, g);
			var e = {
				typeName: "CONST",
				dataType: k.dataType,
				kind: k.kind,
				value: j,
				text: j
			};
			return e
		},
		_createSimpleConditionObject: function(e, g, l) {
			var f = this;
			if (!e) {
				return null
			}
			if (!e.uic) {
				return null
			}
			var j = {
				typeName: "SMPL",
				enabled: true,
				operatorID: g.id,
				expressions: [{
					typeName: f.attrClassName,
					id: e.id
				}]
			};
			if (l) {
				if (d.isArray(l)) {
					var k = l.length;
					for (var h = 0; h < k; h++) {
						j.expressions.push(this._createValueExpr(e, g, h + 1, l))
					}
				} else {
					j.expressions.push(this._createValueExpr(e, g, 1, l))
				}
			}
			return j
		},
		_getListFromCache: function(f) {
			var e = f.listName == "SQL" ? "SQL_" + f.sql : f.listName;
			return this._listCache[e]
		},
		_addListToCache: function(g, f) {
			var e = g.listName == "SQL" ? "SQL_" + g.sql : g.listName;
			this._listCache[e] = f
		},
		resetListCache: function() {
			this._listCache = {}
		},
		getListRequestHandler: function() {
			var e = this;
			var f = function(k, h) {
					if (k == null || !k.listName) {
						return
					}
					var g = k.listName.match(/{{(.+?)}}/);
					if (g) {
						var j = e.getOneValueForAttr(g[1]);
						if (!j) {
							j = ""
						}
						k.listName = k.listName.replace(/{{.+?}}/, j)
					}
					var i = e._getListFromCache(k);
					if (i && i.length > 0) {
						h(i);
						return
					}
					var l = false;
					if (e.clientListRequestHandler) {
						l = e.clientListRequestHandler(k, h)
					}
					if (!l && e.serverListRequestHandler) {
						l = e.serverListRequestHandler(k, function(m) {
							if (m) {
								e._addListToCache(k, m)
							}
							h(m)
						})
					}
				};
			return f
		},
		addChangedCallback: function(e) {
			if (!e) {
				return
			}
			this._queryChangedCallbacks.add(e)
		},
		removeChangedCallback: function(e) {
			if (!e) {
				return
			}
			this._queryChangedCallbacks.remove(e)
		},
		fireChangedEvent: function(e) {
			if (!this.isUpdating()) {
				e = e || {};
				e.query = this;
				this._queryChangedCallbacks.fire(e)
			}
		},
		runThroughConditions: function(e) {
			var f = function(g) {
					var h;
					for (h = 0; h < g.conditions.length; h++) {
						var j = g.conditions[h];
						if (j.conditions) {
							f(j)
						} else {
							if (e) {
								e(j)
							}
						}
					}
				};
			f(this.getRootPredicate())
		},
		getOneValueForAttr: function(f) {
			var e = null;
			this.runThroughConditions(function(g) {
				var h = g.expressions[0];
				if (h.id == f && g.expressions[1] && (g.operatorID == "Equal" || g.operatorID == "InList" || g.operatorID == "StartsWith")) {
					e = g.expressions[1].value
				}
			});
			return e
		},
		getConditionsText: function() {
			var f = this.getModel();
			var e = function(w) {
					var x = "",
						q = "Conj" + w.linkType,
						j = b.core.getText(q),
						u, n;
					for (n = 0; n < w.conditions.length; n++) {
						u = "";
						var t = w.conditions[n];
						if (t.enabled || typeof(t.enabled) === "undefined") {
							if (t.conditions) {
								u = e(t);
								if (u) {
									u = "(" + u + ")"
								}
							} else {
								var s = t.operatorID;
								var h = f.getOperatorById(s);
								var l = b.core.parseOperatorFormat(h);
								var k = l.length;
								for (var o = 0; o < k; o++) {
									var g = l[o];
									var m = g.text;
									if (g.type == "expression") {
										var v = t.expressions[g.index];
										if (v.kind == "Attribute" || v.typeName == "ENTATTR") {
											var r = f.getAttributeById(v.id);
											m = f.getAttributeText(r, "{entity} {attr}")
										} else {
											m = v.value
										}
									}
									if (o > 0) {
										u += " "
									}
									u += m
								}
							}
						}
						if (u) {
							if (n > 0 && x) {
								x += " " + j + " "
							}
							x += u
						}
					}
					if (w.linkType == "None" || w.linkType == "NotAll") {
						x = "not ( " + x + " )"
					}
					return x
				};
			return e(this.getRootPredicate())
		}
	}
})(jQuery, window);
(function(f, g) {
	function e() {
		return {
			top: f(window).scrollTop(),
			left: f(window).scrollLeft()
		}
	}
	function h(l, m) {
		var k = {
			x: 0,
			y: 0
		};
		if (l !== null) {
			var j = f(l).offset();
			m = m || document.documentElement || document.body;
			var i = f(m).offset();
			k = {
				x: j.left - i.left,
				y: j.top - i.top
			}
		}
		return k
	}
	function d() {
		var i = f(window);
		return {
			width: i.innerWidth(),
			height: i.innerHeight()
		};
		return res
	}
	var b = null;
	a.prototype = {
		_turnCheckboxes: function(j) {
			var k = j.length;
			var m;
			for (var l = 0; l < k; l++) {
				m = j[l];
				if (m.itemCheckbox) {
					m.itemCheckbox.checked = this._isItemSelected(m)
				}
				if (m.items) {
					this._turnCheckboxes(m.items)
				}
			}
		},
		_isItemSelected: function(k) {
			if (k.items) {
				for (var j = 0; j < k.items.length; j++) {
					if (this._isItemSelected(k.items[j])) {
						return true
					}
				}
				return false
			} else {
				return k.selected
			}
		},
		_setItemSelected: function(k, l) {
			if (k.items) {
				for (var j = 0; j < k.items.length; j++) {
					this._setItemSelected(k.items[j], l)
				}
			} else {
				k.selected = l
			}
		},
		showAt: function(r, o, s) {
			if (!this.items) {
				return
			}
			this.initLevelDiv();
			this._turnCheckboxes(this.items);
			this._renderItems();
			var q = this.levelDiv.style;
			q.left = r + "px";
			q.top = o + "px";
			q.display = "block";
			if (this.searchBox != null) {
				this.searchBox.focus();
				this.searchBox.value = ""
			}
			this.scrollDiv.style.width = "auto";
			this.scrollDiv.style.height = "auto";
			if (s) {
				o = this.adjustTopPos(o);
				q.top = o + "px"
			}
			var k = this.parentMenu.minItemWidth;
			if (k > 0 && this.scrollDiv.offsetWidth < k) {
				for (var m = 0; m < itemsLength; m++) {
					this.items[m].itemDiv.style.width = k + "px"
				}
			}
			var l = this.parentMenu.maxItemWidth;
			if (l > 0 && this.scrollDiv.offsetWidth > l) {
				for (var m = 0; m < itemsLength; m++) {
					this.items[m].itemDiv.style.width = l + "px";
					this.items[m].itemDiv.style.overflowX = "hidden"
				}
			}
			var n = d();
			var t = n.height - (o - e().top) - 15;
			if (this.parentMenu.maxHeight > 0 && t > this.parentMenu.maxHeight) {
				t = this.parentMenu.maxHeight
			}
			if (this.applyItem != null && this.applyItem.itemDiv != null) {
				t -= this.applyItem.itemDiv.offsetHeight + 5
			}
			if (this.searchDiv != null) {
				t -= this.searchDiv.offsetHeight
			}
			if (this.levelDiv.offsetHeight > t) {
				var j = t;
				if (j < 50) {
					j = 50
				}
				this.scrollDiv.style.height = j + "px"
			} else {
				this.scrollDiv.style.height = "auto"
			}
			this.activeItem = null;
			if (this.levelIndex == 0) {
				this._focusScrollDiv()
			}
		},
		_focusScrollDiv: function() {
			f(this.scrollDiv).focus()
		},
		hide: function() {
			if (this.activeItem !== null) {
				if (this.activeItem.subLevel) {
					this.activeItem.subLevel.hide()
				}
			}
			if (this.levelDiv) {
				var i = this.levelDiv.style;
				i.display = "none";
				if (this.initialized) {
					this.parentElement.removeChild(this.levelDiv);
					this.initialized = false
				}
			}
		},
		adjustTopPos: function(l) {
			var j = d();
			var k = l;
			var i = l - e().top + this.levelDiv.offsetHeight;
			if (i > j.height - 5) {
				k -= i - j.height + 5;
				if (k < e().top) {
					k = e().top + 10
				}
			}
			return k
		},
		initLevelDiv: function() {
			if (!this.initialized) {
				this.parentElement.appendChild(this.levelDiv);
				f(this.levelDiv).addClass("eqjs-menu-levelDiv");
				this.initialized = true
			}
		},
		activateItem: function(l) {
			if (this.activeItem != null) {
				this.deactivateItem(this.activeItem)
			}
			this.activeItem = l;
			var m = l.itemDiv;
			f(m).addClass("active");
			if (this.parentMenu.options.useDefaultStyles) {
				var o = this.parentMenu.style.colors.bgON;
				var q = this.parentMenu.style.colors.fgON;
				var i = this.parentMenu.style.colors.bgOVER;
				var k = this.parentMenu.style.colors.fgOVER || "";
				var n = this.parentMenu.style.itemClass || "";
				var j = this.parentMenu.style.itemClassOver || "";
				if (j != "") {
					m.style.backgroundColor = "";
					m.style.color = ""
				} else {
					m.style.backgroundColor = i;
					m.style.color = k
				}
			}
			if (l.items) {
				this.showSubLevel(l)
			}
		},
		deactivateItem: function(i) {
			var j = i.itemDiv;
			f(j).removeClass("active");
			if (this.parentMenu.options.useDefaultStyles) {
				var l = this.parentMenu.style.colors.bgON;
				var m = this.parentMenu.style.colors.fgON;
				var k = this.parentMenu.style.itemClass || "";
				if (k != "") {
					j.style.backgroundColor = "";
					j.style.color = ""
				} else {
					j.style.backgroundColor = l;
					j.style.color = m
				}
			}
			if (i.subLevel) {
				i.subLevel.hide()
			}
			this.activeItem = null
		},
		_submitItems: function(i, m) {
			var l = i.length;
			for (var k = 0; k < l; k++) {
				if (i[k].items) {
					this._submitItems(i[k].items, m)
				} else {
					if (i[k].selected) {
						m.push(i[k])
					}
				}
			}
		},
		submit: function(i) {
			if (i != null) {
				if (i.items) {} else {
					this.parentMenu.hideMenu();
					var j = [];
					if (i == this.applyItem) {
						this._submitItems(this.items, j)
					}
					this.parentMenu.submitMenu(i, j)
				}
			}
		},
		showSubLevel: function(m) {
			if (!m.subLevel) {
				m.subLevel = new a({
					menu: this.parentMenu,
					parent: this,
					container: this.parentElement,
					items: m.items,
					levelIndex: this.levelIndex + 1
				})
			}
			var o = h(m.itemDiv, this.parentElement);
			var j = e();
			var k = d();
			var n = o.x - j.left;
			var i = k.width - n - m.itemDiv.offsetWidth;
			var l = o.x;
			o.x += m.itemDiv.offsetWidth - 2;
			o.y += 1;
			m.subLevel.showAt(o.x, o.y, true);
			m.subLevel.levelDiv.style.width = "";
			m.subLevel.levelDiv.style.right = "";
			if ((i >= m.subLevel.levelDiv.offsetWidth) || (i >= n)) {
				if (i < m.subLevel.levelDiv.offsetWidth) {
					m.subLevel.levelDiv.style.right = -j.left + "px"
				}
			} else {
				if (n < m.subLevel.levelDiv.offsetWidth) {
					m.subLevel.levelDiv.style.left = j.left + 4 + "px"
				} else {
					m.subLevel.levelDiv.style.left = ""
				}
				m.subLevel.levelDiv.style.right = f(window).width() - o.x + m.itemDiv.offsetWidth - 6 + "px"
			}
		},
		refreshItems: function() {
			var j = this.items.length;
			for (var k = 0; k < j; k++) {
				var l = this.items[k];
				if (l.itemDiv) {
					if (l.hidden) {
						l.itemDiv.style.display = "none"
					} else {
						l.itemDiv.style.display = "block"
					}
				}
				if (l.subLevel) {
					l.subLevel.refreshItems()
				}
			}
		},
		refreshCheckboxes: function() {
			var j = this.items.length;
			for (var k = 0; k < j; k++) {
				var l = this.items[k];
				if (l.itemCheckbox) {
					l.itemCheckbox.checked = this._isItemSelected(l)
				}
				if (l.subLevel) {
					l.subLevel.refreshCheckboxes()
				}
			}
		},
		renderContent: function() {
			if (!this.items) {
				return
			}
			var z = this;
			var v = this.parentMenu.style.colors.bgON || "white";
			var i = this.parentMenu.style.colors.fgON || "black";
			var y = this.parentMenu.style.colors.bgOVER || "LightSteelBlue";
			var m = this.parentMenu.style.itemStyle.fontFamily || "";
			var x = this.parentMenu.style.itemStyle.fontSize || "14px";
			var k = this.parentMenu.options.multiselect;
			var s = document.createElement("div");
			if (this.parentMenu.options.useDefaultStyles) {
				s.style.backgroundColor = v;
				s.style.border = "1px solid";
				s.style.borderColor = this.parentMenu.style.colors.border;
				s.style.margin = "-2px 2px 2px -2px";
				s.style.width = "auto";
				s.style.height = "auto"
			}
			s.style.zIndex = this.parentMenu.zIndex;
			s.style.position = "absolute";
			s.style.display = "none";
			s.menuLevel = this;
			var t = this.parentMenu;
			var r = this.applyItem;
			if (k && this.levelIndex === 0) {
				var w = document.createElement("div");
				this.applyBtn = document.createElement("button");
				f(w).addClass("eqjs-menu-applyDiv");
				w.menuItem = r;
				if (this.parentMenu.options.useDefaultStyles) {
					w.style.borderBottom = "1px solid";
					w.style.padding = "5px";
					w.style.marginBottom = "5px";
					this.applyBtn.style.padding = "0 5px";
					this.applyBtn.style.cursor = "pointer"
				}
				var q = document.createTextNode(this.parentMenu.options.buttons.submit);
				this.applyBtn.appendChild(q);
				w.appendChild(this.applyBtn);
				var u = document.createElement("button");
				f(u).addClass("eqjs-menu-cancel");
				if (this.parentMenu.options.useDefaultStyles) {
					u.style.padding = "0 5px";
					u.style.cursor = "pointer";
					u.style.marginLeft = "15px"
				}
				var l = document.createTextNode(this.parentMenu.options.buttons.cancel);
				u.appendChild(l);
				w.appendChild(u);
				s.appendChild(w);
				r.itemDiv = w;
				f(this.applyBtn).click(function() {
					z.submit(z.applyItem)
				});
				f(u).click(function() {
					z.parentMenu.hideMenu()
				})
			}
			if (z.items.length >= t.options.showSearchBoxAfter) {
				var o = document.createElement("div");
				f(o).addClass("eqjs-menu-searchDiv");
				if (this.parentMenu.options.useDefaultStyles) {
					o.style.borderBottom = "1px solid #666";
					o.style.backgroundColor = v;
					o.style.borderColor = this.parentMenu.style.colors.border;
					if (m != "") {
						o.style.fontFamily = m
					}
					o.style.fontSize = x;
					o.style.color = i;
					o.style.cursor = "pointer";
					o.style.textAlign = "left";
					o.style.padding = "5px"
				}
				var j = document.createElement("input");
				j.name = "searchBox";
				j.id = "searchBox";
				z.searchBox = j;
				z.searchDiv = o;
				j.type = "text";
				j.size = "16";
				if (this.parentMenu.options.useDefaultStyles) {
					j.style.fontFamily = "monospace";
					j.style.fontSize = "8pt";
					j.style.width = "100%"
				}
				o.appendChild(j);
				s.appendChild(o);
				f(j).on("input", function() {
					z._renderItems(f(this).val())
				})
			}
			var n = document.createElement("div");
			f(n).prop("tabindex", 1);
			f(n).addClass("eqjs-menu-scrollDiv");
			n.style.overflowX = "hidden";
			n.style.overflowY = "auto";
			n.style.position = "relative";
			s.appendChild(n);
			this.levelDiv = s;
			this.scrollDiv = n;
			this._renderItems();
			f(n).on("keydown", function(B) {
				switch (B.which) {
				case 13:
					if (z.parentMenu.options.multiselect) {
						z.parentMenu._rootLevel.applyBtn.click()
					} else {
						if (z.activeItem) {
							f(z.activeItem.itemDiv).click()
						}
					}
					break;
				case 32:
					if (z.activeItem) {
						f(z.activeItem.itemDiv).trigger("click", [true])
					}
					break;
				case 37:
					if (z.parentLevel) {
						z.deactivateItem(z.activeItem);
						z.parentLevel._focusScrollDiv()
					}
					break;
				case 38:
					if (z.activeItem) {
						var A = f.inArray(z.activeItem, z.items);
						if (A > 0) {
							z.activateItem(z.items[A - 1])
						}
					} else {
						z.activateItem(z.items[z.items.length - 1])
					}
					break;
				case 39:
					if (z.activeItem && z.activeItem.subLevel) {
						z.activeItem.subLevel._focusScrollDiv();
						z.activeItem.subLevel.activateItem(z.activeItem.subLevel.items[0])
					}
					break;
				case 40:
					if (z.activeItem) {
						var A = f.inArray(z.activeItem, z.items);
						if (A < z.items.length - 1) {
							z.activateItem(z.items[A + 1])
						}
					} else {
						z.activateItem(z.items[0])
					}
					break;
				default:
					return
				}
				B.preventDefault()
			})
		},
		_allSubitemsAreFiltered: function(k, m) {
			var j = k.length;
			for (var l = 0; l < j; l++) {
				if (m(k[l])) {
					return false
				}
			}
			return true
		},
		_renderItems: function(r) {
			var x = this;
			var k = this.scrollDiv;
			var t = this.parentMenu.options.multiselect;
			var B = this.parentMenu.options.activateOnMouseOver;
			var n = this.parentMenu.style.colors.fgON || "black";
			var j = this.parentMenu.style.colors.bgOVER || "LightSteelBlue";
			var l = this.parentMenu.style.itemStyle.fontSize || "14px";
			var v = this.parentMenu._itemFilterCallback;
			f(k).empty();
			var m = r ? new RegExp(r, "i") : null;
			var A;
			var C = this.items.length;
			for (A = 0; A < C; A++) {
				var D = this.items[A];
				if (!D || !D.text) {
					continue
				}
				if (v) {
					if (!v(D)) {
						continue
					}
					if (D.items && x._allSubitemsAreFiltered(D.items, v)) {
						continue
					}
				}
				var w = m ? D.text.search(m) : 0;
				if (w < 0) {
					continue
				}
				D.data = function(i) {
					return this[i]
				};
				if (typeof(D.selected) == "undefined") {
					D.selected = false
				}
				if (D.selected && this.selectedItem == null) {
					this.selectedItem = D
				}
				var q = document.createElement("div");
				f(q).addClass("eqjs-menu-itemDiv");
				k.appendChild(q);
				q.menuItem = D;
				D.itemDiv = q;
				if (this.parentMenu.options.useDefaultStyles) {
					q.style.fontSize = l;
					q.style.color = n;
					q.style.paddingLeft = "15px";
					q.style.paddingRight = "6px";
					q.style.cursor = "pointer"
				}
				if (D.text == "---") {
					q.appendChild(document.createElement("hr"))
				} else {
					if (t) {
						var y = document.createElement("input");
						y.type = "checkbox";
						y.id = "cb" + D.id;
						y.checked = this._isItemSelected(D);
						y.defaultChecked = this._isItemSelected(D);
						q.appendChild(y);
						D.itemCheckbox = y;
						if (this.parentMenu.options.useDefaultStyles) {
							y.style.margin = "4px 10px 0 0";
							y.style.verticalAlign = "top"
						}
					} else {
						if (D.selected) {}
					}
					var o = document.createTextNode(D.text);
					q.appendChild(o);
					var E = f(q);
					if (D.items && D.items.length > 0) {
						E.addClass("eqjs-menu-itemDiv-hasChildren");
						var z = document.createElement("span");
						f(z).addClass("eqjs-menu-itemDiv-arrow");
						q.appendChild(z);
						var u = document.createTextNode(">");
						z.appendChild(u)
					}
					var s = function(F, H) {
							var i = this.menuItem;
							if (t) {
								if (!i.items || F.target == i.itemCheckbox || H) {
									var G = x._isItemSelected(i);
									x._setItemSelected(i, !G);
									i.itemCheckbox.checked = !G;
									x.parentMenu.refreshCheckboxes()
								} else {
									x.activateItem(i)
								}
							} else {
								x.activateItem(i);
								x.submit(i)
							}
						};
					E.off("click", s);
					E.on("click", s);
					f(q).mouseenter(function() {
						var i = this.menuItem;
						if (B) {
							x.activateItem(i)
						}
					});
					f(q).mouseleave(function() {
						var i = this.menuItem;
						if (i == x.activeItem && B && !i.subLevel) {
							x.deactivateItem(i)
						}
					})
				}
			}
		},
		remove: function() {
			var k = this.items.length;
			for (var l = 0; l < k; l++) {
				var m = this.items[l];
				if (m.subLevel) {
					m.subLevel.remove()
				}
			}
			if (this.levelDiv) {
				this.levelDiv.innerHtml = "";
				var j = this.levelDiv.parentNode;
				if (j != null) {
					j.removeChild(this.levelDiv)
				}
			}
			this.levelDiv = null
		},
		update: function(i) {
			this.remove();
			this.items = i;
			this.activeItem = null;
			this.selectedItem = null;
			this.applyItem.itemDiv = null;
			this.initialized = false;
			this.updated++;
			this.renderContent()
		},
		findItem: function(k) {
			var j = k.toLowerCase();
			var l = this.items.length;
			for (var m = 0; m < l; m++) {
				var n = this.items[m];
				if (n.text.toLowerCase().indexOf(j) == 0) {
					return n
				}
			}
			return null
		}
	};

	function a(i) {
		this.parentMenu = i.menu || null;
		this.parentLevel = i.parent || null;
		this.parentElement = i.container || document.body;
		this.levelIndex = i.levelIndex || 0;
		this.levelDiv = null;
		this.applyItem = new Object();
		this.applyItem.itemDiv = null;
		this.items = i.items || [];
		this.activeItem = null;
		this.selectedItem = null;
		this.initialized = false;
		this.updated = 0;
		this.renderContent()
	}
	var c = 1;
	f.widget("eqjs.PopupMenu", {
		_mouseIsOverBlock: false,
		_mouseIsOverLink: false,
		_toId: null,
		_itemSelectedCallback: null,
		_menuClosedCallback: null,
		_itemFilterCallback: null,
		_rootLevel: null,
		options: {
			items: [],
			buttons: {
				submit: EQ.core.getText("ButtonApply"),
				cancel: EQ.core.getText("ButtonCancel")
			},
			itemFilterCallback: null,
			useDefaultStyles: false,
			multiselect: false,
			adjustHeight: true,
			showSearchBoxAfter: 30,
			activateOnMouseOver: true,
			container: document.body,
			zIndex: 100000
		},
		_create: function() {
			this.menuId = c++;
			this._updateProps();
			this._rootLevel = new a({
				menu: this,
				items: this.options.items,
				levelIndex: 0,
				container: this.options.container
			});
			f(this._rootLevel.levelDiv).addClass("eqjs-menu-rootLevel");
			f(this._rootLevel.levelDiv).css("z-index", this.options.zIndex);
			var i = this;
			this._menuKeyUpHandler = function(j) {
				if (j.which == 27) {
					i.hideMenu();
					j.stopImmediatePropagation()
				}
			};
			this._globalMouseDownHandler = function() {
				if (!i.active) {
					return true
				}
				var k = window.event || arguments[0];
				var l = k.srcElement || k.target;
				var j = true;
				while (l) {
					if (l.tagName && l.tagName.toLowerCase() == "div") {
						if (l.menuLevel) {
							if (l.menuLevel.parentMenu == i) {
								j = false;
								break
							}
						}
					}
					l = l.parentNode || l.parentElement
				}
				if (j) {
					i.hideMenu()
				}
				return true
			};
			this._render()
		},
		_clearItemMenuProps: function(i) {
			if (i.subLevel && i.subLevel.parentMenu == this) {
				return
			}
			if (i.subLevel) {
				i.subLevel.remove();
				i.subLevel = null
			}
			if (i.itemDiv) {
				i.itemDiv = null
			}
			if (i.items) {
				this._clearItemsMenuProps(i.items)
			}
		},
		_clearItemsMenuProps: function(j) {
			if (!j) {
				return
			}
			for (var k = 0; k < j.length; k++) {
				this._clearItemMenuProps(j[k])
			}
		},
		_render: function() {
			var i = this
		},
		_updateProps: function() {
			this.style = {};
			this.style.colors = {
				border: "#666666",
				shadow: "#888888",
				bgON: "white",
				fgON: "black",
				bgOVER: "#B6BDD2",
				fgOVER: "black"
			};
			this.style.itemStyle = {
				fontSize: "14px"
			};
			this.minItemWidth = 0;
			this.maxItemWidth = 0;
			this.maxHeight = 0;
			this.zIndex = this.options.zIndex;
			this.commandTemplate = "";
			this.parentElement = null;
			this.args = [];
			this.active = false
		},
		_setOption: function(i, j) {
			if (arguments.length == 2) {
				this.options[i] = j;
				return this
			} else {
				return this.options[i]
			}
		},
		_setSelectedItems: function(k, j) {
			var l = k ? k.length : 0;
			var n;
			for (var m = 0; m < l; m++) {
				n = k[m];
				if (n.items) {
					this._setSelectedItems(n.items, j)
				} else {
					n.selected = f.inArray(n.id, j) >= 0
				}
			}
		},
		showMenu: function(l) {
			var j = this;
			this._clearItemsMenuProps(this.options.items);
			j._itemSelectedCallback = l.itemSelectedCallback || null;
			j._menuClosedCallback = l.menuClosedCallback || null;
			j._itemFilterCallback = l.itemFilterCallback || null;
			var i = l.selectedIds || null;
			if (i) {
				if (typeof i === "string") {
					i = i.split(",")
				}
			} else {
				i = []
			}
			this._setSelectedItems(j.options.items, i);
			var k = l.anchor || document.documentElement;
			var m = h(k.get(0), this.options.container);
			var n = k.outerHeight(true);
			var o = {
				left: m.x,
				top: m.y + n + 2
			};
			this.active = true;
			j._rootLevel.showAt(o.left, o.top, false);
			f(document).on("keyup", this._menuKeyUpHandler);
			f(document).on("mousedown", this._globalMouseDownHandler)
		},
		hideMenu: function() {
			f(document).off("mousedown", this._globalMouseDownHandler);
			f(document).off("keyup", this._menuKeyUpHandler);
			this._rootLevel.hide();
			if (this._menuClosedCallback) {
				this._menuClosedCallback.call()
			}
		},
		submitMenu: function(i, k) {
			var j = {
				widget: this,
				menuItem: i,
				selectedItems: k
			};
			if (this._itemSelectedCallback) {
				this._itemSelectedCallback.apply(this, [null, j])
			} else {
				this._trigger("onMenuItemSelected", null, j)
			}
		},
		knockMenuStyle: function(i) {
			i.removeAttr("style");
			var j = i.find("ul").first().prop("style");
			if (j !== "undefined" && j !== false) {
				i.find("ul").first().prop("style", "")
			}
		},
		refreshItems: function() {
			this._rootLevel.refreshItems()
		},
		refreshCheckboxes: function() {
			this._rootLevel.refreshCheckboxes()
		}
	})
})(jQuery);
/*! jQuery Timepicker Addon - v1.5.5 - 2015-05-24
 * http://trentrichardson.com/examples/timepicker
 * Copyright (c) 2015 Trent Richardson; Licensed MIT */
(function(a) {
	if (typeof define === "function" && define.amd) {
		define(["jquery", "jquery.ui"], a)
	} else {
		a(jQuery)
	}
}(function($) {
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return
	}
	$.extend($.ui, {
		timepicker: {
			version: "1.5.5"
		}
	});
	var Timepicker = function() {
			this.regional = [];
			this.regional[""] = {
				currentText: "Now",
				closeText: "Done",
				amNames: ["AM", "A"],
				pmNames: ["PM", "P"],
				timeFormat: "HH:mm",
				timeSuffix: "",
				timeOnlyTitle: "Choose Time",
				timeText: "Time",
				hourText: "Hour",
				minuteText: "Minute",
				secondText: "Second",
				millisecText: "Millisecond",
				microsecText: "Microsecond",
				timezoneText: "Time Zone",
				isRTL: false
			};
			this._defaults = {
				showButtonPanel: true,
				timeOnly: false,
				timeOnlyShowDate: false,
				showHour: null,
				showMinute: null,
				showSecond: null,
				showMillisec: null,
				showMicrosec: null,
				showTimezone: null,
				showTime: true,
				stepHour: 1,
				stepMinute: 1,
				stepSecond: 1,
				stepMillisec: 1,
				stepMicrosec: 1,
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0,
				timezone: null,
				hourMin: 0,
				minuteMin: 0,
				secondMin: 0,
				millisecMin: 0,
				microsecMin: 0,
				hourMax: 23,
				minuteMax: 59,
				secondMax: 59,
				millisecMax: 999,
				microsecMax: 999,
				minDateTime: null,
				maxDateTime: null,
				maxTime: null,
				minTime: null,
				onSelect: null,
				hourGrid: 0,
				minuteGrid: 0,
				secondGrid: 0,
				millisecGrid: 0,
				microsecGrid: 0,
				alwaysSetTime: true,
				separator: " ",
				altFieldTimeOnly: true,
				altTimeFormat: null,
				altSeparator: null,
				altTimeSuffix: null,
				altRedirectFocus: true,
				pickerTimeFormat: null,
				pickerTimeSuffix: null,
				showTimepicker: true,
				timezoneList: null,
				addSliderAccess: false,
				sliderAccessArgs: null,
				controlType: "slider",
				oneLine: false,
				defaultValue: null,
				parse: "strict",
				afterInject: null
			};
			$.extend(this._defaults, this.regional[""])
		};
	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		maxTime: null,
		minTime: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: "",
		formattedDate: "",
		formattedTime: "",
		formattedDateTime: "",
		timezoneList: null,
		units: ["hour", "minute", "second", "millisec", "microsec"],
		support: {},
		control: null,
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this
		},
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
				fns = {},
				overrides, i;
			for (var attrName in this._defaults) {
				if (this._defaults.hasOwnProperty(attrName)) {
					var attrValue = $input.attr("time:" + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue)
						} catch (err) {
							inlineSettings[attrName] = attrValue
						}
					}
				}
			}
			overrides = {
				beforeShow: function(input, dp_inst) {
					if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
						return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst)
					}
				},
				onChangeMonthYear: function(year, month, dp_inst) {
					if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
						tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst)
					}
				},
				onClose: function(dateText, dp_inst) {
					if (tp_inst.timeDefined === true && $input.val() !== "") {
						tp_inst._updateDateTime(dp_inst)
					}
					if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
						tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst)
					}
				}
			};
			for (i in overrides) {
				if (overrides.hasOwnProperty(i)) {
					fns[i] = opts[i] || this._defaults[i] || null
				}
			}
			tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
				evnts: fns,
				timepicker: tp_inst
			});
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase()
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase()
			});
			tp_inst.support = detectSupport(tp_inst._defaults.timeFormat + (tp_inst._defaults.pickerTimeFormat ? tp_inst._defaults.pickerTimeFormat : "") + (tp_inst._defaults.altTimeFormat ? tp_inst._defaults.altTimeFormat : ""));
			if (typeof(tp_inst._defaults.controlType) === "string") {
				if (tp_inst._defaults.controlType === "slider" && typeof($.ui.slider) === "undefined") {
					tp_inst._defaults.controlType = "select"
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType]
			} else {
				tp_inst.control = tp_inst._defaults.controlType
			}
			var timezoneList = [-720, -660, -600, -570, -540, -480, -420, -360, -300, -270, -240, -210, -180, -120, -60, 0, 60, 120, 180, 210, 240, 270, 300, 330, 345, 360, 390, 420, 480, 525, 540, 570, 600, 630, 660, 690, 720, 765, 780, 840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList
			}
			var tzl = timezoneList.length,
				tzi = 0,
				tzv = null;
			if (tzl > 0 && typeof timezoneList[0] !== "object") {
				for (; tzi < tzl; tzi++) {
					tzv = timezoneList[tzi];
					timezoneList[tzi] = {
						value: tzv,
						label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601)
					}
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;
			tp_inst.timezone = tp_inst._defaults.timezone !== null ? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : ((new Date()).getTimezoneOffset() * -1);
			tp_inst.hour = tp_inst._defaults.hour < tp_inst._defaults.hourMin ? tp_inst._defaults.hourMin : tp_inst._defaults.hour > tp_inst._defaults.hourMax ? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute < tp_inst._defaults.minuteMin ? tp_inst._defaults.minuteMin : tp_inst._defaults.minute > tp_inst._defaults.minuteMax ? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second < tp_inst._defaults.secondMin ? tp_inst._defaults.secondMin : tp_inst._defaults.second > tp_inst._defaults.secondMax ? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec < tp_inst._defaults.millisecMin ? tp_inst._defaults.millisecMin : tp_inst._defaults.millisec > tp_inst._defaults.millisecMax ? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec < tp_inst._defaults.microsecMin ? tp_inst._defaults.microsecMin : tp_inst._defaults.microsec > tp_inst._defaults.microsecMax ? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = "";
			tp_inst.$input = $input;
			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField);
				if (tp_inst._defaults.altRedirectFocus === true) {
					tp_inst.$altInput.css({
						cursor: "pointer"
					}).focus(function() {
						$input.trigger("focus")
					})
				}
			}
			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date()
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date()
			}
			if (tp_inst._defaults.minDate !== undefined && tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime())
			}
			if (tp_inst._defaults.minDateTime !== undefined && tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime())
			}
			if (tp_inst._defaults.maxDate !== undefined && tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime())
			}
			if (tp_inst._defaults.maxDateTime !== undefined && tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime())
			}
			tp_inst.$input.bind("focus", function() {
				tp_inst._onFocus()
			});
			return tp_inst
		},
		_addTimePicker: function(dp_inst) {
			var currDT = $.trim((this.$altInput && this._defaults.altFieldTimeOnly) ? this.$input.val() + " " + this.$altInput.val() : this.$input.val());
			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
			this._afterInject()
		},
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0])
			}
			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, "dateFormat");
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false
					}
					$.extend(this, parseRes.timeObj)
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err + "\ndate/time string = " + timeString + "\ntimeFormat = " + this._defaults.timeFormat + "\ndateFormat = " + dp_dateFormat);
					return false
				}
				return true
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false
				}
				$.extend(this, timeObj);
				return true
			}
		},
		_afterInject: function() {
			var o = this.inst.settings;
			if ($.isFunction(o.afterInject)) {
				o.afterInject.call(this)
			}
		},
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = "",
				uitem = "",
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i = 0,
				l = 0;
			if ($dp.find("div.ui-timepicker-div").length === 0 && o.showTimepicker) {
				var noDisplay = " ui_tpicker_unit_hide",
					html = '<div class="ui-timepicker-div' + (o.isRTL ? " ui-timepicker-rtl" : "") + (o.oneLine && o.controlType === "select" ? " ui-timepicker-oneLine" : "") + '"><dl><dt class="ui_tpicker_time_label' + ((o.showTime) ? "" : noDisplay) + '">' + o.timeText + '</dt><dd class="ui_tpicker_time ' + ((o.showTime) ? "" : noDisplay) + '"></dd>';
				for (i = 0, l = this.units.length; i < l; i++) {
					litem = this.units[i];
					uitem = litem.substr(0, 1).toUpperCase() + litem.substr(1);
					show = o["show" + uitem] !== null ? o["show" + uitem] : this.support[litem];
					max[litem] = parseInt((o[litem + "Max"] - ((o[litem + "Max"] - o[litem + "Min"]) % o["step" + uitem])), 10);
					gridSize[litem] = 0;
					html += '<dt class="ui_tpicker_' + litem + "_label" + (show ? "" : noDisplay) + '">' + o[litem + "Text"] + '</dt><dd class="ui_tpicker_' + litem + (show ? "" : noDisplay) + '"><div class="ui_tpicker_' + litem + "_slider" + (show ? "" : noDisplay) + '"></div>';
					if (show && o[litem + "Grid"] > 0) {
						html += '<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';
						if (litem === "hour") {
							for (var h = o[litem + "Min"]; h <= max[litem]; h += parseInt(o[litem + "Grid"], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm ? "hht" : "HH", {
									hour: h
								}, o);
								html += '<td data-for="' + litem + '">' + tmph + "</td>"
							}
						} else {
							for (var m = o[litem + "Min"]; m <= max[litem]; m += parseInt(o[litem + "Grid"], 10)) {
								gridSize[litem]++;
								html += '<td data-for="' + litem + '">' + ((m < 10) ? "0" : "") + m + "</td>"
							}
						}
						html += "</tr></table></div>"
					}
					html += "</dd>"
				}
				var showTz = o.showTimezone !== null ? o.showTimezone : this.support.timezone;
				html += '<dt class="ui_tpicker_timezone_label' + (showTz ? "" : noDisplay) + '">' + o.timezoneText + "</dt>";
				html += '<dd class="ui_tpicker_timezone' + (showTz ? "" : noDisplay) + '"></dd>';
				html += "</dl></div>";
				var $tp = $(html);
				if (o.timeOnly === true) {
					$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">' + o.timeOnlyTitle + "</div></div>");
					$dp.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()
				}
				for (i = 0, l = tp_inst.units.length; i < l; i++) {
					litem = tp_inst.units[i];
					uitem = litem.substr(0, 1).toUpperCase() + litem.substr(1);
					show = o["show" + uitem] !== null ? o["show" + uitem] : this.support[litem];
					tp_inst[litem + "_slider"] = tp_inst.control.create(tp_inst, $tp.find(".ui_tpicker_" + litem + "_slider"), litem, tp_inst[litem], o[litem + "Min"], max[litem], o["step" + uitem]);
					if (show && o[litem + "Grid"] > 0) {
						size = 100 * gridSize[litem] * o[litem + "Grid"] / (max[litem] - o[litem + "Min"]);
						$tp.find(".ui_tpicker_" + litem + " table").css({
							width: size + "%",
							marginLeft: o.isRTL ? "0" : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL ? ((size / (-2 * gridSize[litem])) + "%") : "0",
							borderCollapse: "collapse"
						}).find("td").click(function(e) {
							var $t = $(this),
								h = $t.html(),
								n = parseInt(h.replace(/[^0-9]/g), 10),
								ap = h.replace(/[^apm]/ig),
								f = $t.data("for");
							if (f === "hour") {
								if (ap.indexOf("p") !== -1 && n < 12) {
									n += 12
								} else {
									if (ap.indexOf("a") !== -1 && n === 12) {
										n = 0
									}
								}
							}
							tp_inst.control.value(tp_inst, tp_inst[f + "_slider"], litem, n);
							tp_inst._onTimeChange();
							tp_inst._onSelectHandler()
						}).css({
							cursor: "pointer",
							width: (100 / gridSize[litem]) + "%",
							textAlign: "center",
							overflow: "hidden"
						})
					}
				}
				this.timezone_select = $tp.find(".ui_tpicker_timezone").append("<select></select>").find("select");
				$.fn.append.apply(this.timezone_select, $.map(o.timezoneList, function(val, idx) {
					return $("<option />").val(typeof val === "object" ? val.value : val).text(typeof val === "object" ? val.label : val)
				}));
				if (typeof(this.timezone) !== "undefined" && this.timezone !== null && this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset() * -1;
					if (local_timezone === this.timezone) {
						selectLocalTimezone(tp_inst)
					} else {
						this.timezone_select.val(this.timezone)
					}
				} else {
					if (typeof(this.hour) !== "undefined" && this.hour !== null && this.hour !== "") {
						this.timezone_select.val(o.timezone)
					} else {
						selectLocalTimezone(tp_inst)
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
					tp_inst._afterInject()
				});
				var $buttonPanel = $dp.find(".ui-datepicker-buttonpane");
				if ($buttonPanel.length) {
					$buttonPanel.before($tp)
				} else {
					$dp.append($tp)
				}
				this.$timeObj = $tp.find(".ui_tpicker_time");
				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined
				}
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
					setTimeout(function() {
						if ($tp.find(".ui-slider-access").length === 0) {
							$tp.find(".ui-slider:visible").sliderAccess(sliderAccessArgs);
							var sliderAccessWidth = $tp.find(".ui-slider-access:eq(0)").outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find("table:visible").each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl ? "marginRight" : "marginLeft").toString().replace("%", ""),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + "%",
										css = {
											width: newWidth,
											marginRight: 0,
											marginLeft: 0
										};
									css[rtl ? "marginRight" : "marginLeft"] = newMarginLeft;
									$g.css(css)
								})
							}
						}
					}, 10)
				}
				tp_inst._limitMinMaxDateTime(this.inst, true)
			}
		},
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);
			if (!this._defaults.showTimepicker) {
				return
			}
			if ($.datepicker._get(dp_inst, "minDateTime") !== null && $.datepicker._get(dp_inst, "minDateTime") !== undefined && dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, "minDateTime"),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);
				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin
				}
				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() === dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour <= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute <= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second <= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if (this.millisec <= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds()
								} else {
									if (this.microsec < this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin
									}
									this._defaults.microsecMin = this.microsecMinOriginal
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal
				}
			}
			if ($.datepicker._get(dp_inst, "maxDateTime") !== null && $.datepicker._get(dp_inst, "maxDateTime") !== undefined && dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, "maxDateTime"),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);
				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax
				}
				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() === dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour >= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute >= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second >= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec >= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds()
								} else {
									if (this.microsec > this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax
									}
									this._defaults.microsecMax = this.microsecMaxOriginal
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal
				}
			}
			if (dp_inst.settings.minTime !== null) {
				var tempMinTime = new Date("01/01/1970 " + dp_inst.settings.minTime);
				if (this.hour < tempMinTime.getHours()) {
					this.hour = this._defaults.hourMin = tempMinTime.getHours();
					this.minute = this._defaults.minuteMin = tempMinTime.getMinutes()
				} else {
					if (this.hour === tempMinTime.getHours() && this.minute < tempMinTime.getMinutes()) {
						this.minute = this._defaults.minuteMin = tempMinTime.getMinutes()
					} else {
						if (this._defaults.hourMin < tempMinTime.getHours()) {
							this._defaults.hourMin = tempMinTime.getHours();
							this._defaults.minuteMin = tempMinTime.getMinutes()
						} else {
							if (this._defaults.hourMin === tempMinTime.getHours() === this.hour && this._defaults.minuteMin < tempMinTime.getMinutes()) {
								this._defaults.minuteMin = tempMinTime.getMinutes()
							} else {
								this._defaults.minuteMin = 0
							}
						}
					}
				}
			}
			if (dp_inst.settings.maxTime !== null) {
				var tempMaxTime = new Date("01/01/1970 " + dp_inst.settings.maxTime);
				if (this.hour > tempMaxTime.getHours()) {
					this.hour = this._defaults.hourMax = tempMaxTime.getHours();
					this.minute = this._defaults.minuteMax = tempMaxTime.getMinutes()
				} else {
					if (this.hour === tempMaxTime.getHours() && this.minute > tempMaxTime.getMinutes()) {
						this.minute = this._defaults.minuteMax = tempMaxTime.getMinutes()
					} else {
						if (this._defaults.hourMax > tempMaxTime.getHours()) {
							this._defaults.hourMax = tempMaxTime.getHours();
							this._defaults.minuteMax = tempMaxTime.getMinutes()
						} else {
							if (this._defaults.hourMax === tempMaxTime.getHours() === this.hour && this._defaults.minuteMax > tempMaxTime.getMinutes()) {
								this._defaults.minuteMax = tempMaxTime.getMinutes()
							} else {
								this._defaults.minuteMax = 59
							}
						}
					}
				}
			}
			if (adjustSliders !== undefined && adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10),
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);
				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, "hour", {
						min: this._defaults.hourMin,
						max: hourMax,
						step: this._defaults.stepHour
					});
					this.control.value(this, this.hour_slider, "hour", this.hour - (this.hour % this._defaults.stepHour))
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, "minute", {
						min: this._defaults.minuteMin,
						max: minMax,
						step: this._defaults.stepMinute
					});
					this.control.value(this, this.minute_slider, "minute", this.minute - (this.minute % this._defaults.stepMinute))
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, "second", {
						min: this._defaults.secondMin,
						max: secMax,
						step: this._defaults.stepSecond
					});
					this.control.value(this, this.second_slider, "second", this.second - (this.second % this._defaults.stepSecond))
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, "millisec", {
						min: this._defaults.millisecMin,
						max: millisecMax,
						step: this._defaults.stepMillisec
					});
					this.control.value(this, this.millisec_slider, "millisec", this.millisec - (this.millisec % this._defaults.stepMillisec))
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, "microsec", {
						min: this._defaults.microsecMin,
						max: microsecMax,
						step: this._defaults.stepMicrosec
					});
					this.control.value(this, this.microsec_slider, "microsec", this.microsec - (this.microsec % this._defaults.stepMicrosec))
				}
			}
		},
		_onTimeChange: function() {
			if (!this._defaults.showTimepicker) {
				return
			}
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, "hour") : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, "minute") : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, "second") : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, "millisec") : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, "microsec") : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;
			if (typeof(hour) === "object") {
				hour = false
			}
			if (typeof(minute) === "object") {
				minute = false
			}
			if (typeof(second) === "object") {
				second = false
			}
			if (typeof(millisec) === "object") {
				millisec = false
			}
			if (typeof(microsec) === "object") {
				microsec = false
			}
			if (typeof(timezone) === "object") {
				timezone = false
			}
			if (hour !== false) {
				hour = parseInt(hour, 10)
			}
			if (minute !== false) {
				minute = parseInt(minute, 10)
			}
			if (second !== false) {
				second = parseInt(second, 10)
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10)
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10)
			}
			if (timezone !== false) {
				timezone = timezone.toString()
			}
			var ampm = o[hour < 12 ? "amNames" : "pmNames"][0];
			var hasChanged = (hour !== parseInt(this.hour, 10) || minute !== parseInt(this.minute, 10) || second !== parseInt(this.second, 10) || millisec !== parseInt(this.millisec, 10) || microsec !== parseInt(this.microsec, 10) || (this.ampm.length > 0 && (hour < 12) !== ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) || (this.timezone !== null && timezone !== this.timezone.toString()));
			if (hasChanged) {
				if (hour !== false) {
					this.hour = hour
				}
				if (minute !== false) {
					this.minute = minute
				}
				if (second !== false) {
					this.second = second
				}
				if (millisec !== false) {
					this.millisec = millisec
				}
				if (microsec !== false) {
					this.microsec = microsec
				}
				if (timezone !== false) {
					this.timezone = timezone
				}
				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0])
				}
				this._limitMinMaxDateTime(this.inst, true)
			}
			if (this.support.ampm) {
				this.ampm = ampm
			}
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if (pickerTimeFormat === o.timeFormat) {
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix)
				} else {
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix)
				}
			}
			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime()
			}
		},
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect && inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this])
			}
		},
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			var dtTmp = (dp_inst.currentYear > 0 ? new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay) : new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
				dt = $.datepicker._daylightSavingAdjust(dtTmp),
				dateFmt = $.datepicker._get(dp_inst, "dateFormat"),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null && this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			if (dp_inst.lastVal === "") {
				dp_inst.currentYear = dp_inst.selectedYear;
				dp_inst.currentMonth = dp_inst.selectedMonth;
				dp_inst.currentDay = dp_inst.selectedDay
			}
			if (this._defaults.timeOnly === true && this._defaults.timeOnlyShowDate === false) {
				formattedDateTime = this.formattedTime
			} else {
				if ((this._defaults.timeOnly !== true && (this._defaults.alwaysSetTime || timeAvailable)) || (this._defaults.timeOnly === true && this._defaults.timeOnlyShowDate === true)) {
					formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix
				}
			}
			this.formattedDateTime = formattedDateTime;
			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate)
			} else {
				if (this.$altInput && this._defaults.timeOnly === false && this._defaults.altFieldTimeOnly === true) {
					this.$altInput.val(this.formattedTime);
					this.$input.val(this.formattedDate)
				} else {
					if (this.$altInput) {
						this.$input.val(formattedDateTime);
						var altFormattedDateTime = "",
							altSeparator = this._defaults.altSeparator !== null ? this._defaults.altSeparator : this._defaults.separator,
							altTimeSuffix = this._defaults.altTimeSuffix !== null ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
						if (!this._defaults.timeOnly) {
							if (this._defaults.altFormat) {
								altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg)
							} else {
								altFormattedDateTime = this.formattedDate
							}
							if (altFormattedDateTime) {
								altFormattedDateTime += altSeparator
							}
						}
						if (this._defaults.altTimeFormat !== null) {
							altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix
						} else {
							altFormattedDateTime += this.formattedTime + altTimeSuffix
						}
						this.$altInput.val(altFormattedDateTime)
					} else {
						this.$input.val(formattedDateTime)
					}
				}
			}
			this.$input.trigger("change")
		},
		_onFocus: function() {
			if (!this.$input.val() && this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, "timepicker");
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly && (inst.input.val() !== inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst)
						} catch (err) {
							$.timepicker.log(err)
						}
					}
				}
			}
		},
		_controls: {
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step) {
					var rtl = tp_inst._defaults.isRTL;
					return obj.prop("slide", null).slider({
						orientation: "horizontal",
						value: rtl ? val * -1 : val,
						min: rtl ? max * -1 : min,
						max: rtl ? min * -1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl ? ui.value * -1 : ui.value);
							tp_inst._onTimeChange()
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler()
						}
					})
				},
				options: function(tp_inst, obj, unit, opts, val) {
					if (tp_inst._defaults.isRTL) {
						if (typeof(opts) === "string") {
							if (opts === "min" || opts === "max") {
								if (val !== undefined) {
									return obj.slider(opts, val * -1)
								}
								return Math.abs(obj.slider(opts))
							}
							return obj.slider(opts)
						}
						var min = opts.min,
							max = opts.max;
						opts.min = opts.max = null;
						if (min !== undefined) {
							opts.max = min * -1
						}
						if (max !== undefined) {
							opts.min = max * -1
						}
						return obj.slider(opts)
					}
					if (typeof(opts) === "string" && val !== undefined) {
						return obj.slider(opts, val)
					}
					return obj.slider(opts)
				},
				value: function(tp_inst, obj, unit, val) {
					if (tp_inst._defaults.isRTL) {
						if (val !== undefined) {
							return obj.slider("value", val * -1)
						}
						return Math.abs(obj.slider("value"))
					}
					if (val !== undefined) {
						return obj.slider("value", val)
					}
					return obj.slider("value")
				}
			},
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step) {
					var sel = '<select class="ui-timepicker-select ui-state-default ui-corner-all" data-unit="' + unit + '" data-min="' + min + '" data-max="' + max + '" data-step="' + step + '">',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;
					for (var i = min; i <= max; i += step) {
						sel += '<option value="' + i + '"' + (i === val ? " selected" : "") + ">";
						if (unit === "hour") {
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig, "")), {
								hour: i
							}, tp_inst._defaults)
						} else {
							if (unit === "millisec" || unit === "microsec" || i >= 10) {
								sel += i
							} else {
								sel += "0" + i.toString()
							}
						}
						sel += "</option>"
					}
					sel += "</select>";
					obj.children("select").remove();
					$(sel).appendTo(obj).change(function(e) {
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
						tp_inst._afterInject()
					});
					return obj
				},
				options: function(tp_inst, obj, unit, opts, val) {
					var o = {},
						$t = obj.children("select");
					if (typeof(opts) === "string") {
						if (val === undefined) {
							return $t.data(opts)
						}
						o[opts] = val
					} else {
						o = opts
					}
					return tp_inst.control.create(tp_inst, obj, $t.data("unit"), $t.val(), o.min >= 0 ? o.min : $t.data("min"), o.max || $t.data("max"), o.step || $t.data("step"))
				},
				value: function(tp_inst, obj, unit, val) {
					var $t = obj.children("select");
					if (val !== undefined) {
						return $t.val(val)
					}
					return $t.val()
				}
			}
		}
	});
	$.fn.extend({
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);
			if (typeof o === "object") {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				})
			}
			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args)
			})
		},
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;
			if (typeof(o) === "string") {
				if (o === "getDate" || (o === "option" && tmp_args.length === 2 && typeof(tmp_args[1]) === "string")) {
					return $.fn.datepicker.apply($(this[0]), tmp_args)
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args)
					})
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults)
				})
			}
		}
	});
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec)
		}
		return parseRes.date
	};
	$.datepicker.parseTime = function(timeFormat, timeString, options) {
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g, "").indexOf("Z") !== -1);
		var strictParse = function(f, s, o) {
				var getPatternAmpm = function(amNames, pmNames) {
						var markers = [];
						if (amNames) {
							$.merge(markers, amNames)
						}
						if (pmNames) {
							$.merge(markers, pmNames)
						}
						markers = $.map(markers, function(val) {
							return val.replace(/[.*+?|()\[\]{}\\]/g, "\\$&")
						});
						return "(" + markers.join("|") + ")?"
					};
				var getFormatPositions = function(timeFormat) {
						var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
							orders = {
								h: -1,
								m: -1,
								s: -1,
								l: -1,
								c: -1,
								t: -1,
								z: -1
							};
						if (finds) {
							for (var i = 0; i < finds.length; i++) {
								if (orders[finds[i].toString().charAt(0)] === -1) {
									orders[finds[i].toString().charAt(0)] = i + 1
								}
							}
						}
						return orders
					};
				var regstr = "^" + f.toString().replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function(match) {
					var ml = match.length;
					switch (match.charAt(0).toLowerCase()) {
					case "h":
						return ml === 1 ? "(\\d?\\d)" : "(\\d{" + ml + "})";
					case "m":
						return ml === 1 ? "(\\d?\\d)" : "(\\d{" + ml + "})";
					case "s":
						return ml === 1 ? "(\\d?\\d)" : "(\\d{" + ml + "})";
					case "l":
						return "(\\d?\\d?\\d)";
					case "c":
						return "(\\d?\\d?\\d)";
					case "z":
						return "(z|[-+]\\d\\d:?\\d\\d|\\S+)?";
					case "t":
						return getPatternAmpm(o.amNames, o.pmNames);
					default:
						return "(" + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function(m) {
							return "\\" + m
						}) + ")?"
					}
				}).replace(/\s/g, "\\s?") + o.timeSuffix + "$",
					order = getFormatPositions(f),
					ampm = "",
					treg;
				treg = s.match(new RegExp(regstr, "i"));
				var resTime = {
					hour: 0,
					minute: 0,
					second: 0,
					millisec: 0,
					microsec: 0
				};
				if (treg) {
					if (order.t !== -1) {
						if (treg[order.t] === undefined || treg[order.t].length === 0) {
							ampm = "";
							resTime.ampm = ""
						} else {
							ampm = $.inArray(treg[order.t].toUpperCase(), $.map(o.amNames, function(x, i) {
								return x.toUpperCase()
							})) !== -1 ? "AM" : "PM";
							resTime.ampm = o[ampm === "AM" ? "amNames" : "pmNames"][0]
						}
					}
					if (order.h !== -1) {
						if (ampm === "AM" && treg[order.h] === "12") {
							resTime.hour = 0
						} else {
							if (ampm === "PM" && treg[order.h] !== "12") {
								resTime.hour = parseInt(treg[order.h], 10) + 12
							} else {
								resTime.hour = Number(treg[order.h])
							}
						}
					}
					if (order.m !== -1) {
						resTime.minute = Number(treg[order.m])
					}
					if (order.s !== -1) {
						resTime.second = Number(treg[order.s])
					}
					if (order.l !== -1) {
						resTime.millisec = Number(treg[order.l])
					}
					if (order.c !== -1) {
						resTime.microsec = Number(treg[order.c])
					}
					if (order.z !== -1 && treg[order.z] !== undefined) {
						resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z])
					}
					return resTime
				}
				return false
			};
		var looseParse = function(f, s, o) {
				try {
					var d = new Date("2012-01-01 " + s);
					if (isNaN(d.getTime())) {
						d = new Date("2012-01-01T" + s);
						if (isNaN(d.getTime())) {
							d = new Date("01/01/2012 " + s);
							if (isNaN(d.getTime())) {
								throw "Unable to parse time with native Date: " + s
							}
						}
					}
					return {
						hour: d.getHours(),
						minute: d.getMinutes(),
						second: d.getSeconds(),
						millisec: d.getMilliseconds(),
						microsec: d.getMicroseconds(),
						timezone: d.getTimezoneOffset() * -1
					}
				} catch (err) {
					try {
						return strictParse(f, s, o)
					} catch (err2) {
						$.timepicker.log("Unable to parse \ntimeString: " + s + "\ntimeFormat: " + f)
					}
				}
				return false
			};
		if (typeof o.parse === "function") {
			return o.parse(timeFormat, timeString, o)
		}
		if (o.parse === "loose") {
			return looseParse(timeFormat, timeString, o)
		}
		return strictParse(timeFormat, timeString, o)
	};
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null
		}, time);
		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);
		if (hour > 11) {
			ampmName = options.pmNames[0]
		}
		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function(match) {
			switch (match) {
			case "HH":
				return ("0" + hour).slice(-2);
			case "H":
				return hour;
			case "hh":
				return ("0" + convert24to12(hour)).slice(-2);
			case "h":
				return convert24to12(hour);
			case "mm":
				return ("0" + time.minute).slice(-2);
			case "m":
				return time.minute;
			case "ss":
				return ("0" + time.second).slice(-2);
			case "s":
				return time.second;
			case "l":
				return ("00" + time.millisec).slice(-3);
			case "c":
				return ("00" + time.microsec).slice(-3);
			case "z":
				return $.timepicker.timezoneOffsetString(time.timezone === null ? options.timezone : time.timezone, false);
			case "Z":
				return $.timepicker.timezoneOffsetString(time.timezone === null ? options.timezone : time.timezone, true);
			case "T":
				return ampmName.charAt(0).toUpperCase();
			case "TT":
				return ampmName.toUpperCase();
			case "t":
				return ampmName.charAt(0).toLowerCase();
			case "tt":
				return ampmName.toLowerCase();
			default:
				return match.replace(/'/g, "")
			}
		});
		return tmptime
	};
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, "timepicker"),
			was_inline;
		if (tp_inst && inst.settings.showTimepicker) {
			tp_inst._limitMinMaxDateTime(inst, true);
			was_inline = inst.inline;
			inst.inline = inst.stay_open = true;
			this._base_selectDate(id, dateStr);
			inst.inline = was_inline;
			inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst)
		} else {
			this._base_selectDate(id, dateStr)
		}
	};
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {
		var input = inst.input[0];
		if ($.datepicker._curInst && $.datepicker._curInst !== inst && $.datepicker._datepickerShowing && $.datepicker._lastInput !== input) {
			return
		}
		if (typeof(inst.stay_open) !== "boolean" || inst.stay_open === false) {
			this._base_updateDatepicker(inst);
			var tp_inst = this._get(inst, "timepicker");
			if (tp_inst) {
				tp_inst._addTimePicker(inst)
			}
		}
	};
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, "timepicker");
		if (tp_inst) {
			if ($.datepicker._get(inst, "constrainInput")) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null ? tp_inst._defaults.showTimezone : tp_inst.support.timezone,
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, "dateFormat")),
					datetimeChars = tp_inst._defaults.timeFormat.toString().replace(/[hms]/g, "").replace(/TT/g, ampm ? "APM" : "").replace(/Tt/g, ampm ? "AaPpMm" : "").replace(/tT/g, ampm ? "AaPpMm" : "").replace(/T/g, ampm ? "AP" : "").replace(/tt/g, ampm ? "apm" : "").replace(/t/g, ampm ? "ap" : "") + " " + tp_inst._defaults.separator + tp_inst._defaults.timeSuffix + (tz ? tp_inst._defaults.timezoneList.join("") : "") + (tp_inst._defaults.amNames.join("")) + (tp_inst._defaults.pmNames.join("")) + dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr < " " || !dateChars || datetimeChars.indexOf(chr) > -1)
			}
		}
		return $.datepicker._base_doKeyPress(event)
	};
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, "timepicker");
		if (tp_inst) {
			var altField = tp_inst._defaults.altField;
			if (altField) {
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = "",
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator,
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if (!tp_inst._defaults.timeOnly && !tp_inst._defaults.altFieldTimeOnly && date !== null) {
					if (tp_inst._defaults.altFormat) {
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime
					} else {
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime
					}
				}
				$(altField).val(inst.input.val() ? altFormattedDateTime : "")
			}
		} else {
			$.datepicker._base_updateAlternate(inst)
		}
	};
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, "timepicker");
		if (tp_inst) {
			if (tp_inst._defaults.timeOnly && (inst.input.val() !== inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst)
				} catch (err) {
					$.timepicker.log(err)
				}
			}
		}
		return $.datepicker._base_doKeyUp(event)
	};
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		var tp_inst = this._get(inst, "timepicker");
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		this._setDate(inst, now);
		this._base_gotoToday(id)
	};
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return
		}
		var tp_inst = this._get(inst, "timepicker");
		$(target).datepicker("getDate");
		if (tp_inst) {
			inst.settings.showTimepicker = false;
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst)
		}
	};
	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return
		}
		var tp_inst = this._get(inst, "timepicker");
		$(target).datepicker("getDate");
		if (tp_inst) {
			inst.settings.showTimepicker = true;
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst);
			tp_inst._updateDateTime(inst)
		}
	};
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, "timepicker");
		if (tp_inst) {
			var defaults = tp_inst._defaults;
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;
			tp_inst._limitMinMaxDateTime(inst, true);
			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst)
		}
	};
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return
		}
		var tp_inst = this._get(inst, "timepicker");
		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date === "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec)
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds())
				}
				if (tp_date.toString() === "Invalid Date") {
					tp_date = undefined
				}
				this._setTime(inst, tp_date)
			}
		}
	};
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, _date) {
		var inst = this._getInst(target);
		var date = _date;
		if (!inst) {
			return
		}
		if (typeof(_date) === "string") {
			date = new Date(_date);
			if (!date.getTime()) {
				this._base_setDateDatepicker.apply(this, arguments);
				date = $(target).datepicker("getDate")
			}
		}
		var tp_inst = this._get(inst, "timepicker");
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds())
		} else {
			tp_date = date
		}
		if (tp_inst && tp_date) {
			if (!tp_inst.support.timezone && tp_inst._defaults.timezone === null) {
				tp_inst.timezone = tp_date.getTimezoneOffset() * -1
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone)
		}
		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true)
	};
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return
		}
		var tp_inst = this._get(inst, "timepicker");
		if (tp_inst) {
			if (inst.lastVal === undefined) {
				this._setDateFromField(inst, noDefault)
			}
			var date = this._getDate(inst);
			var currDT = $.trim((tp_inst.$altInput && tp_inst._defaults.altFieldTimeOnly) ? tp_inst.$input.val() + " " + tp_inst.$altInput.val() : tp_inst.$input.val());
			if (date && tp_inst._parseTime(currDT, !inst.settings.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);
				if (tp_inst.timezone != null) {
					if (!tp_inst.support.timezone && tp_inst._defaults.timezone === null) {
						tp_inst.timezone = date.getTimezoneOffset() * -1
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone)
				}
			}
			return date
		}
		return this._base_getDateDatepicker(target, noDefault)
	};
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings)
		} catch (err) {
			if (err.indexOf(":") >= 0) {
				date = this._base_parseDate(format, value.substring(0, value.length - (err.length - err.indexOf(":") - 2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format)
			} else {
				throw err
			}
		}
		return date
	};
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, "timepicker");
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val()
		}
		return this._base_formatDate(inst)
	};
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
			name_clone;
		if (!inst) {
			return null
		}
		var tp_inst = this._get(inst, "timepicker");
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop, ret, oldVal, $target;
			if (typeof name === "string") {
				if (name === "minDate" || name === "minDateTime") {
					min = value
				} else {
					if (name === "maxDate" || name === "maxDateTime") {
						max = value
					} else {
						if (name === "onSelect") {
							onselect = value
						} else {
							if (overrides.hasOwnProperty(name)) {
								if (typeof(value) === "undefined") {
									return overrides[name]
								}
								fns[name] = value;
								name_clone = {}
							}
						}
					}
				}
			} else {
				if (typeof name === "object") {
					if (name.minDate) {
						min = name.minDate
					} else {
						if (name.minDateTime) {
							min = name.minDateTime
						} else {
							if (name.maxDate) {
								max = name.maxDate
							} else {
								if (name.maxDateTime) {
									max = name.maxDateTime
								}
							}
						}
					}
					for (prop in overrides) {
						if (overrides.hasOwnProperty(prop) && name[prop]) {
							fns[prop] = name[prop]
						}
					}
				}
			}
			for (prop in fns) {
				if (fns.hasOwnProperty(prop)) {
					overrides[prop] = fns[prop];
					if (!name_clone) {
						name_clone = $.extend({}, name)
					}
					delete name_clone[prop]
				}
			}
			if (name_clone && isEmptyObject(name_clone)) {
				return
			}
			if (min) {
				if (min === 0) {
					min = new Date()
				} else {
					min = new Date(min)
				}
				tp_inst._defaults.minDate = min;
				tp_inst._defaults.minDateTime = min
			} else {
				if (max) {
					if (max === 0) {
						max = new Date()
					} else {
						max = new Date(max)
					}
					tp_inst._defaults.maxDate = max;
					tp_inst._defaults.maxDateTime = max
				} else {
					if (onselect) {
						tp_inst._defaults.onSelect = onselect
					}
				}
			}
			if (min || max) {
				$target = $(target);
				oldVal = $target.datetimepicker("getDate");
				ret = this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
				$target.datetimepicker("setDate", oldVal);
				return ret
			}
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name)
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value)
	};
	var isEmptyObject = function(obj) {
			var prop;
			for (prop in obj) {
				if (obj.hasOwnProperty(prop)) {
					return false
				}
			}
			return true
		};
	var extendRemove = function(target, props) {
			$.extend(target, props);
			for (var name in props) {
				if (props[name] === null || props[name] === undefined) {
					target[name] = props[name]
				}
			}
			return target
		};
	var detectSupport = function(timeFormat) {
			var tf = timeFormat.replace(/'.*?'/g, "").toLowerCase(),
				isIn = function(f, t) {
					return f.indexOf(t) !== -1 ? true : false
				};
			return {
				hour: isIn(tf, "h"),
				minute: isIn(tf, "m"),
				second: isIn(tf, "s"),
				millisec: isIn(tf, "l"),
				microsec: isIn(tf, "c"),
				timezone: isIn(tf, "z"),
				ampm: isIn(tf, "t") && isIn(timeFormat, "h"),
				iso8601: isIn(timeFormat, "Z")
			}
		};
	var convert24to12 = function(hour) {
			hour %= 12;
			if (hour === 0) {
				hour = 12
			}
			return String(hour)
		};
	var computeEffectiveSetting = function(settings, property) {
			return settings && settings[property] ? settings[property] : $.timepicker._defaults[property]
		};
	var splitDateTime = function(dateTimeString, timeSettings) {
			var separator = computeEffectiveSetting(timeSettings, "separator"),
				format = computeEffectiveSetting(timeSettings, "timeFormat"),
				timeParts = format.split(separator),
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;
			if (allPartsLen > 1) {
				return {
					dateString: allParts.splice(0, allPartsLen - timePartsLen).join(separator),
					timeString: allParts.splice(0, timePartsLen).join(separator)
				}
			}
			return {
				dateString: dateTimeString,
				timeString: ""
			}
		};
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
			var date, parts, parsedTime;
			parts = splitDateTime(dateTimeString, timeSettings);
			date = $.datepicker._base_parseDate(dateFormat, parts.dateString, dateSettings);
			if (parts.timeString === "") {
				return {
					date: date
				}
			}
			parsedTime = $.datepicker.parseTime(timeFormat, parts.timeString, timeSettings);
			if (!parsedTime) {
				throw "Wrong time format"
			}
			return {
				date: date,
				timeObj: parsedTime
			}
		};
	var selectLocalTimezone = function(tp_inst, date) {
			if (tp_inst && tp_inst.timezone_select) {
				var now = date || new Date();
				tp_inst.timezone_select.val(-now.getTimezoneOffset())
			}
		};
	$.timepicker = new Timepicker();
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if (isNaN(tzMinutes) || tzMinutes > 840 || tzMinutes < -720) {
			return tzMinutes
		}
		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601 ? ":" : "",
			tz = (off >= 0 ? "+" : "-") + ("0" + Math.abs(hours)).slice(-2) + iso + ("0" + Math.abs(minutes)).slice(-2);
		if (tz === "+00:00") {
			return "Z"
		}
		return tz
	};
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		var normalized = tzString.toString().replace(":", "");
		if (normalized.toUpperCase() === "Z") {
			return 0
		}
		if (!/^(\-|\+)\d{4}$/.test(normalized)) {
			return tzString
		}
		return ((normalized.substr(0, 1) === "-" ? -1 : 1) * ((parseInt(normalized.substr(1, 2), 10) * 60) + parseInt(normalized.substr(3, 2), 10)))
	};
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if (!isNaN(toTz)) {
			date.setMinutes(date.getMinutes() + -date.getTimezoneOffset() - toTz)
		}
		return date
	};
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange("timepicker", startTime, endTime, options)
	};
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange("datetimepicker", startTime, endTime, options)
	};
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange("datepicker", startTime, endTime, options)
	};
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0,
			maxInterval: 0,
			start: {},
			end: {}
		}, options);
		var timeOnly = false;
		if (method === "timepicker") {
			timeOnly = true;
			method = "datetimepicker"
		}
		function checkDates(changed, other) {
			var startdt = startTime[method]("getDate"),
				enddt = endTime[method]("getDate"),
				changeddt = changed[method]("getDate");
			if (startdt !== null) {
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());
				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);
				if (options.minInterval > 0 && minDate > enddt) {
					endTime[method]("setDate", minDate)
				} else {
					if (options.maxInterval > 0 && maxDate < enddt) {
						endTime[method]("setDate", maxDate)
					} else {
						if (startdt > enddt) {
							other[method]("setDate", changeddt)
						}
					}
				}
			}
		}
		function selected(changed, other, option) {
			if (!changed.val()) {
				return
			}
			var date = changed[method].call(changed, "getDate");
			if (date !== null && options.minInterval > 0) {
				if (option === "minDate") {
					date.setMilliseconds(date.getMilliseconds() + options.minInterval)
				}
				if (option === "maxDate") {
					date.setMilliseconds(date.getMilliseconds() - options.minInterval)
				}
			}
			if (date.getTime) {
				other[method].call(other, "option", option, date)
			}
		}
		$.fn[method].call(startTime, $.extend({
			timeOnly: timeOnly,
			onClose: function(dateText, inst) {
				checkDates($(this), endTime)
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, "minDate")
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			timeOnly: timeOnly,
			onClose: function(dateText, inst) {
				checkDates($(this), startTime)
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, "maxDate")
			}
		}, options, options.end));
		checkDates(startTime, endTime);
		selected(startTime, endTime, "minDate");
		selected(endTime, startTime, "maxDate");
		return $([startTime.get(0), endTime.get(0)])
	};
	$.timepicker.log = function() {
		if (window.console) {
			window.console.log.apply(window.console, Array.prototype.slice.call(arguments))
		}
	};
	$.timepicker._util = {
		_extendRemove: extendRemove,
		_isEmptyObject: isEmptyObject,
		_convert24to12: convert24to12,
		_detectSupport: detectSupport,
		_selectLocalTimezone: selectLocalTimezone,
		_computeEffectiveSetting: computeEffectiveSetting,
		_splitDateTime: splitDateTime,
		_parseDateTimeInternal: parseDateTimeInternal
	};
	if (!Date.prototype.getMicroseconds) {
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function() {
			return this.microseconds
		};
		Date.prototype.setMicroseconds = function(m) {
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m / 1000));
			this.microseconds = m % 1000;
			return this
		}
	}
	$.timepicker.version = "1.5.5"
}));
(function(c, b) {
	var a = b.EQ = b.EQ || {};
	a.client = {
		defaultQuery: new a.core.Query(),
		serviceUrl: "EasyQuery",
		locale: "",
		_currentOptions: {},
		_modelPromise: null,
		_updateActionUrls: function() {
			var d = a.core;
			this.loadModelUrl = d.combinePath(this.serviceUrl, "GetModel");
			this.newQueryUrl = d.combinePath(this.serviceUrl, "NewQuery");
			this.loadQueryUrl = d.combinePath(this.serviceUrl, "GetQuery");
			this.saveQueryUrl = d.combinePath(this.serviceUrl, "SaveQuery");
			this.buildQueryUrl = d.combinePath(this.serviceUrl, "BuildQuery");
			this.syncQueryUrl = d.combinePath(this.serviceUrl, "SyncQuery");
			this.executeQueryUrl = d.combinePath(this.serviceUrl, "ExecuteQuery");
			this.executeSqlUrl = d.combinePath(this.serviceUrl, "ExecuteSql");
			this.listRequestUrl = d.combinePath(this.serviceUrl, "GetList");
			this.loadQueryListUrl = d.combinePath(this.serviceUrl, "GetQueryList");
			this.removeQueryUrl = d.combinePath(this.serviceUrl, "RemoveQuery")
		},
		_addAntiForgeryToken: function(d) {
			if (!this.antiForgeryToken) {
				return d
			}
			d.__RequestVerificationToken = this.antiForgeryToken;
			return d
		},
		defaultListRequestHandler: function(e, d) {},
		queryChanged: function(e, d) {
			if (d) {
				this.defaultQuery.removeChangedCallback(e)
			} else {
				this.defaultQuery.addChangedCallback(e)
			}
		},
		controls: {},
		initControlsDefault: function(r) {
			var e = r || {};
			var q = r.queryContentInputId || "QueryContentJson";
			var l = r.queryPanelId || "QueryPanel";
			var h = r.columnsPanelId || "ColumnsPanel";
			var d = r.columnsBarId || "ColumnsBar";
			var j = r.entitiesPanelId || "EntitiesPanel";
			var f = r.filterBarId || "FilterBar";
			var o = c("#" + q);
			if (o.length > 0) {
				this.controls.queryContentInput = o
			}
			var i = c("#" + l);
			if (i.length > 0) {
				e.queryPanel = e.queryPanel || {};
				i.QueryPanel(e.queryPanel);
				i.QueryPanel("setQuery", this.defaultQuery);
				this.controls.QPWidget = i
			}
			var g = c("#" + h);
			if (g.length > 0) {
				e.columnsPanel = e.columnsPanel || {};
				e.columnsPanel.query = this.defaultQuery;
				g.ColumnsPanel(e.columnsPanel);
				g.ColumnsPanel("setQuery", this.defaultQuery);
				this.controls.CPWidget = g
			}
			var n = c("#" + d);
			if (n.length > 0) {
				e.columnsBar = e.columnsBar || {};
				e.columnsBar.query = this.defaultQuery;
				n.ColumnsBar(e.columnsBar);
				n.ColumnsBar("setQuery", this.defaultQuery);
				this.controls.CBWidget = n
			}
			var k = c("#" + j);
			if (k.length > 0) {
				e.entitiesPanel = e.entitiesPanel || {};
				k.EntitiesPanel(e.entitiesPanel);
				k.EntitiesPanel("setModel", this.defaultQuery.getModel());
				this.controls.EPWidget = k
			}
			var m = c("#" + f);
			if (m.length > 0) {
				e.filterBar = e.filterBar || {};
				m.FilterBar(e.filterBar);
				m.FilterBar("setQuery", this.defaultQuery);
				this.controls.FBWidget = m
			}
		},
		init: function(l) {
			l = l || b.easyQuerySettings || this._currentOptions;
			this._currentOptions = l;
			if (l.serviceUrl) {
				this.serviceUrl = l.serviceUrl
			}
			if (l.menuOptions) {
				var k = this.menuOptions;
				var f = l.menuOptions;
				for (var g in k) {
					if (k.hasOwnProperty(g) && f.hasOwnProperty(g)) {
						k[g] = f[g]
					}
				}
			}
			this._updateActionUrls();
			if (l.loadModelUrl) {
				this.loadModelUrl = l.loadModelUrl
			}
			if (l.newQueryUrl) {
				this.newQueryUrl = l.newQueryUrl
			}
			if (l.loadQueryUrl) {
				this.loadQueryUrl = l.loadQueryUrl
			}
			if (l.saveQueryUrl) {
				this.saveQueryUrl = l.saveQueryUrl
			}
			if (l.buildQueryUrl) {
				this.buildQueryUrl = l.buildQueryUrl
			}
			if (l.syncQueryUrl) {
				this.syncQueryUrl = l.syncQueryUrl
			}
			if (l.executeQueryUrl) {
				this.executeQueryUrl = l.executeQueryUrl
			}
			if (l.executeSqlUrl) {
				this.executeSqlUrl = l.executeSqlUrl
			}
			if (l.listRequestUrl) {
				this.listRequestUrl = l.listRequestUrl
			}
			if (l.useBootstrap) {
				this.useBootstrap = l.useBootstrap
			}
			this.modelName = l.modelName || "";
			this.modelId = l.modelId || l.modelName;
			this.initialQuery = l.initialQuery;
			if (l.loadQueryOnStart) {
				this.loadQueryOnStart = l.loadQueryOnStart
			} else {
				this.loadQueryOnStart = false
			}
			var e = l.defaultQueryName || "";
			var h = l.defaultQueryId || "";
			this.antiForgeryToken = l.antiForgeryToken;
			if (l.locale) {
				this.locale = l.locale
			}
			l.queryPanel = l.queryPanel || {};
			var d = function(o, n) {
					var m = j._addAntiForgeryToken(o);
					c.ajax({
						type: "POST",
						url: j.listRequestUrl,
						data: m,
						dataType: "json",
						success: function(q) {
							n(q)
						},
						error: function(q, s, r) {
							n(null)
						}
					})
				};
			this.defaultQuery.clientListRequestHandler = l.listRequestHandler || l.queryPanel.listRequestHandler;
			this.defaultQuery.serverListRequestHandler = d;
			this.initControlsDefault(l);
			var j = this;
			if (this.modelId || l.loadDefaultModel) {
				var i = l.loadDefaultModel ? "" : this.modelId;
				this.loadModel({
					modelId: i,
					modelName: i,
					success: function(n) {
						var m = j.getQuery();
						if (j.initialQuery) {
							m.setObject(j.initialQuery)
						}
						if (j.controls.queryContentInput) {
							m.setObject(j.controls.queryContentInput.val())
						}
						if (j.loadQueryOnStart) {
							j.loadQuery({
								queryId: h || e
							})
						}
						if (j.onInitialModelLoad) {
							j.onInitialModelLoad(n)
						}
						if (l.onLoadModel) {
							l.onLoadModel(n)
						}
					}
				})
			}
		},
		getQuery: function() {
			return this.defaultQuery
		},
		refreshWidgets: function(d) {
			if (d && this.controls.EPWidget) {
				this.controls.EPWidget.EntitiesPanel("refresh")
			}
			if (this.controls.QPWidget) {
				this.controls.QPWidget.QueryPanel("refresh")
			}
			if (this.controls.CPWidget) {
				this.controls.CPWidget.ColumnsPanel("refresh")
			}
			if (this.controls.CBWidget) {
				this.controls.CBWidget.ColumnsBar("refresh")
			}
			if (this.controls.FBWidget) {
				this.controls.FBWidget.FilterBar("refresh")
			}
		},
		loadModel: function(f) {
			var d = this;
			var e = this._addAntiForgeryToken({
				modelId: f.modelId,
				modelName: f.modelName
			});
			if (d.controls.EPWidget) {
				d.controls.EPWidget.EntitiesPanel("startLoading")
			}
			this._modelPromise = c.ajax({
				type: "POST",
				url: a.client.loadModelUrl,
				data: e,
				dataType: "json",
				beforeSend: f.beforeSend,
				crossDomain: false,
				success: function(g) {
					d.defaultQuery.loadModelObject(g);
					d.refreshWidgets(true);
					if (d.controls.EPWidget) {
						d.controls.EPWidget.EntitiesPanel("finishLoading")
					}
					if (f.success) {
						f.success(g)
					}
				},
				error: function(g, i, h) {
					if (d.controls.EPWidget) {
						d.controls.EPWidget.EntitiesPanel("finishLoading")
					}
					if (f.error) {
						f.error(g.status, g.responseText, "LoadModel")
					} else {
						alert("LoadModel error: \n" + g.responseText)
					}
				}
			})
		},
		_doWhenModelLoaded: function(d) {
			var e = this;
			if (e.defaultQuery.model && !e.defaultQuery.model.isEmpty()) {
				if (e._modelPromise) {
					e._modelPromise.done(d)
				}
			}
		},
		newQuery: function(f) {
			var d = this;
			var e = this._addAntiForgeryToken({
				queryName: f.queryName,
				modelId: f.modelId
			});
			d._doWhenModelLoaded(function() {
				c.ajax({
					type: "POST",
					url: a.client.newQueryUrl,
					data: e,
					dataType: "json",
					beforeSend: f.beforeSend,
					success: function(g) {
						d.defaultQuery.setObject(g);
						d.refreshWidgets();
						if (f.success) {
							f.success(d.defaultQuery)
						}
					},
					error: function(g, i, h) {
						if (f.error) {
							f.error(g.status, g.responseText, "NewQuery")
						} else {
							alert("NewQuery error: \n" + g.responseText)
						}
					}
				})
			})
		},
		loadQuery: function(f) {
			var d = this;
			if (!f) {
				f = {}
			}
			if (!f.queryName) {
				f.queryName = f.queryId
			}
			var e = this._addAntiForgeryToken({
				queryId: f.queryId,
				queryName: f.queryName,
				modelId: f.modelId
			});
			d._doWhenModelLoaded(function() {
				c.ajax({
					type: "POST",
					url: a.client.loadQueryUrl,
					data: e,
					dataType: "json",
					beforeSend: f.beforeSend,
					success: function(g) {
						if (g.query) {
							d.defaultQuery.setObject(g.query, f.silent)
						} else {
							d.defaultQuery.setObject(g, f.silent)
						}
						d.refreshWidgets();
						if (f.success) {
							f.success(g)
						}
					},
					error: function(g, i, h) {
						if (f.error) {
							f.error(g.status, g.responseText, "LoadQuery")
						} else {
							alert("LoadQuery error: \n" + g.responseText)
						}
					}
				})
			})
		},
		loadQueryList: function(f) {
			var d = this;
			var g = f.modelId;
			var e = this._addAntiForgeryToken({
				modelId: g
			});
			c.ajax({
				type: "GET",
				url: this.loadQueryListUrl,
				data: e,
				dataType: "json",
				beforeSend: f.beforeSend,
				success: function(h) {
					if (f.success) {
						f.success(h)
					}
				},
				error: function(h, j, i) {
					if (f.error) {
						f.error(h.status, h.responseText, "LoadQueryList")
					} else {
						alert("LoadQueryList error: \n" + h.responseText)
					}
				}
			})
		},
		removeQuery: function(e) {
			var f = this.getQuery();
			e = e || {};
			e.queryId = e.queryId || f.getId();
			var d = this._addAntiForgeryToken({
				queryId: e.queryId
			});
			self = this;
			c.ajax({
				type: "POST",
				url: a.client.removeQueryUrl,
				data: d,
				dataType: "json",
				beforeSend: e.beforeSend,
				success: function(g) {
					f.setId(null);
					f.clear(true);
					if (e.success) {
						e.success(g)
					}
				},
				error: function(g, i, h) {
					if (e.error) {
						e.error(g.status, g.responseText, "SaveQuery")
					} else {
						alert("RemoveQuery error: \n" + g.responseText)
					}
				}
			})
		},
		clearQuery: function() {
			var d = this;
			var e = this.getQuery();
			e.clear()
		},
		saveQuery: function(e) {
			e = e || {};
			e.query = e.query || this.getQuery();
			var f, g;
			if (e.query) {
				f = e.query.getId();
				g = e.query.getName()
			}
			f = e.queryId || f;
			g = e.queryName || g;
			if (e.query) {
				var d = this._addAntiForgeryToken({
					queryJson: e.query.toJSON(),
					queryName: g,
					queryId: f
				});
				self = this;
				c.ajax({
					type: "POST",
					url: a.client.saveQueryUrl,
					data: d,
					dataType: "json",
					beforeSend: e.beforeSend,
					success: function(h) {
						if (h.query) {
							self.defaultQuery.setObject(h.query)
						}
						self.refreshWidgets();
						if (e.success) {
							e.success(h)
						}
					},
					error: function(h, j, i) {
						if (e.error) {
							e.error(h.status, h.responseText, "SaveQuery")
						} else {
							alert("SaveQuery error: \n" + h.responseText)
						}
					}
				})
			}
		},
		buildQuery: function(f) {
			f = f || {};
			f.query = f.query || this.getQuery();
			if (f.query) {
				var e = f.options || {};
				var d = this._addAntiForgeryToken({
					queryJson: f.query.toJSON(),
					optionsJson: JSON.stringify(e)
				});
				c.ajax({
					type: "POST",
					url: a.client.buildQueryUrl,
					data: d,
					dataType: "json",
					beforeSend: f.beforeSend,
					success: function(g) {
						if (f.success) {
							f.success(g)
						}
					},
					error: function(g, i, h) {
						if (f.error) {
							f.error(g.status, g.responseText, "BuildQuery")
						} else {
							alert("BuildQuery error: \n" + g.responseText)
						}
					}
				})
			}
		},
		syncQuery: function(f) {
			f = f || {};
			f.query = f.query || this.getQuery();
			if (f.query) {
				var g = b.easyQuerySettings ? b.easyQuerySettings.syncQueryOptions : null;
				var e = f.options || g || {};
				var d = this._addAntiForgeryToken({
					queryJson: f.query.toJSON(),
					optionsJson: JSON.stringify(e)
				});
				c.ajax({
					type: "POST",
					url: a.client.syncQueryUrl,
					data: d,
					dataType: "json",
					beforeSend: f.beforeSend,
					success: function(h) {
						if (f.success) {
							f.success(h)
						}
					},
					error: function(h, j, i) {
						if (f.error) {
							f.error(h.status, h.responseText, "SyncQuery")
						} else {
							alert("SyncQuery error: \n" + h.responseText)
						}
					}
				})
			}
		},
		buildAndExecute: function(g) {
			var d = this;
			g = g || {};
			g.query = g.query || this.getQuery();
			var f = g.options || {};
			var e = this._addAntiForgeryToken({
				queryJson: g.query.toJSON(),
				optionsJson: JSON.stringify(f),
				randomSelect: randomSelect,
				txtNthSelectRandom: txtNthSelectRandom,
				txtTopNRandom: txtTopNRandom
			});
			c.ajax({
				type: "POST",
				url: d.executeQueryUrl,
				data: e,
				dataType: "json",
				beforeSend: g.beforeSend,
				success: function(h) {
					if (g.success) {
						g.success(h)
					}
				},
				error: function(h, j, i) {
					if (g.error) {
						g.error(h.status, h.responseText, "ExecuteQuery")
					} else {
						//alert("ExecuteQuery error: \n" + h.responseText)
					}
					if (h.status == '403' || h.status == '500') {
					    //session 
					    alert("session expire");
					    window.location.href = "O2Home/Index"
					} else {
					    alert("SQL Statment error.Try another SQL statment.");
					    //alert(h);
					    //window.location.href = "O2Home/Index"
					}
				}
			})
		}
	}
})(jQuery, window);
var poweredByOption = {
	show: false
};
(function(a, b) {
	a.widget("eqjs.ConditionRow", {
		_condition: null,
		_parentPredicate: null,
		_parentPredicateWidget: null,
		_buttonsBlock: null,
		_enableButton: null,
		_deleteButton: null,
		_addConditionButton: null,
		_addPredicateButton: null,
		_checkBox: null,
		_keepShowingButtons: false,
		_isMouseOverBlock: false,
		_active: false,
		options: {
			queryPanel: null
		},
		getQuery: function() {
			return this.options.queryPanel.getQuery()
		},
		getModel: function() {
			var c = this.getQuery();
			return c ? c.getModel() : null
		},
		getCondition: function() {
			return this._condition
		},
		getQueryPanel: function() {
			return this.options.queryPanel
		},
		makeActive: function() {
			var c = this.getQueryPanel();
			if (c) {
				c.setActiveConditionWidget(this)
			}
		},
		init: function(e, d, c) {
			this.element.get(0).condition = e;
			this._condition = e;
			this._parentPredicate = d;
			this._parentPredicateWidget = c;
			this.refresh();
			if (this._condition.initAsActive) {
				this.makeActive();
				delete this._condition.initAsActive
			}
		},
		_render: function() {
			this._clear();
			if (this.getModel() && this._condition) {
				this._refreshByCondition();
				if (!this._condition.readOnly) {
					this._initButtons();
					this._initCheckbox();
					if (this.options.queryPanel.options.activeCondition == this._condition) {
						this.makeActive()
					}
				}
			}
		},
		refresh: function() {
			this._render()
		},
		_isDisabled: function() {
			return this._condition.enabled === false
		},
		_setOption: function(c, d) {
			if (arguments.length == 2) {
				if (c === "disabled") {
					this._setConditionEnable(!d)
				} else {
					this.options[c] = d;
					this._render()
				}
				return this
			} else {
				if (c === "disabled") {
					return this._isDisabled()
				} else {
					return this.options[c]
				}
			}
		},
		_setConditionEnable: function(c, d) {
			if (this._parentPredicate) {
				if (!c || !("enabled" in this._parentPredicate) || this._parentPredicate.enabled) {
					this._setConditionEnableCore(this._condition, c, d);
					if (!c) {
						this._enableButton.removeClass("enabled")
					} else {
						this._enableButton.addClass("enabled")
					}
					this._render();
					this._fireConditionChange("change", this._condition)
				}
			}
		},
		_setConditionEnableCore: function(c, d, e) {
			c.enabled = d;
			if (c.conditions && !e) {
				var f = c.conditions.length;
				for (var g = 0; g < f; g++) {
					this._setConditionEnableCore(c.conditions[g], d)
				}
			}
			if (this._parentPredicateWidget) {
				this._parentPredicateWidget._checkAllDisabled()
			}
		},
		_clear: function() {
			this.element.html("");
			this.element.removeClass()
		},
		_refreshByCondition: function() {},
		_fireConditionChange: function(c, f, e) {
			var d = this;
			this.getQuery().fireChangedEvent({
				source: d.options.queryPanel,
				changeType: "condition." + c,
				condition: f,
				element: e || d.element
			})
		},
		remove: function() {
			var c = this;
			if (!c._parentPredicateWidget) {
				return
			}
			c._parentPredicateWidget.removeCondition(c._condition)
		},
		isPredicate: function() {
			return false
		},
		_getButtonsContainer: function() {
			return this.element
		},
		_initButtons: function() {
			var e = this;
			var d = e._getButtonsContainer();
			var c;
			if (!d) {
				return
			}
			e._buttonsBlock = a("<div></div>").addClass("eqjs-qp-condition-buttonsBlock").appendTo(d);
			c = a("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock);
			e._addConditionButton = a("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-addCondition").attr("title", EQ.core.getText("ButtonAddCondition")).appendTo(c).click(function(f) {
				e._keepShowingButtons = true;
				e.options.queryPanel.showEntitiesMenu({
					anchor: e._addConditionButton,
					selectedIds: null,
					itemSelectedCallback: function(g, j) {
						var i = j.menuItem.data("id");
						var h = e.getModel().getAttributeById(i);
						if ("addNewCondition" in e) {
							e.addNewCondition(i)
						}
					},
					menuClosesCallback: function() {
						e._keepShowingButtons = false;
						if (!e._isMouseOverBlock) {
							e._leaveButtonBlock()
						}
					}
				})
			});
			c = a("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock);
			e._addPredicateButton = a("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-addPredicate").attr("title", EQ.core.getText("ButtonAddPredicate")).appendTo(c).click(function() {
				if ("addNewPredicate" in e) {
					e.addNewPredicate()
				}
			});
			c = a("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock);
			e._enableButton = a("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-enable").attr("title", EQ.core.getText("ButtonEnable")).appendTo(c).click(function() {
				e.option("disabled", !e._isDisabled());
				e._enableButton.trigger("mouseover")
			});
			c = a("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock);
			e._deleteButton = a("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-delete").attr("title", EQ.core.getText("ButtonDelete")).appendTo(c).click(function() {
				e.remove()
			});
			if (e._isDisabled()) {
				e._enableButton.removeClass("enabled")
			} else {
				e._enableButton.addClass("enabled")
			}
			d.find("[class*=eqjs-qp-condition-button]").hover(function() {
				a(this).addClass("eqjs-qp-condition-button-active")
			}, function() {
				a(this).removeClass("eqjs-qp-condition-button-active")
			});
			d.bind("mouseenter", function(f) {
				e._isMouseOverBlock = true;
				e._enterButtonBlock();
				f.stopPropagation();
				return false
			}).bind("mouseleave", function(f) {
				e._isMouseOverBlock = false;
				if (!e._keepShowingButtons && e._buttonsBlock.is(":visible")) {
					e._leaveButtonBlock()
				}
				f.stopPropagation();
				return false
			});
			e._hideButtons();
			e._adjustButtonsVisibility()
		},
		_initCheckbox: function() {
			var d = this;
			var c = d._getButtonsContainer();
			if (!c) {
				return
			}
			if (d.options.queryPanel.options.showCheckboxes) {
				d._checkBox = a("<div></div>").addClass("eqjs-qp-condelement eqjs-qp-condition-checkbox").attr("title", EQ.core.getText("ButtonEnable")).prependTo(c).click(function() {
					d.option("disabled", !d._isDisabled());
					d._adjustCheckbox();
					d._checkBox.trigger("mouseover")
				});
				d._adjustCheckbox()
			}
		},
		_isFirstConditionInGroup: function() {
			var c = this._parentPredicate ? a.inArray(this._condition, this._parentPredicate.conditions) : 0;
			return (c == 0)
		},
		_renderConjunction: function() {
			var f = this;
			var e = f._getButtonsContainer();
			if (!e) {
				return
			}
			if (f.options.queryPanel.options.showConjunctions && !f._isFirstConditionInGroup()) {
				var c = f._parentPredicate.linkType;
				var d = EQ.core.getText("Conj" + c);
				if (d) {
					f._conjuction = a("<span>" + d + "</span>").addClass("eqjs-qp-condelement eqjs-qp-condition-conjuction").prependTo(e)
				}
			}
		},
		_adjustCheckbox: function() {
			var c = this;
			if (!c._checkBox) {
				return
			}
			if (c._condition.enabled === false) {
				c._checkBox.removeClass("enabled")
			} else {
				c._checkBox.addClass("enabled")
			}
		},
		_adjustButtonsVisibility: function() {},
		_enterButtonBlock: function() {
			this._showButtons()
		},
		_leaveButtonBlock: function() {},
		_showButtons: function() {},
		_hideButtons: function() {
			if (this._addConditionButton) {
				this._addConditionButton.hide()
			}
			if (this._addPredicateButton) {
				this._addPredicateButton.hide()
			}
			if (this._enableButton) {
				this._enableButton.hide()
			}
			if (this._deleteButton) {
				this._deleteButton.hide()
			}
		},
		internalActivate: function() {
			this._active = true;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		internalDeactivate: function() {
			this._active = false;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		adjustActiveClass: function() {
			if (this._active && this.options.queryPanel.options.accentActiveCondition) {
				this.element.addClass("active")
			} else {
				this.element.removeClass("active")
			}
		},
		isActive: function() {
			return this._active
		},
		getLevel: function() {
			if (this._parentPredicateWidget) {
				return this._parentPredicateWidget.getLevel() + 1
			} else {
				return 0
			}
		},
		_renderLevelOffset: function() {
			var e = this.getLevel();
			var d;
			for (var c = 0; c < e - 1; c++) {
				d = a("<div></div>").addClass("eqjs-qp-level-offset").prependTo(this._getButtonsContainer())
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ConditionRow_SMPL", a.eqjs.ConditionRow, {
		_refreshByCondition: function() {
			if (!this._condition || !this.getModel()) {
				return
			}
			var q = this;
			q.options.disabled = !q._condition.enabled || q._condition.readOnly;
			this.element.addClass("eqjs-qp-row eqjs-qp-row-condition");
			if (this._condition.enabled === false) {
				this.element.addClass("eqjs-qp-disabled")
			}
			if (this._condition.readOnly) {
				this.element.addClass("eqjs-qp-readonly")
			}
			if (this._condition.justAdded) {
				this._updateValueExpressions();
				this._condition.justAdded = false
			}
			var e = q.getModel().getOperatorById(q._condition.operatorID);
			var d = EQ.core.parseOperatorFormat(e);
			var o = null;
			var k = d.length;
			for (var l = 0; l < k; l++) {
				o = d[l];
				var f, g;
				if (o.type === "operator") {
					if (this._condition.enabled !== false && !this._condition.readOnly) {
						g = a("<a></a>", {
							href: "javascript:void(0)",
							text: o.text
						})
					} else {
						g = a("<span></span>", {
							text: o.text
						})
					}
					var c = a("<div></div>");
					c.addClass("eqjs-qp-condelement eqjs-qp-operelement");
					g.appendTo(c);
					c.appendTo(this.element);
					if (this._condition.enabled !== false && !this._condition.readOnly) {
						var j = q._createOperatorsMenu(g);
						g.click(function(r) {
							r.preventDefault();
							j.PopupMenu("showMenu", {
								anchor: g
							})
						})
					}
				} else {
					if (o.type === "expression") {
						if (o.index === 0) {
							var i = this._createAttrElement(this._condition.expressions[0], function(s) {
								var r = s.operators[0];
								q._condition.operatorID = r;
								q._updateValueExpressions()
							});
							i.appendTo(this.element)
						} else {
							var n;
							var h = this._condition.expressions[o.index];
							if (h.kind === "Attribute") {
								n = this._createAttrElement(h);
								n.appendTo(this.element)
							} else {
								n = a("<div></div>");
								n.appendTo(this.element);
								this._createValueEditor(n, h, o.index)
							}
						}
					} else {
						if (o.type === "text") {
							var m = a("<span></span>").addClass("eqjs-qp-condelement").text(o.text).appendTo(this.element)
						}
					}
				}
			}
			if (q.options.queryPanel.options.accentActiveCondition) {
				q.element.click(function() {
					if (!q._active) {
						q.makeActive()
					}
				})
			}
			q.adjustActiveClass();
			q._adjustCheckbox();
			this._renderConjunction();
			this._renderLevelOffset()
		},
		_createAttrElement: function(g, i) {
			var k = this;
			var e = this.getModel();
			var f = a("<div></div>");
			var d = g.id;
			var h = d ? this.getModel().getAttributeById(d) : null;
			var c;
			var j = k.options.queryPanel.options.attrElementFormat;
			if (this._condition.enabled !== false && !this._condition.readOnly) {
				attrText = h ? e.getAttributeText(h, j) : EQ.core.getText("MsgEmptyAttrValue");
				c = a('<a href="javascript:void(0)">' + attrText + "</a>");
				c.click(function(l) {
					l.preventDefault();
					k.options.queryPanel.showEntitiesMenu({
						anchor: c,
						selectedIds: null,
						itemSelectedCallback: function(m, q) {
							var o = q.menuItem.data("id");
							var n = k.getModel().getAttributeById(o);
							g.id = o;
							if (i) {
								i(n)
							}
							k.refresh();
							k._fireConditionChange("change", k._condition);
							return false
						},
						itemFilterCallback: function(m) {
							return EQ.core.areCompatibleDataTypes(g.dataType, m.dataType)
						}
					})
				})
			} else {
				c = a("<span>" + e.getAttributeText(h, j) + "</span>")
			}
			f.addClass("eqjs-qp-condelement eqjs-qp-attrelement");
			c.appendTo(f);
			return f
		},
		_getOperatorCaption: function(d) {
			var c = EQ.core.getText("Operators", d.id, "caption");
			if (!c) {
				c = d.caption
			}
			return c
		},
		_operatorChanged: function(c, e) {
			var d = this;
			d._updateValueExpressions(c);
			d.refresh();
			d._fireConditionChange("change", d._condition)
		},
		_areCompatibleTypes: function(d, c) {
			if (typeof(d.dataType) === "undefined") {
				return true
			}
			return (d.dataType == c.dataType) && (d.kind == c.kind)
		},
		_areCompatibleEditors: function(d, c) {
			if (!d || !c) {
				if (d == c) {
					return true
				} else {
					return false
				}
			}
			if (d == c) {
				return true
			}
			if (d.type == c.type) {
				if (d.type == "EDIT" || d.type == "DATETIME") {
					return true
				}
				if (d.type == "CUSTOMLIST" && d.name == c.name) {
					return true
				}
				if (d.id == c.id) {
					return true
				}
			}
			return false
		},
		_updateValueExpressions: function(s) {
			var t = this;
			var d = t._condition.expressions[0].id;
			var e = this.getModel().getAttributeById(d);
			if (!e) {
				return
			}
			var c = t._condition.operatorID;
			var f = this.getModel().getOperatorById(c);
			if (!f) {
				return
			}
			var h = t._condition.expressions.length;
			var n;
			var l;
			var o;
			if (s) {
				l = this.getModel().getOperatorById(s)
			}
			var k = 1;
			while (k < f.paramCount) {
				n = t.getModel().getOperand(e, f, k);
				if (l) {
					o = t.getModel().getOperand(e, l, k)
				}
				if (!n.dataType || n.dataType == "Unknown") {
					n.dataType = e.dataType
				}
				if (k >= h) {
					t._condition.expressions.push(t._createValueExpression(n))
				} else {
					var r = a.extend({}, t._condition.expressions[k]);
					var j = t._createValueExpression(n);
					var g;
					if (o) {
						g = t._createValueExpression(o).value
					}
					t._condition.expressions[k] = j;
					var m = t._getExprEditor(r, k, s);
					var q = t._getExprEditor(j, k);
					if ((!g || g != r.value) && t._areCompatibleEditors(m, q)) {
						t._tryToAssignExprValue(j, r)
					}
				}
				k++
			}
			if (h > k) {
				t._condition.expressions.splice(k, h - k)
			}
		},
		_tryToAssignExprValue: function(c, d) {
			if (!d.value || d.value == "") {
				return
			}
			if (this._areCompatibleTypes(d, c)) {
				c.value = d.value
			}
		},
		_createValueExpression: function(d) {
			var e = this;
			var f;
			if (d.kind === "Query") {
				f = {
					typeName: "QUERY",
					dataType: d.dataType,
					kind: d.kind,
					value: EQ.core.getEmptyQueryObject(),
					text: ""
				}
			} else {
				if (d.kind === "Attribute") {
					var c = e.getModel().getFirstAttributeByFilter(function(i) {
						return i.uic == true && (!d.dataType || i.dataType == d.dataType)
					});
					var h = c ? c.id : null;
					f = {
						typeName: "ENTATTR",
						dataType: d.dataType,
						kind: d.kind,
						id: h,
						value: h,
						text: ""
					}
				} else {
					if (d.editor && d.editor.type == "DATETIME") {
						if (d.dataType == "Time") {
							d.editor.type = "TIME"
						}
						if (d.dataType == "Date") {
							d.editor.type = "DATE"
						}
					}
					var g;
					if (d.defValue && d.defValue != "") {
						g = d.defValue
					} else {
						if (d.editor && d.editor.defValue) {
							g = d.editor.defValue
						} else {
							g = ""
						}
					}
					f = {
						typeName: "CONST",
						dataType: d.dataType,
						kind: d.kind,
						value: g,
						text: ""
					}
				}
			}
			return f
		},
		_createOperatorsMenu: function(e) {
			var j = this;
			if (!j._condition || !j.getModel()) {
				return
			}
			var g = [];
			var f = j.getModel().getAttributeById(j._condition.expressions[0].id);
			if (f) {
				var d = null;
				var c = f.operators.length;
				for (var i = 0; i < c; i++) {
					d = j.getModel().findOperatorById(f.operators[i]);
					if (d && !(j.options.queryPanel.options.isSubQuery && d.kind === "Query")) {
						var k = j._getOperatorCaption(d);
						g.push({
							id: d.id,
							text: k
						})
					}
				}
			}
			var h = a("<div></div>").appendTo(e.parent()).hide();
			h.PopupMenu({
				items: g,
				onMenuItemSelected: function(l, n) {
					e.text(n.menuItem.text);
					var m = j._condition.operatorID;
					j._condition.operatorID = n.menuItem.id;
					j._operatorChanged(m, j._condition.operatorID);
					return false
				}
			});
			return h
		},
		_getExprEditor: function(i, e, d) {
			var h = this._condition.expressions[0].id;
			var g = this.getModel().getAttributeById(h);
			d = d || this._condition.operatorID;
			var c = this.getModel().getOperand(g, this.getModel().getOperatorById(d), e);
			var f;
			if (c && c.editor && c.editor.type !== "Unknown") {
				f = a.extend({}, c.editor)
			} else {
				if (g && g.defaultEditor) {
					f = a.extend({}, g.defaultEditor)
				}
			}
			if (i && i.kind === "Query") {
				f.type = "SUBQUERY"
			}
			if (!f.type || f.type == "Unknown") {
				f.type = "EDIT"
			}
			return f
		},
		_createValueEditor: function(f, i, d) {
			var c = this;
			var h = c._getExprEditor(i, d);
			if (h) {
				var g = "element.ValueEditor_" + h.type + "({conditionWidget:self, editor: editorObj, onChange:changeCallback}); element.ValueEditor_" + h.type + "('init', expr);";
				var j = new Function("self, element, expr, editorObj, changeCallback", g);
				var e = function() {
						c._fireConditionChange("change", c._condition)
					};
				j(this, f, i, h, e)
			}
		},
		_showButtons: function() {
			if (!this.options.queryPanel.options.showCheckboxes && this._enableButton) {
				this._enableButton.show()
			}
			if (this._deleteButton) {
				this._deleteButton.show()
			}
		},
		_adjustButtonsVisibility: function() {
			if (this.options.queryPanel.options.alwaysShowButtonsInConditions || (this.options.queryPanel.options.accentActiveCondition && this._active)) {
				this._showButtons()
			}
		},
		_leaveButtonBlock: function() {
			if (this.options.queryPanel.options.alwaysShowButtonsInConditions != true && (!this._active || this.options.queryPanel.options.accentActiveCondition != true)) {
				this._hideButtons()
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ConditionRow_PDCT", a.eqjs.ConditionRow, {
		_predicateRowBlock: null,
		_getButtonsContainer: function() {
			return this._predicateRowBlock
		},
		_parsePredicateText: function(e, h) {
			var k = this;
			var d = function() {
					k.refresh();
					k._fireConditionChange("change", k._condition)
				};
			var c = EQ.core.getText(h);
			var f = c.indexOf("{lt}");
			if (f < 0) {
				e.text(EQ.core.getText("ErrIncorrectPredicateTitleFormat"));
				e.addClass("eqjs-qp-error")
			} else {
				if (f > 0) {
					var i = a("<span></span>").addClass("eqjs-qp-predelement").text(c.substring(0, f)).appendTo(e)
				}
				var j = a("<div></div>");
				j.PredicateLinkType({
					queryPanel: k.options.queryPanel,
					conditionWidget: k,
					onChange: d
				});
				j.PredicateLinkType("init", k._condition);
				j.appendTo(e);
				var g = a("<span></span>").addClass("eqjs-qp-predelement").text(c.substring(f + 4)).appendTo(e)
			}
		},
		_refreshPredicateRow: function() {
			var c = this;
			if (!c._predicateRowBlock) {
				return
			}
			c._predicateRowBlock.html("");
			c._predicateRowBlock.addClass("eqjs-qp-row eqjs-qp-row-predicate");
			if (c._condition.enabled === false) {
				c._predicateRowBlock.addClass("eqjs-qp-disabled")
			}
			c._parsePredicateText(c._predicateRowBlock, "PredicateTitle");
			if (c.options.queryPanel.options.accentActiveCondition) {
				c._predicateRowBlock.click(function() {
					if (!c._active) {
						c.makeActive()
					}
				})
			}
			c.adjustActiveClass();
			this._renderConjunction();
			this._renderLevelOffset()
		},
		_refreshByCondition: function() {
			var c = this;
			c.element.addClass("eqjs-qp-predicate");
			c._predicateRowBlock = a("<div></div>");
			c._predicateRowBlock.appendTo(c.element);
			c._refreshPredicateRow();
			c._addConditions(c.element)
		},
		_addConditions: function(e) {
			var c = a("<div></div>");
			c.addClass("eqjs-qp-conditions");
			c.appendTo(e);
			var h = this._condition.conditions.length;
			for (var j = 0; j < h; j++) {
				var d = a("<div></div>");
				d.appendTo(c);
				var g = this._condition.conditions[j];
				var f = "element.ConditionRow_" + g.typeName + "({queryPanel: self.options.queryPanel, model: self.getModel()}); element.ConditionRow_" + g.typeName + "('init', self._condition.conditions[idx], self._condition, self);";
				var i = new Function("self, element, idx", f);
				i(this, d, j)
			}(!c.children().length) ? c.hide() : c.show();
			return c
		},
		_checkAllDisabled: function() {
			if (this._parentPredicate) {
				var c = true;
				var d = this._condition.conditions.length;
				for (var e = 0; e < d; e++) {
					if (this._condition.conditions[e].enabled) {
						c = false;
						break
					}
				}
				if (c) {
					this._setConditionEnable(false, true)
				}
			}
		},
		_moveDraggedItem: function(e, d, c) {},
		isPredicate: function() {
			return true
		},
		_containsActiveCondition: function(c) {
			var e = this;
			var d = c || e._condition;
			var f = e.options.queryPanel._activeConditionWidget;
			if (f) {
				f = f.getCondition()
			}
			return e.options.queryPanel.predicateContainsCondition(d, f)
		},
		removeCondition: function(e) {
			var c = this;
			var d = a.inArray(e, c._condition.conditions);
			if (d >= 0) {
				if (c._condition.conditions.length == 1 && c._parentPredicate) {
					c.remove()
				} else {
					if (e == c.options.queryPanel.options.activeCondition) {
						c.makeActive()
					}
					c._condition.conditions.splice(d, 1);
					c.refresh();
					c._fireConditionChange("delete", e)
				}
			}
		},
		addCondition: function(e, d) {
			var c = this;
			if (!e || (a.isArray(e) && e.length == 0)) {
				return
			}
			if (typeof d == "number") {
				c._condition.conditions.push.apply(c._condition.conditions, [d, 0].concat(e))
			} else {
				c._condition.conditions.push.apply(c._condition.conditions, [].concat(e))
			}
			e.initAsActive = true;
			c.refresh();
			c._fireConditionChange("add", e)
		},
		addNewCondition: function(e, l, h) {
			var n = this;
			var c, m, j, o;
			var k = function(i, q) {
					if (!i) {
						return null
					}
					if (!i.uic) {
						return null
					}
					return {
						justAdded: true,
						typeName: "SMPL",
						enabled: true,
						operatorID: q,
						expressions: [{
							kind: "Attribute",
							typeName: n.options.queryPanel.options.attrClassName,
							id: i.id
						}]
					}
				};
			var g = n.getModel();
			if (a.isArray(e)) {
				m = [];
				var d = e.length;
				for (var f = 0; f < d; f++) {
					c = g.getAttributeById(e[f]);
					if (!c) {
						continue
					}
					o = l ? l : g.getDefaultOperatorIdForAttr(c);
					j = k(c, o);
					if (j) {
						m.push(j)
					}
				}
			} else {
				c = g.getAttributeById(e);
				if (!c) {
					return
				}
				o = l ? l : g.getDefaultOperatorIdForAttr(c);
				m = k(c, o)
			}
			n.addCondition(m, h);
			return m
		},
		addNewPredicate: function() {
			var f = this;
			var h = f.getModel().getFirstUICAttr();
			var g = h ? h.id : -1;
			var e = h ? h.operators[0] : -1;
			var i = {
				justAdded: true,
				typeName: "SMPL",
				enabled: true,
				operatorID: e,
				expressions: [{
					typeName: f.options.queryPanel.options.attrClassName,
					id: g,
					kind: "Attribute"
				}]
			};
			var d = f._condition.linkType === "All" ? "Any" : "All";
			var c = {
				typeName: "PDCT",
				linkType: d,
				conditions: []
			};
			c.conditions.push(i);
			this.addCondition(c)
		},
		_showButtons: function() {
			if (this._condition.enabled != false) {
				if (this._addConditionButton) {
					this._addConditionButton.show()
				}
				if (this._addPredicateButton) {
					this._addPredicateButton.show()
				}
			}
			if (!this.options.queryPanel.options.showCheckboxes && this._enableButton) {
				this._enableButton.show()
			}
			if (this._deleteButton) {
				this._deleteButton.show()
			}
		},
		_adjustButtonsVisibility: function() {
			if (this.options.queryPanel.options.alwaysShowButtonsInPredicates || (this.options.queryPanel.options.accentActiveCondition && this._active)) {
				this._showButtons()
			}
		},
		_leaveButtonBlock: function() {
			if (this.options.queryPanel.options.alwaysShowButtonsInPredicates != true && (!this._active || this.options.queryPanel.options.accentActiveCondition != true)) {
				this._hideButtons()
			}
		},
		internalActivate: function() {
			this._active = true;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		internalDeactivate: function() {
			this._active = false;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		adjustActiveClass: function() {
			if (this._active && this.options.queryPanel.options.accentActiveCondition) {
				this._predicateRowBlock.addClass("active")
			} else {
				this._predicateRowBlock.removeClass("active")
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.RootPredicate", a.eqjs.ConditionRow_PDCT, {
		_showButtons: function() {
			if (this._addConditionButton) {
				this._addConditionButton.show()
			}
			if (this._addPredicateButton) {
				this._addPredicateButton.show()
			}
		},
		_initCheckbox: function() {},
		_renderConjunction: function() {},
		_refreshPredicateRow: function() {
			var c = this;
			if (!c._predicateRowBlock) {
				return
			}
			c._predicateRowBlock.html("");
			c._predicateRowBlock.addClass("eqjs-qp-row eqjs-qp-row-predicate eqjs-qp-row-predicate-root");
			c._parsePredicateText(c._predicateRowBlock, "RootPredicateTitle");
			if (c.options.queryPanel.options.accentActiveCondition) {
				c._predicateRowBlock.click(function() {
					if (!c._active) {
						c.makeActive()
					}
				})
			}
			c.adjustActiveClass()
		},
		_refreshByCondition: function() {
			var c = this;
			c.element.addClass("eqjs-qp-predicate eqjs-qp-predicate-root");
			var e = 0;
			if (c.options.queryPanel && c.options.queryPanel.options.showRootRow) {
				c._predicateRowBlock = a("<div></div>");
				c._predicateRowBlock.appendTo(c.element);
				c._refreshPredicateRow();
				e += c._predicateRowBlock.outerHeight()
			}
			var g = c._addConditions(c.element);
			if (c.options.queryPanel.options.showAddRow) {
				var f = c.options.queryPanel.addRowHeight;
				e += f + 9
			}
			var d = c.options.queryPanel.element.innerHeight();
			if (g) {
				g.css({
					"max-height": (d - e) + "px"
				})
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.QueryPanel", {
		_activeConditionWidget: null,
		_rootPredicateWidget: null,
		_query: null,
		_defaultMenuOptions: {
			showSearchBoxAfter: 30,
			activateOnMouseOver: true
		},
		options: {
			isSubQuery: false,
			activeCondition: null,
			listRequestHandler: null,
			entitiesPopupHandler: null,
			entitiesListFilter: null,
			menuContainer: document.body,
			showRootRow: true,
			showAddRow: true,
			showCheckboxes: false,
			showPoweredBy: true,
			alwaysShowButtonsInPredicates: false,
			alwaysShowButtonsInConditions: false,
			showConjunctions: true,
			accentActiveCondition: true,
			activateRootOnStart: true,
			dateFormatValue: "",
			dateFormatDisplay: "d MM, yy",
			attrElementFormat: "{entity} {attr}",
			menuOptions: {
				showSearchBoxAfter: 30,
				activateOnMouseOver: true
			},
			subQueryDialogWidth: 600,
			subQueryDialogHeight: 300,
			dialogZIndex: 100000,
			numberDecimalSeparatorDisplay: ".",
			numberListSeparators: [",", ";"],
			autoEditNewCondition: false,
			attrClassName: "ENTATTR",
			defaultQuery: {
				root: {
					linkType: "All",
					enabled: true,
					conditions: []
				},
				columns: [],
				justsorted: []
			}
		},
		addRowHeight: 0,
		getSelf: function() {
			return this
		},
		getQuery: function() {
			return this._query
		},
		setQuery: function(d) {
			if (d && d.getObject) {
				this._setQueryObserver(true);
				this._query = d;
				this._setQueryObserver();
				this.refresh()
			} else {
				if (d) {
					var c = this.getQuery();
					c.setObject(d)
				} else {
					this._setQueryObserver(true);
					this._query = null
				}
			}
		},
		isQueryNullOrEmpty: function() {
			var c = this.getQuery();
			return !c || c.isEmptyConditions()
		},
		getModel: function() {
			var c = this.getQuery();
			return c ? c.getModel() : null
		},
		isModelNullOrEmpty: function() {
			var c = this.getModel();
			return !c || c.isEmpty()
		},
		_updateLists: function() {
			var c = EQ.core.constLists;
			for (var d in c) {
				if (c.hasOwnProperty(d)) {
					this._updateList(c[d])
				}
			}
			this._updateList(EQ.core.predicateLinkTypeList)
		},
		_updateList: function(d) {
			if (!d) {
				return
			}
			var e = d.length;
			for (var c = 0; c < e; c++) {
				d[c].text = EQ.core.getText(d[c].key);
				if (!d[c].text) {
					d[c].text = d[c].key
				}
			}
		},
		_create: function() {
			var c = this;
			if (typeof(poweredByOption) == "undefined") {
				poweredByOption = {}
			}
		},
		_render: function() {
			var e = this;
			e._clear();
			e._updateLists();
			e.element.addClass("eqjs-qp-panel");
			if (!e.isModelNullOrEmpty()) {
				e.options.entitiesList = e.getEntitiesList({
					addUIC: true,
					addUIR: false,
					addUIS: false
				});
				e.options.entitiesMenu = e._createEntitiesMenu();
				var g = a("<div></div>");
				g.appendTo(e.element);
				if (e.options.showAddRow) {
					var d = a('<div class="eqjs-addrow eqjs-qp-addrow"></div>');
					d.appendTo(e.element);
					if (!e.options.showRootRow && (!e.isQueryNullOrEmpty())) {
						d.addClass("eqjs-addrow-empty")
					}
					var h = a('<a href="javascript:void(0)">' + EQ.core.getText("CmdClickToAddCondition") + "</a>");
					h.appendTo(d);
					h.click(function(i) {
						i.preventDefault();
						e.showEntitiesMenu({
							anchor: h,
							selectedIds: null,
							itemSelectedCallback: function(j, l) {
								var k = l.menuItem.data("id");
								e.addNewCondition(k);
								return false
							}
						})
					});
					e.addRowHeight = d.outerHeight()
				}
				e._refreshByQuery(g)
			}
			e.element.droppable({
				hoverClass: "eqjs-drophover",
				scope: "entityAttr",
				drop: function(i, j) {
					e.addNewCondition(j.draggable.data("id"))
				},
				over: function(j, k) {
					k.helper.addClass("eqjs-qc-column-drag");
					var i = e.getModel().getAttributeById(k.draggable.data("id"));
					if (i.uic != true) {
						k.helper.addClass("eqjs-qc-column-drag-forbidden")
					}
				},
				out: function(i, j) {
					j.helper.removeClass("eqjs-qc-column-drag");
					j.helper.removeClass("eqjs-qc-column-drag-forbidden")
				}
			});
			if (e.options.showPoweredBy || poweredByOption.show === true) {
				var c = a("<a></a>", {
					text: "",
					href: "#",
					target: "_blank",
					css: {
						color: "#4676AE",
						font: "11px Calibri",
						"text-decoration": "underline"
					}
				}).appendTo(e.element);
				var f = function() {
						c.css({
							position: "absolute",
							bottom: "-15px",
							right: "0px"
						});
						if (c.parents("div[class*=ui-dialog]").length != 0) {
							c.parents("div[class*=ui-dialog]").find(c).hide()
						}
					};
				f()
			}
		},
		_checkActivateRootPredicate: function() {
			if (this.options.activateRootOnStart) {
				this._activateRootPredicate()
			}
		},
		_activateRootPredicate: function() {
			if (this.options.showRootRow) {
				if (this._rootPredicateWidget) {
					this.setActiveConditionWidget(this._rootPredicateWidget)
				}
			}
		},
		_setOption: function(c, d) {
			if (arguments.length == 2) {
				if (c == "model") {
					this.clearQuery(false);
					this.options[c] = d;
					this._render();
					this._checkActivateRootPredicate()
				} else {
					if (c == "query") {
						this.setQuery(d)
					} else {
						if (c == "menuOptions") {
							this.options.menuOptions = a.extend({}, this._defaultMenuOptions, d)
						} else {
							if (c == "searchBoxAfter") {
								this.options[c] = d;
								this.options.menuOptions.showSearchBoxAfter = d
							} else {
								this.options[c] = d;
								this._render()
							}
						}
					}
				}
				return this
			} else {
				return this.options[c]
			}
		},
		_setQueryObserver: function(c) {
			var d = this;
			var f = this.getQuery();
			var e = function(g) {
					if (!g) {
						return
					}
					if (g.source !== d && g.changeType && g.changeType.indexOf("column") < 0) {
						d._render()
					}
					if (d.options.autoEditNewCondition && g.changeType == "condition.add") {
						d.editConditionValue(g.condition)
					}
				};
			if (f) {
				if (c) {
					f.removeChangedCallback(e)
				} else {
					f.addChangedCallback(e)
				}
			}
		},
		_clear: function() {
			this.element.html("")
		},
		_refreshByQuery: function(c) {
			c.RootPredicate({
				queryPanel: this,
				model: this.getModel()
			});
			c.RootPredicate("init", this.getQuery().getRootPredicate(), null, null);
			this._rootPredicateWidget = c.data("RootPredicate");
			if (!this._rootPredicateWidget) {
				this._rootPredicateWidget = c.data("eqjs-RootPredicate")
			}
			return c
		},
		clearConditions: function(c) {
			var d = this.getQuery();
			d.clearConditions();
			if (c !== false) {
				this.refresh()
			}
		},
		clearQuery: function(c) {
			var d = this.getQuery();
			d.clear();
			if (c !== false) {
				this.refresh()
			}
		},
		_fireQueryChange: function(c) {
			var d = this;
			var e = this.getQuery();
			e.fireChangedEvent({
				source: d,
				changeType: "query." + c
			})
		},
		_fireEntitiesPopup: function(d) {
			var c = this;
			if (this.options.entitiesPopupHandler) {
				return this.options.entitiesPopupHandler({
					query: c.getQuery(),
					items: d.items
				})
			} else {
				return false
			}
		},
		showEntitiesMenu: function(f) {
			var d = this;
			var c = d.options.entitiesMenu.PopupMenu("option", "items");
			var e = d._fireEntitiesPopup({
				items: c
			});
			if (e) {
				d.options.entitiesMenu.PopupMenu("refreshItems", c)
			}
			d.options.entitiesMenu.PopupMenu("showMenu", f)
		},
		getEntitiesList: function(d) {
			var c = this.getModel();
			var e = c.getEntitiesTree(d);
			if (this.options.entitiesListFilter) {
				this.options.entitiesListFilter(e, d)
			}
			return e
		},
		editConditionValue: function(h) {
			if (!h && !this.isQueryNullOrEmpty()) {
				h = this.getQuery().getRootPredicate().conditions[0]
			}
			if (!h) {
				return
			}
			var c = this.element.find("[class*=eqjs-qp-row-condition]").filter(function(i) {
				return (this.condition == h)
			});
			var g = c.find("[class*=eqjs-qp-valueelement]").first();
			if (g.length == 0) {
				return
			}
			var e = a(g).data();
			for (var f in e) {
				if (f.indexOf("ValueEditor_") >= 0) {
					var d = e[f];
					d.showEditor()
				}
			}
		},
		_createEntitiesMenu: function() {
			if (this.isModelNullOrEmpty()) {
				return null
			}
			var c = this;
			var e = a("<div></div>").hide().appendTo(c.element);
			var d = {
				items: c.options.entitiesList
			};
			a.extend(d, c.options.menuOptions);
			if (c.options.isSubQuery) {
				d.zIndex = c.options.dialogZIndex + 1000
			}
			e.PopupMenu(d);
			return e
		},
		addNewCondition: function(e, c) {
			var d = this;
			if (d._rootPredicateWidget) {
				return d._rootPredicateWidget.addNewCondition(e, c)
			}
			return null
		},
		addNewConditionIntoActivePredicate: function(f, d) {
			var e = this;
			if (this._activeConditionWidget) {
				var c;
				if (this._activeConditionWidget.isPredicate()) {
					c = this._activeConditionWidget
				} else {
					c = this._activeConditionWidget._parentPredicateWidget
				}
				return c.addNewCondition(f, d)
			} else {
				return this.addNewCondition(f, d)
			}
		},
		refresh: function() {
			this._render();
			this._checkActivateRootPredicate()
		},
		resize: function() {
			this._render()
		},
		setActiveConditionWidget: function(c) {
			if (this._activeConditionWidget) {
				this._activeConditionWidget.internalDeactivate();
				this.options.activeCondition = null
			}
			this._activeConditionWidget = c;
			if (this._activeConditionWidget) {
				this._activeConditionWidget.internalActivate();
				this.options.activeCondition = this._activeConditionWidget.getCondition()
			}
		},
		predicateContainsCondition: function(c, g) {
			var d = this;
			if (!c || !g) {
				return false
			}
			if (c.conditions) {
				var f = c.conditions.length;
				for (var e = 0; e < f; e++) {
					if (c.conditions[e] == g) {
						return true
					}
					if (d.predicateContainsCondition(c.conditions[e], g)) {
						return true
					}
				}
			}
			return false
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor", {
		_expr: {
			value: "",
			text: ""
		},
		_linkElement: null,
		options: {
			model: null,
			conditionWidget: null,
			editor: null,
			onChange: null
		},
		getModel: function() {
			return this.options.conditionWidget ? this.options.conditionWidget.getModel() : null
		},
		getQuery: function() {
			return this.options.conditionWidget ? this.options.conditionWidget.getQuery() : null
		},
		getCondition: function() {
			return this.options.conditionWidget ? this.options.conditionWidget.getCondition() : null
		},
		getQueryPanel: function() {
			return this.options.conditionWidget ? this.options.conditionWidget.getQueryPanel() : null
		},
		init: function(c) {
			this._expr = c;
			this._expr.value = this._adjustNewValue(c.value);
			this._adjustExprText();
			this.refresh()
		},
		getResText: function() {
			if (!EQ.core.getText) {
				return b
			}
			return EQ.core.getText.apply(this.getQueryPanel(), arguments)
		},
		_getEmptyText: function() {
			return this.getResText("MsgEmptyScalarValue")
		},
		_render: function() {
			this.clear();
			if (this.getModel() && this._expr) {
				this._renderCommonPart();
				this._renderEditor();
				var c = this._getDisplayText();
				this._linkElement.text(c);
				this._linkElement.attr("title", c)
			}
		},
		_getClassesToAdd: function() {
			return "eqjs-qp-condelement eqjs-qp-valueelement"
		},
		_renderCommonPart: function() {
			var c = this;
			c.element.addClass(c._getClassesToAdd());
			var d = this.getCondition();
			if (d.enabled !== false && !d.readOnly) {
				c._linkElement = a("<a></a>", {
					href: "javascript:void(0)",
					text: "-"
				}).appendTo(c.element);
				c._linkElement.click(function() {
					c.showEditor();
					return false
				})
			} else {
				c._linkElement = a("<span></span>", {
					text: "-"
				}).appendTo(c.element)
			}
		},
		showEditor: function() {
			if (this._beforeShowEditor()) {
				this._showEditor();
				this.options.conditionWidget.makeActive()
			}
		},
		_renderEditor: function() {},
		refresh: function() {
			this._render()
		},
		_beforeShowEditor: function() {
			return true
		},
		_showEditor: function() {},
		_setOption: function(c, d) {
			if (arguments.length == 2) {
				this.options[c] = d;
				this._render();
				return this
			} else {
				return this.options[c]
			}
		},
		clear: function() {
			if (this._linkElement) {
				this._linkElement.unbind()
			}
			this.element.removeClass();
			this.element.empty()
		},
		_setValueSilent: function(f) {
			var e = this._adjustNewValue(f);
			var d = this._validate(e);
			if (d && d.result) {
				this._expr.value = e;
				this._expr.text = f;
				this._adjustExprText();
				var c = this._getDisplayText();
				this._linkElement.text(c);
				this._linkElement.html(this._linkElement.html().replace(/ /g, "&nbsp"));
				this._linkElement.attr("title", c);
				return true
			} else {
				this._validateError(d)
			}
			return false
		},
		_setValue: function(c) {
			if (this._setValueSilent(c) && this.options.onChange) {
				this.options.onChange(this._expr.value)
			}
		},
		_validate: function(c) {
			return {
				result: true,
				message: ""
			}
		},
		_validateError: function(c) {
			alert("Invalid value!\n" + c.message)
		},
		_getValue: function() {
			return this._expr.value
		},
		_getText: function() {
			return this._expr.text
		},
		_isEmptyValue: function() {
			var c = this._getValue();
			return (typeof(c) === "undefined" || c === null || !c)
		},
		_adjustExprText: function() {
			if (this._expr.value && this._expr.value != "") {
				this._expr.text = this._expr.value
			} else {
				this._expr.text = ""
			}
		},
		_adjustNewValue: function(c) {
			return c
		},
		_getDisplayText: function() {
			this._adjustExprText();
			if (this._expr.text && this._expr.text != "") {
				return this._expr.text
			} else {
				if (this._expr.value && this._expr.value != "") {
					return this._expr.value
				} else {
					return this._getEmptyText()
				}
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor_EDIT", a.eqjs.ValueEditor, {
		_numberDecimalSeparatorValue: ".",
		_numberListSeparatorValue: ",",
		_numberDecimalSeparatorDisplay: ".",
		_numberListSeparators: [",", ";"],
		_editBox: null,
		_editBoxClass: "eqjs-qp-ve-editbox",
		_create: function() {
			var c = this.getQueryPanel();
			if (c) {
				if (c.options.numberDecimalSeparatorDisplay) {
					this._numberDecimalSeparatorDisplay = c.options.numberDecimalSeparatorDisplay
				}
				if (c.options.numberListSeparators) {
					this._numberListSeparators = c.options.numberListSeparators
				}
			}
		},
		_adjustNewValue: function(e) {
			if (e.length > 0 && this._expr.kind == "List") {
				var d = new RegExp("\\s*[" + this._numberListSeparators.join("") + "]\\s*", "i");
				var g = e.split(d);
				var f = g.length;
				for (var c = 0; c < f; c++) {
					g[c] = this._adjustScalarValue(g[c])
				}
				return g.join(this._numberListSeparatorValue)
			} else {
				return this._adjustScalarValue(e)
			}
		},
		_adjustScalarValue: function(d) {
			var c = d.split(this._numberDecimalSeparatorDisplay).join(this._numberDecimalSeparatorValue);
			return c
		},
		_renderEditor: function() {
			var c = this;
			var d = false;
			c._editBox = a("<input />", {
				type: "text",
				"class": c._editBoxClass,
				blur: function(f) {
					if (c._editBox.is(":visible") && !d) {
						c._setValue(c._editBox.val());
						c._editBox.hide();
						c._linkElement.show();
						f.stopPropagation();
						return false
					}
				},
				keydown: function(f) {
					if (f.keyCode == 13) {
						if (c._editBox.is(":visible")) {
							d = true;
							c._setValue(c._editBox.val());
							c._editBox.hide();
							c._linkElement.show();
							f.stopPropagation();
							d = false;
							return false
						}
					}
					if (f.keyCode == 27) {
						c._editBox.hide();
						c._linkElement.show();
						f.stopPropagation();
						return false
					}
				}
			}).appendTo(this.element).hide()
		},
		_checkScalarValue: function(d) {
			var c = +d;
			if (isNaN(c) || (EQ.core.isNumericType(this._expr.dataType) && (a.trim(d) != d))) {
				return {
					result: false,
					message: '"' + d + '"' + this.getResText("ErrNotNumber")
				}
			} else {
				if (EQ.core.isIntType(this._expr.dataType) && c != parseInt(d, 10)) {
					return {
						result: false,
						message: d + " - " + this.getResText("ErrIncorrectInteger")
					}
				}
			}
			return {
				result: true,
				message: ""
			}
		},
		_validate: function(f) {
			var d;
			if (EQ.core.isNumericType(this._expr.dataType)) {
				if (f.length > 0 && this._expr.kind == "List") {
					var g = f.split(/\s*,\s*/);
					var e = g.length;
					for (var c = 0; c < e; c++) {
						d = this._checkScalarValue(g[c]);
						if (!d || !d.result) {
							return {
								result: false,
								message: this.getResText("ErrIncorrectNumberList")
							}
						}
					}
					return {
						result: true
					}
				} else {
					return this._checkScalarValue(f)
				}
			} else {
				return {
					result: true
				}
			}
		},
		_getZIndex: function() {
			var c = this.getQueryPanel();
			return (c && c.options.isSubQuery) ? c.options.dialogZIndex + 1000 : 100000
		},
		_showEditor: function() {
			var c = this;
			c._linkElement.hide();
			c._editBox.val(c._getText()).css("min-width", c._linkElement.width()).show().focus()
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor_DATETIME", a.eqjs.ValueEditor_EDIT, {
		_dateFormatInternal: "yy-mm-dd",
		_dateFormatValue: "mm/dd/yy",
		_dateFormatDisplay: "d mm, yy",
		_dateValue: "",
		_timeFormatInternal: "HH:mm",
		_timeFormatValue: "HH:mm",
		_timeFormatDisplay: "HH:mm",
		_create: function() {
			var c = this.getQueryPanel();
			if (c) {
				if (c.options.dateFormatValue) {
					this._dateFormatValue = c.options.dateFormatValue
				}
				if (c.options.dateFormatDisplay) {
					this._dateFormatDisplay = c.options.dateFormatDisplay
				}
				if (c.options.timeFormatValue) {
					this._timeFormatValue = c.options.timeFormatValue
				}
				if (c.options.timeFormatDisplay) {
					this._timeFormatDisplay = c.options.timeFormatDisplay
				}
			}
			a.datepicker.setDefaults(a.datepicker.regional[EQ.client.locale]);
			a.timepicker.setDefaults(a.timepicker.regional[EQ.client.locale])
		},
		_renderEditor: function() {
			var c = this;
			c._editBox = a("<input />", {
				type: "text",
				"class": "eqjs-qp-ve-editbox"
			}).appendTo(c.element).hide();
			c._editBox.on("keydown", function(f) {
				if (f.keyCode == 27) {
					c._editBox.val(c.lastValue)
				}
			});
			if (c._expr.dataType == "Time") {
				c._editBox.timepicker({
					onClose: function(g, f) {
						if (g != "") {
							var e = c.getModel();
							var h = c._convertTime(a(this).datepicker("getDate"), c._timeFormatInternal);
							if (g != c.lastValue) {
								c._setValue(h)
							}
							c._editBox.hide()
						} else {
							c._editBox.hide();
							c._editBox.timepicker("hide")
						}
					}
				});
				if (c._timeFormatValue) {
					c._editBox.timepicker("option", "timeFormat", c._timeFormatValue)
				} else {
					c._timeFormatValue = c._editBox.datepicker("option", "timeFormat")
				}
			} else {
				if (c._expr.dataType == "Date") {
					var d = this.getModel();
					c._editBox.datepicker({
						changeMonth: true,
						changeYear: true,
						beforeShow: function() {
							c._editBox.show()
						},
						onClose: function(h, g) {
							if (h != "") {
								var f = c.getModel();
								var e = c._convertDate(a(this).datepicker("getDate"), c._dateFormatInternal);
								if (h != c.lastValue) {
									c._setValue(e)
								}
								c._editBox.hide()
							} else {
								c._editBox.hide();
								c._editBox.datepicker("hide")
							}
						}
					});
					if (c._dateFormatValue) {
						c._editBox.datepicker("option", "dateFormat", c._dateFormatValue)
					} else {
						c._dateFormatValue = c._editBox.datepicker("option", "dateFormat")
					}
				} else {
					if (c._expr.dataType == "DateTime") {
						c._editBox.datetimepicker({
							changeMonth: true,
							changeYear: true,
							beforeShow: function() {
								c._editBox.show()
							},
							onClose: function(n, j) {
								if (n != "") {
									var k = c.getModel();
									var l = c.lastValue.split(" ");
									var f = "";
									var e = "";
									f = l[0];
									if (l.length > 1) {
										e = l[1]
									}
									var o = c._convertDate(a(this).datepicker("getDate"), c._dateFormatInternal);
									var m = c._convertTime(a(this).datepicker("getDate"), c._timeFormatInternal);
									var i = "";
									var h = "";
									var g = c._expr.value.split(" ");
									if (o != c._convertDateString(f, c._dateFormatValue, c._dateFormatInternal)) {
										i = o
									} else {
										i = g[0]
									}
									if (m != c._convertTimeString(e, c._timeFormatValue, c._timeFormatInternal)) {
										h = m
									} else {
										if (g.length > 1) {
											h = g[1]
										}
									}
									if (n != c.lastValue) {
										c._setValue(a.trim(i + " " + h))
									}
									c._editBox.hide()
								} else {
									c._editBox.hide();
									c._editBox.datepicker("hide")
								}
							}
						})
					}
				}
			}
		},
		_showEditor: function() {
			var o = this;
			var j = this.getModel();
			if (o._expr.dataType == "Time") {
				var d = this._expr.value;
				var e = j.getMacroTimeValue(d);
				if (e) {
					d = this._convertTime(e, this._timeFormatInternal)
				}
				o._editBox.val(this._convertTimeString(d, this._timeFormatInternal, this._timeFormatValue))
			} else {
				if (o._expr.dataType == "Date") {
					var f = this._expr.value;
					var g = j.getMacroDateValue(f);
					if (g) {
						f = this._convertDate(g, this._dateFormatInternal)
					}
					o._editBox.val(this._convertDateString(f, this._dateFormatInternal, this._dateFormatValue))
				} else {
					if (o._expr.dataType == "DateTime") {
						var c = this._expr.value.split(" ");
						var i = this._expr.value;
						var f = "";
						var d = "";
						f = c[0];
						if (c.length > 1) {
							d = c[1]
						}
						var g = j.getMacroDateValue(f);
						if (g) {
							f = this._convertDate(g, this._dateFormatInternal)
						}
						var e = j.getMacroTimeValue(d);
						if (e) {
							d = this._convertTime(e, this._timeFormatInternal)
						}
						o._editBox.val(this._convertDateString(f, this._dateFormatInternal, this._dateFormatValue) + " " + this._convertTimeString(d, this._timeFormatInternal, this._timeFormatValue))
					}
				}
			}
			o.lastValue = o._editBox.val();
			var k = this.getQueryPanel();
			var n = (k && k.options.isSubQuery) ? k.options.dialogZIndex + 1000 : 100000;
			var h = o._linkElement.position().left;
			var m = o._linkElement.position().top;
			o._editBox.css({
				left: h,
				top: m,
				width: o._expr.dataType == "DateTime" ? "150px" : "115px",
				"min-width": o._linkElement.width(),
				position: "absolute",
				zIndex: n
			}).show().focus()
		},
		_adjustNewValue: function(g) {
			var c = this.getModel();
			if (this._expr.dataType == "Date") {
				if (c && (a.inArray(g, c.dateMacroList) >= 0)) {
					return g
				} else {
					return this._convertDateValueString(g, this._dateFormatInternal, this._dateFormatInternal)
				}
			} else {
				if (this._expr.dataType == "DateTime") {
					var f = g.split(" ");
					var d = "";
					var e = "";
					d = f[0];
					if (f.length > 1) {
						e = f[1]
					}
					if (c && (a.inArray(d, c.dateMacroList) < 0)) {
						d = this._convertDateValueString(d, this._dateFormatInternal, this._dateFormatInternal)
					}
					if (c && (a.inArray(e, c.timeMacroList) < 0)) {
						e = this._convertTimeValueString(e, this._timeFormatInternal, this._timeFormatInternal)
					}
					return a.trim(d + " " + e)
				} else {
					if (this._expr.dataType == "Time") {
						if (c && (a.inArray(g, c.timeMacroList) >= 0)) {
							return g
						} else {
							return this._convertTimeValueString(g, this._timeFormatInternal, this._timeFormatInternal)
						}
					}
				}
			}
		},
		_adjustExprText: function() {
			try {
				if (this._expr.value && this._expr.value != "") {
					if (this._expr.dataType == "Date") {
						this._expr.text = this._convertDateValueString(this._expr.value, this._dateFormatInternal, this._dateFormatDisplay)
					} else {
						if (this._expr.dataType == "DateTime") {
							var e = this._expr.value.split(" ");
							var c = this._expr.value;
							var d = "";
							if (e.length > 1) {
								c = e[0];
								d = e[1]
							}
							try {
								c = this._convertDateValueString(c, this._dateFormatInternal, this._dateFormatDisplay)
							} catch (f) {
								c = ""
							}
							try {
								d = this._convertTimeValueString(d, this._timeFormatInternal, this._timeFormatDisplay)
							} catch (f) {
								d = ""
							}
							this._expr.text = (c == "" || d == "") ? c + d : c + " " + d
						} else {
							if (this._expr.dataType == "Time") {
								this._expr.text = this._convertTimeValueString(this._expr.value, this._timeFormatInternal, this._timeFormatDisplay)
							}
						}
					}
				} else {
					this._expr.text = ""
				}
			} catch (f) {
				this._expr.text = ""
			}
		},
		_validate: function(c) {
			return {
				result: true,
				message: ""
			}
		},
		_convertDateValueString: function(f, h, g) {
			var d = this.getModel();
			if (d && (a.inArray(f, d.dateMacroList) >= 0)) {
				var c = f.substring(2, f.length - 1);
				var e = this.getResText(c);
				return e ? e : ""
			} else {
				return this._convertDateString(f, h, g)
			}
		},
		_convertDateString: function(e, g, f) {
			try {
				var d = a.datepicker.parseDate(g, e);
				return this._convertDate(d, f)
			} catch (c) {
				return ""
			}
		},
		_convertDate: function(c, d) {
			return a.datepicker.formatDate(d, c)
		},
		_convertTime: function(c, e) {
			var d = {
				hour: c.getHours(),
				minute: c.getMinutes(),
				second: c.getSeconds(),
				millisec: c.getMilliseconds(),
				microsec: c.getMicroseconds(),
				timezone: c.getTimezoneOffset() * -1
			};
			return a.datepicker.formatTime(e, d)
		},
		_convertTimeValueString: function(f, h, g) {
			var d = this.getModel();
			if (d && (a.inArray(f, d.timeMacroList) >= 0)) {
				var c = f.substring(2, f.length - 1);
				var e = this.getResText(c);
				return e ? e : ""
			} else {
				return this._convertTimeString(f, h, g)
			}
		},
		_convertTimeString: function(e, g, f) {
			try {
				var c = a.datepicker.parseTime(g, e);
				return a.datepicker.formatTime(f, c)
			} catch (d) {
				return ""
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor_LIST", a.eqjs.ValueEditor, {
		_menuBlock: null,
		_menuItemsList: null,
		_emptyListText: "<empty list>",
		_showWhenReady: false,
		_getEmptyText: function() {
			if (this._menuItemsList && (this._menuItemsList.length > 0)) {
				return this.getResText("MsgEmptyListValue")
			} else {
				return this._emptyListText
			}
		},
		_getListName: function() {
			return this.options.editor.name
		},
		_renderEditor: function() {
			var c = this;
			c._fillMenuItemsList();
			c._renderMenuBlock()
		},
		_renderMenuBlock: function() {
			var c = this;
			var f = false;
			if (this._expr) {
				f = this._expr.kind == "List"
			}
			var e = this.getQueryPanel();
			var d = {
				items: c._menuItemsList,
				multiselect: f,
				container: e.options.menuContainer,
				onMenuItemSelected: function(g, l) {
					if (!f) {
						c._setValue(l.menuItem.id)
					} else {
						if (l.selectedItems) {
							var h = [];
							var k = l.selectedItems.length;
							for (var j = 0; j < k; j++) {
								h.push(l.selectedItems[j].id)
							}
							c._setValue(h.join(","))
						}
					}
					return false
				}
			};
			a.extend(d, e.options.menuOptions);
			if (e.options.isSubQuery) {
				d.zIndex = e.options.dialogZIndex + 1000
			}
			c._menuBlock = a("<div></div>").hide().appendTo(c.element).PopupMenu(d)
		},
		_beforeShowEditor: function() {
			var c = this._getListName();
			if (c && c.match(/{{.+?}}/)) {
				this._showWhenReady = true;
				this._renderEditor();
				return false
			} else {
				return true
			}
		},
		_showEditor: function() {
			var c = this;
			if (c._menuBlock) {
				this._menuBlock.PopupMenu("showMenu", {
					anchor: c._linkElement,
					selectedIds: c._getValue()
				})
			} else {
				this._showWhenReady = true
			}
		},
		_adjustExprText: function() {
			var d = this;
			var g, c = [],
				e;
			if (d._expr.value && d._menuItemsList) {
				if (this._expr.kind == "List") {
					g = d._expr.value.split(",")
				} else {
					g = [d._expr.value]
				}
				d._expr.text = "";
				var h = g.length;
				var f = function(j) {
						var k;
						for (var i = 0; i < j.length; i++) {
							k = j[i];
							if (k.items) {
								f(k.items)
							} else {
								e = a.grep(g, function(l) {
									return (k.id == l)
								});
								if (e.length > 0) {
									c.push(k.text)
								}
							}
						}
					};
				f(d._menuItemsList);
				d._expr.text = c.join(",")
			} else {
				d._expr.text = ""
			}
		},
		_takeFirstItemInList: function() {
			if (this._menuItemsList && this._menuItemsList.length > 0) {
				this._setValueSilent(this._menuItemsList[0].id)
			}
		},
		_takeDefaultValue: function() {
			if (!this._menuItemsList) {
				return
			}
			var e = this._menuItemsList.length;
			for (var c = 0; c < e; c++) {
				var d = this._menuItemsList[c];
				if (d.isDefault) {
					this._setValueSilent(d.id);
					break
				}
			}
		},
		_fillMenuItemsList: function() {
			this._menuItemsList = this.options.editor.values
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor_CUSTOMLIST", a.eqjs.ValueEditor_LIST, {
		_loaderElement: null,
		_renderEditor: function() {
			var c = this;
			this._linkElement.hide();
			if (!this._loaderElement) {
				this._loaderElement = a("<div></div>", {
					"class": "eqjs-qp-ve-loader"
				}).appendTo(c.element)
			}
			this._loaderElement.show();
			if (this._loading) {
				return
			}
			this._loading = true;
			this._fillMenuItemsList(function() {
				c._loading = false;
				var d = c._getDisplayText();
				c._linkElement.text(d);
				c._linkElement.attr("title", d);
				c._loaderElement.hide();
				c._linkElement.show();
				c._renderMenuBlock();
				if (c._isEmptyValue()) {
					c._takeDefaultValue()
				}
				if (c._showWhenReady) {
					c._showWhenReady = false;
					c._showEditor()
				}
			})
		},
		_fillMenuItemsList: function(g) {
			var d = this,
				e = this._getListName(),
				c = this.getQuery().getListRequestHandler();
			var f = this.getQueryPanel();
			if (EQ.core.constLists[e]) {
				d._menuItemsList = EQ.core.constLists[e];
				if (g) {
					g()
				}
			} else {
				if (e === "EntityTree") {
					d._menuItemsList = f.options.entitiesList;
					if (g) {
						g()
					}
				} else {
					if (c) {
						c({
							listName: e
						}, function(h) {
							d._menuItemsList = h;
							if (g) {
								g()
							}
						})
					}
				}
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor_SQLLIST", a.eqjs.ValueEditor_CUSTOMLIST, {
		_fillMenuItemsList: function(g) {
			var d = this;
			var f = this.getQuery();
			var e = this.options.editor;
			var c = f.getListRequestHandler();
			if (c) {
				c({
					listName: "SQL",
					sql: e.sql,
					editorId: e.id
				}, function(h) {
					d._menuItemsList = h;
					if (g) {
						g()
					}
				})
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ValueEditor_SUBQUERY", a.eqjs.ValueEditor, {
		_dialogBlock: null,
		_queryPanelBlock: null,
		_columnElement: null,
		_getEmptyText: function() {
			return this.getResText("MsgSubQueryValue")
		},
		_renderEditor: function() {
			var k = this;
			k._dialogBlock = a("<div></div>", {
				"class": "eqjs-qp-ve-subquery"
			}).hide().appendTo(k.element);
			var i = this.getQueryPanel();
			var e = this.getModel();
			var g = e.getEntitiesTreeWithFilter(function(l) {
				if (l.attributes && l.uic) {
					return true
				}
				return l.uic && (!l.dataType || l.dataType == k._expr.dataType)
			});
			var c = a("<div></div>").hide().appendTo(k._dialogBlock);
			c.PopupMenu({
				items: g,
				zIndex: i.options.dialogZIndex + 1000
			});
			var d = a("<div></div>").addClass("eqjs-qp-ve-subquery-column").appendTo(k._dialogBlock);
			var j = a("<div></div>").addClass("eqjs-qp-ve-subquery-column-title").text(k.getResText("SubQueryColumnTitle")).appendTo(d);
			var h = a("<div></div>").addClass("eqjs-qp-ve-subquery-column-element").appendTo(d);
			k._columnElement = a("<a></a>").attr("href", "javascript:void(0)").appendTo(h);
			k._columnElement.click(function(l) {
				c.PopupMenu("showMenu", {
					anchor: k._columnElement,
					selectedIds: null,
					itemSelectedCallback: function(m, n) {
						return k._columnElementMenuClick(m, n)
					}
				})
			});
			var f = a("<div></div>").addClass("eqjs-qp-ve-subquery-qp-caption").text(k.getResText("SubQueryQueryPanelCaption")).appendTo(k._dialogBlock);
			k._queryPanelBlock = a('<div class="eqjs-qp-ve-subquery-qp"></div>').appendTo(k._dialogBlock);
			k._dialogBlock.dialog({
				autoOpen: false,
				draggable: false,
				resizable: false,
				title: k.getResText("SubQueryDialogTitle"),
				dialogClass: "eq-js-dialog",
				closeText: "X",
				modal: true,
				width: i.options.subQueryDialogWidth,
				minHeight: i.options.subQueryDialogHeight,
				zIndex: i.options.dialogZIndex,
				buttons: [{
					name: "eqjs-subquery-button-ok",
					text: k.getResText("ButtonOK"),
					click: function() {
						var m = k.getSubQuery();
						k._expr.value = m.getObject();
						a(this).dialog("close");
						var l = k.getQuery();
						l.fireChangedEvent({
							source: k.getQueryPanel(),
							changeType: "condition.changed",
							condition: k.getCondition()
						})
					}
				}, {
					name: "eqjs-subquery-button-cancel",
					text: k.getResText("ButtonCancel"),
					click: function() {
						a(this).dialog("close")
					}
				}],
				open: function() {
					a(".ui-widget-overlay").addClass("eq-js-dialog-overlay");
					a("body").css("overflow", "hidden")
				},
				beforeClose: function() {
					a(".ui-widget-overlay").removeClass("eq-js-dialog-overlay");
					a("body").css("overflow", "auto")
				},
				close: function(l, m) {
					k._queryPanelBlock.QueryPanel("destroy")
				}
			})
		},
		_columnElementMenuClick: function(c, f) {
			var d = this;
			var e = f.menuItem.data("id");
			this._setResultAttributeId(e);
			return false
		},
		_setResultAttributeId: function(g) {
			var c = this.getModel().getAttributeById(g);
			if (c) {
				var f = this.getSubQuery();
				var h = f.getColumns();
				if (h.length > 0) {
					var d = h[0];
					d.expr.id = g;
					d.expr.dataType = c.dataType
				} else {
					var e = {
						caption: "",
						sorting: "None",
						sortIndex: -1,
						expr: {
							typeName: "ENTATTR",
							id: g,
							kind: "Attribute",
							dataType: c.dataType
						}
					};
					h.push(e)
				}
				this._columnElement.text(this._getAttributeText(c));
				this._okButtonEnable(true)
			}
		},
		_getAttributeText: function(f) {
			var e = this;
			if (!f) {
				return e.getResText("SubQueryEmptyColumn")
			}
			var i = EQ.core.getText("Attributes", f.id);
			if (!i) {
				i = f.caption
			}
			var d = this.getQueryPanel();
			var g = d.options.attrElementFormat;
			if (!g) {
				return i
			}
			var c = g.replace(new RegExp("{attr}", "g"), i);
			var h = e.getModel().getFullEntityPathByAttr(f.id, ".");
			c = c.replace(new RegExp("{entity}", "g"), h);
			return c
		},
		_showEditor: function() {
			var d = this;
			var g = this.getQuery();
			var c = this.getQueryPanel();
			d._queryPanelBlock.empty();
			var i = jQuery.extend(true, {}, d._getValue());
			var f = new EQ.core.Query(this.getModel(), i);
			f.clientListRequestHandler = g.clientListRequestHandler;
			f.serverListRequestHandler = g.serverListRequestHandler;
			d._queryPanelBlock.QueryPanel({
				isSubQuery: true,
				showRootRow: c.options.showRootRow,
				showAddRow: true,
				menuContainer: d._dialogBlock.get(0),
				showCheckboxes: c.options.showCheckboxes,
				dateFormatValue: c.options.dateFormatValue,
				dateFormatDisplay: c.options.dateFormatDisplay,
				entitiesListFilter: function(l, k) {
					if (c.options.entitiesListFilter) {
						var m = k || {};
						m.isSubQuery = true;
						c.options.entitiesListFilter(l, m)
					}
				}
			});
			d._queryPanelBlock.QueryPanel("setQuery", f);
			var e = null;
			var h = f.getColumns();
			if (h.length == 0) {
				var j = this.getCondition();
				e = j.expressions.length > 0 && j.expressions[0].kind == "Attribute" ? j.expressions[0].id : null
			} else {
				e = h[0].expr.id
			}
			if (e) {
				this._setResultAttributeId(e)
			}
			d._dialogBlock.dialog("open")
		},
		getSubQuery: function() {
			return this._queryPanelBlock.QueryPanel("getQuery")
		},
		_okButtonEnable: function(c) {
			var d = this._dialogBlock.next(".ui-dialog-buttonpane").find("[name='eqjs-subquery-button-ok']");
			if (d) {
				if (c) {
					d.button("enable")
				} else {
					d.button("disable")
				}
			}
		},
		_getDisplayText: function() {
			return this._getEmptyText()
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.PredicateLinkType", a.eqjs.ValueEditor_LIST, {
		_predicate: null,
		options: {
			queryPanel: null
		},
		getCondition: function() {
			return this._predicate
		},
		init: function(c) {
			this._predicate = c;
			this.refresh()
		},
		_render: function() {
			this.clear();
			if (this._predicate) {
				this._renderCommonPart();
				if (this._predicate.enabled !== false) {
					this._renderEditor()
				}
				this._linkElement.text(this._getDisplayText())
			}
		},
		_showEditor: function() {
			var c = this;
			c._menuBlock.PopupMenu("showMenu", {
				anchor: c._linkElement
			})
		},
		_fillMenuItemsList: function() {
			this._menuItemsList = EQ.core.predicateLinkTypeList
		},
		_setValue: function(c) {
			this._predicate.linkType = c;
			this._linkElement.text(this._getDisplayText());
			if (this.options.onChange) {
				this.options.onChange(c)
			}
		},
		_beforeShowEditor: function() {
			return true
		},
		_getClassesToAdd: function() {
			return "eqjs-qp-predelement eqjs-qp-predvalueelement"
		},
		_getDisplayText: function() {
			var d = this,
				c = this._getEmptyText();
			if (d._predicate.linkType && d._predicate.linkType != "") {
				a.each(EQ.core.predicateLinkTypeList, function() {
					if (this.id === d._predicate.linkType) {
						c = this.text
					}
				})
			}
			return c
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ColumnsContainer", {
		_activeColumnWidget: null,
		_defaultMenuOptions: {
			showSearchBoxAfter: 30,
			activateOnMouseOver: true
		},
		_query: null,
		options: {
			isSubQuery: false,
			activeColumn: null,
			showAddRow: true,
			showHeader: true,
			showColumnCaptions: true,
			allowAggrColumns: true,
			allowSorting: true,
			attrElementFormat: "{entity} {attr}",
			alwaysShowButtons: false,
			accentActiveColumn: true,
			menuSearchBoxAfter: 30,
			allowDragDrop: true,
			menuOptions: {
				showSearchBoxAfter: 30,
				activateOnMouseOver: true,
				adjustHeight: true
			}
		},
		_create: function() {},
		getQuery: function() {
			return this._query
		},
		setQuery: function(c) {
			this._setQueryObserver(true);
			this._query = c;
			this._setQueryObserver();
			this.refresh()
		},
		getModel: function() {
			var c = this.getQuery();
			return c ? c.getModel() : null
		},
		getColumns: function() {
			var c = this.getQuery();
			return c ? c.getColumns() : null
		},
		_getCssPrefix: function() {
			return ""
		},
		_render: function() {
			var n = this;
			n._clear();
			var k = this.getModel();
			n._updateLists();
			var i = this._getCssPrefix();
			n.element.addClass(i + "-panel");
			if (k && !k.isEmpty()) {
				n.options.entitiesList = k.getEntitiesTree({
					addUIC: false,
					addUIR: true,
					addUIS: false
				});
				n.options.entitiesMenu = n._createEntitiesMenu();
				if (n.options.allowSorting != false) {
					n.options.sortMenuList = [{
						id: "None",
						text: EQ.core.getText("CmdNotSorted")
					}, {
						id: "Ascending",
						text: EQ.core.getText("CmdAscending")
					}, {
						id: "Descending",
						text: EQ.core.getText("CmdDescending")
					}, {
						id: "---",
						text: "---"
					}, {
						id: "MoveTop",
						text: EQ.core.getText("CmdMoveToFirst")
					}, {
						id: "MoveUp",
						text: EQ.core.getText("CmdMoveToPrev")
					}, {
						id: "MoveDown",
						text: EQ.core.getText("CmdMoveToNext")
					}, {
						id: "MoveBottom",
						text: EQ.core.getText("CmdMoveToLast")
					}];
					n.options.sortMenu = n._createSortMenu()
				} else {
					n.options.sortMenu = null
				}
				var m = 0;
				var h = n.getColumns();
				var g = i + "-header";
				if (n.options.showHeader != false && h && h.length > 0) {
					var f = a('<div class="' + g + '"></div>').appendTo(this.element);
					var e = a('<div class="' + g + '-expression"></div>').text(EQ.core.getText("HeaderExpression")).appendTo(f);
					if (n.options.showColumnCaptions) {
						var c = a('<div class="' + g + '-title"></div>').text(EQ.core.getText("HeaderTitle")).appendTo(f)
					}
					m += f.outerHeight() + 5
				}
				var l = n._refreshByQuery();
				if (n.options.showAddRow) {
					var d = a('<div class="eqjs-addrow ' + i + '-addrow"></div>');
					d.appendTo(this.element);
					if (!h || h.length === 0) {
						d.addClass("eqjs-addrow-empty")
					}
					var j = a('<a href="javascript:void(0)">' + EQ.core.getText("CmdClickToAddColumn") + "</a>");
					j.appendTo(d);
					j.click(function(o) {
						o.preventDefault();
						n.showEntitiesMenu({
							anchor: j,
							selectedIds: null,
							itemSelectedCallback: function(q, t) {
								var s = t.menuItem.id;
								var r = k.getAttributeById(s);
								n.addNewColumn(s);
								return false
							}
						}, {})
					});
					m += d.outerHeight() + 9
				}
				if (l) {
					l.css({
						"max-height": n.element.innerHeight() - m + 5 + "px"
					})
				}
			}
		},
		_updateLists: function() {},
		_setOption: function(c, d) {
			if (c == "menuOptions") {
				this.options.menuOptions = a.extend({}, this._defaultMenuOptions, d)
			} else {
				if (c == "searchBoxAfter") {
					this.options[c] = d;
					this.options.menuOptions.showSearchBoxAfter = d
				} else {
					if (c == "query") {
						this.setQuery(d)
					} else {
						if (arguments.length == 2) {
							this.options[c] = d;
							this.refresh();
							return this
						} else {
							return this.options[c]
						}
					}
				}
			}
		},
		_setQueryObserver: function(c) {
			var d = this;
			var f = this.getQuery();
			var e = function(g) {
					if (g && g.source !== d && g.changeType && g.changeType.indexOf("condition") < 0) {
						d._render()
					}
				};
			if (f) {
				if (c) {
					f.removeChangedCallback(e)
				} else {
					f.addChangedCallback(e)
				}
			}
		},
		_clear: function() {
			this.element.html("")
		},
		_refreshByQuery: function() {
			var t = this;
			if (!this.getQuery()) {
				return
			}
			var g = a("<div></div>"),
				h = a("<div></div>");
			var j = this._getCssPrefix();
			g.addClass(j + "-columns");
			g.appendTo(h);
			h.appendTo(t.element);
			var i = t.getColumns();
			var s = i.length;
			for (var l = 0; l < s; l++) {
				var o = a("<div></div>");
				o.appendTo(g);
				var f = "element.ColumnRow_" + i[l].expr.typeName + "({columnsPanel: self}); element.ColumnRow_" + i[l].expr.typeName + "('init', self.getColumns()[idx]);";
				var d = new Function("self, element, idx", f);
				d(t, o, l)
			}
			var k, r, c, e = false,
				n, q = false;
			var m = t.getModel();
			if (t.options.allowDragDrop) {
				g.sortable({
					containment: h,
					tolerance: "touch",
					placeholder: "ui-state-highlight eqjs-highlight",
					scrollSpeed: 3,
					delay: 100,
					distance: 13,
					cursorAt: {
						top: 10
					},
					forceHelperSize: true,
					handle: "div, a",
					helper: "clone",
					start: function(u, v) {
						k = v.item.index();
						v.item.addClass(j + "-column-sort");
						q = true
					},
					update: function(w, x) {
						var v = x.item.attr("data-id");
						if (v) {
							var u = m.getAttributeById(v);
							if (u.uir != true) {
								x.item.remove();
								return
							}
						}
						r = x.item.index();
						if (e) {
							t.addNewColumn(n, r);
							e = false
						} else {
							if (k != r) {
								t.getQuery().moveColumn(k, r);
								t._fireQueryChange("columns.order")
							}
						}
					},
					stop: function(u, v) {
						v.item.removeClass(j + "-column-sort");
						return false
					}
				});
				t.element.droppable({
					hoverClass: "eqjs-drophover",
					scope: "entityAttr",
					drop: function(u, w) {
						var v = w.draggable.attr("data-id");
						if (!m.checkAttrProperty(v, "uir")) {
							return
						}
						if (!i || i.length === 0 || !q) {
							t.addNewColumn(v)
						} else {
							e = true
						}
					},
					over: function(u, w) {
						w.helper.addClass(j + "-column-drag");
						var v = w.draggable.attr("data-id");
						if (!m.checkAttrProperty(v, "uir")) {
							w.helper.addClass(j + "-column-drag-forbidden")
						}
					},
					out: function(u, v) {
						v.helper.removeClass(j + "-column-drag");
						v.helper.removeClass(j + "-column-drag-forbidden")
					},
					activate: function(u, v) {
						n = v.draggable.attr("data-id")
					}
				})
			}(!g.children().length) ? h.hide() : h.show();
			return g
		},
		clearColumns: function(c) {
			var d = this.getQuery();
			if (!d) {
				return
			}
			d.clearColumns();
			if (c !== false) {
				this.refresh()
			}
		},
		_createEntitiesMenu: function() {
			var e = this.getModel();
			if (!e || e.isEmpty()) {
				return null
			}
			var c = this;
			var f = a("<div></div>").hide().appendTo(this.element);
			var d = {
				items: this.options.entitiesList,
				adjustHeight: c.options.adjustEntitiesMenuHeight
			};
			a.extend(d, c.options.menuOptions);
			f.PopupMenu(d);
			return f
		},
		showEntitiesMenu: function(e, d) {
			var c = this;
			c.options.entitiesMenu.PopupMenu("showMenu", e)
		},
		_createSortMenu: function() {
			var d = this.getModel();
			if (!d || d.isEmpty()) {
				return null
			}
			var e = a("<div></div>").hide().appendTo(this.element);
			var c = this;
			e.PopupMenu({
				items: this.options.sortMenuList
			});
			return e
		},
		_fireQueryChange: function(c) {
			var d = this;
			this.getQuery().fireChangedEvent({
				source: d,
				changeType: "query." + c
			})
		},
		_fireColumnChange: function(c, e) {
			var d = this;
			e = e || d._column;
			this.getQuery().fireChangedEvent({
				source: d,
				changeType: "column." + c,
				column: e
			})
		},
		addNewColumn: function(f, j) {
			var l = this;
			var h = this.getModel();
			var k = function(i) {
					var m = h.getAttributeById(i);
					if (!m) {
						return null
					}
					if (!m.uir) {
						if (m.lookupAttr) {
							i = m.lookupAttr;
							m = h.getAttributeById(i);
							if (!m || !m.uir) {
								return null
							}
						} else {
							return null
						}
					}
					return {
						caption: "",
						sorting: "None",
						sortIndex: -1,
						expr: {
							typeName: "ENTATTR",
							id: i
						}
					}
				};
			if (!this.getQuery()) {
				return
			}
			var d, c;
			if (a.isArray(f)) {
				d = [];
				var e = f.length;
				for (var g = 0; g < e; g++) {
					c = k(f[g]);
					if (c) {
						d.push(c)
					}
				}
			} else {
				d = k(f)
			}
			l.addColumn(d, j);
			return d
		},
		addColumn: function(e, d) {
			var c = this;
			var f = this.getQuery();
			if (!f) {
				return
			}
			if (!e || (a.isArray(e) && e.length == 0)) {
				return
			}
			f.addColumn(e, d)
		},
		removeColumn: function(d) {
			var c = this;
			var e = this.getQuery();
			if (!e) {
				return
			}
			e.removeColumn(d)
		},
		removeColumnByAttrId: function(i) {
			var c = this;
			var h = this.getQuery();
			if (!h) {
				return
			}
			var e = 0;
			var f = h.getColumns();
			var g = f.length;
			while (e < g) {
				var d = f[e];
				if (d.expr.typeName == "ENTATTR" && d.expr.id == i) {
					break
				}
				e++
			}
			if (e < g) {
				h.removeColumn(f[e])
			}
		},
		moveColumn: function(f, h) {
			var c = this;
			var g = this.getQuery();
			var e = g.getColumns();
			var d = a.inArray(f, e);
			if (d >= 0) {
				switch (h) {
				case "MoveTop":
					if (d == 0) {
						return
					}
					g.moveColumn(d, 0);
					break;
				case "MoveUp":
					if (d == 0) {
						return
					}
					g.moveColumn(d, d - 1);
					break;
				case "MoveDown":
					if (d == e.length - 1) {
						return
					}
					g.moveColumn(d, d + 1);
					break;
				case "MoveBottom":
					if (d == e.length - 1) {
						return
					}
					g.moveColumn(d, e.length - 1);
					break
				}
			}
		},
		refresh: function() {
			this._render()
		},
		resize: function() {
			this._render()
		},
		setActiveColumnWidget: function(c) {
			if (this._activeColumnWidget) {
				this._activeColumnWidget.internalDeactivate();
				this.options.activeColumn = null
			}
			this._activeColumnWidget = c;
			if (this._activeColumnWidget) {
				this._activeColumnWidget.internalActivate();
				this.options.activeColumn = this._activeColumnWidget.getColumn()
			}
		}
	});
	a.widget("eqjs.ColumnsPanel", a.eqjs.ColumnsContainer, {
		_getCssPrefix: function() {
			return "eqjs-qc"
		}
	});
	a.widget("eqjs.ColumnsBar", a.eqjs.ColumnsContainer, {
		_create: function() {
			this.options.allowDragDrop = false
		},
		_getCssPrefix: function() {
			return "eqjs-cb"
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ColumnRow", {
		_column: null,
		_buttonsBlock: null,
		_columnTypeButton: null,
		_deleteButton: null,
		_keepShowingButtons: false,
		_isMouseOverBlock: false,
		_sortingButton: null,
		_panelCssPrefix: "eqjs-qc",
		_classesToAdd: "",
		_active: false,
		options: {
			columnsPanel: null
		},
		getQuery: function() {
			return this.options.columnsPanel ? this.options.columnsPanel.getQuery() : null
		},
		getModel: function() {
			var c = this.getQuery();
			return c ? c.getModel() : null
		},
		getColumn: function() {
			return this._column
		},
		isModelNullOrEmpty: function() {
			var c = this.getModel();
			return !c || c.isEmpty()
		},
		_initCssPrefixes: function() {},
		init: function(d) {
			var c = this;
			this._initCssPrefixes();
			c._column = d;
			c.element.get(0).column = d;
			c.refresh()
		},
		_render: function() {
			this._clear();
			if (!this.isModelNullOrEmpty() && this._column) {
				this._refreshByColumn();
				this._initButtons();
				if (this.options.columnsPanel.options.activeColumn == this._column) {
					this.makeActive()
				}
			}
		},
		_fireColumnChange: function(c, e) {
			var d = this;
			e = e || d._column;
			var f = this.getQuery();
			f.fireChangedEvent({
				source: d.options.columnsPanel,
				changeType: "column." + c,
				column: e
			})
		},
		refresh: function() {
			this._render()
		},
		_setOption: function(c, d) {
			if (arguments.length == 2) {
				this.options[c] = d;
				if (c === "disabled") {
					this._column.enabled = !d
				}
				this._render();
				return this
			} else {
				if (c === "disabled") {
					return this._column.enabled === false
				} else {
					return this.options[c]
				}
			}
		},
		_clear: function() {
			this.element.unbind();
			this.element.html("");
			this.element.removeClass()
		},
		_refreshByColumn: function() {},
		remove: function() {
			var c = this;
			if (!c.options.columnsPanel) {
				return
			}
			c.options.columnsPanel.removeColumn(c._column)
		},
		_getButtonsContainer: function() {
			return this.element
		},
		_initButtons: function() {
			var g = this;
			var d = a("<div></div>").addClass("eqjs-button-placeholder").addClass(this._panelCssPrefix + "-button-placeholder").addClass(this._panelCssPrefix + "-colelement").prependTo(g.element);
			g._sortingButton = a("<div></div>").addClass("eqjs-column-sortbutton").appendTo(d);
			var f = g._getButtonsContainer();
			if (!f || g._column.readOnly) {
				return
			}
			g._buttonsBlock = a("<div></div>").addClass("eqjs-column-buttonsBlock").appendTo(f);
			d = a("<div></div>").addClass("eqjs-button-placeholder").appendTo(g._buttonsBlock);
			g._columnTypeButton = a("<div></div>").addClass("eqjs-button").addClass("eqjs-column-button").addClass("eqjs-column-button-type").attr("title", EQ.core.getText("ButtonToAggr")).appendTo(d);
			d = a("<div></div>").addClass("eqjs-button-placeholder").appendTo(g._buttonsBlock);
			g._deleteButton = a("<div></div>").addClass("eqjs-button").addClass("eqjs-column-button").addClass("eqjs-column-button-delete").attr("title", EQ.core.getText("ButtonDelete")).appendTo(d).click(function() {
				g.remove()
			});
			if (g.options.columnsPanel.options.allowSorting != false) {
				g._sortingButton.attr("title", EQ.core.getText("ButtonSorting")).click(function() {
					g._keepShowingButtons = true;
					g.options.columnsPanel.options.sortMenu.PopupMenu("showMenu", {
						anchor: g._sortingButton,
						selectedIds: null,
						itemSelectedCallback: function(h, i) {
							if (i.menuItem.id == "None" || i.menuItem.id == "Ascending" || i.menuItem.id == "Descending") {
								g._column.sorting = i.menuItem.id;
								g.refresh();
								g._fireColumnChange("change")
							} else {
								g.options.columnsPanel.moveColumn(g._column, i.menuItem.id)
							}
						},
						menuClosedCallback: function() {
							g._keepShowingButtons = false;
							if (!g._isMouseOverBlock) {
								g._sortingButton.trigger("mouseleave")
							}
						}
					})
				});
				var c = "eqjs-column-sortbutton";
				g._sortingButton.addClass("eqjs-button");
				if (g._column.sorting === "None") {
					g._sortingButton.addClass(c + "-none")
				}
				g._sortingButton.hover(function() {
					a(this).addClass(c + "-active")
				}, function() {
					a(this).removeClass(c + "-active")
				})
			}
			if (g._column.sorting === "Ascending") {
				g._sortingButton.addClass(c + "-asc").attr("title", EQ.core.getText("ButtonSorting"))
			} else {
				if (g._column.sorting === "Descending") {
					g._sortingButton.addClass(c + "-desc").attr("title", EQ.core.getText("ButtonSorting"))
				}
			}
			var e = this._panelCssPrefix + "-button";
			f.find("[class*=" + e + "]").hover(function() {
				a(this).addClass(e + "-active")
			}, function() {
				a(this).removeClass(e + "-active")
			});
			f.bind("mouseenter", function(h) {
				g._isMouseOverBlock = true;
				g._enterButtonBlock();
				h.stopPropagation();
				return false
			}).bind("mouseleave", function(h) {
				g._isMouseOverBlock = false;
				if (!g._keepShowingButtons) {
					g._leaveButtonBlock()
				}
				h.stopPropagation();
				return false
			});
			g._setupButtonListeners();
			g._hideButtons();
			g._adjustButtonsVisibility()
		},
		_setupButtonListeners: function() {},
		_adjustButtonsVisibility: function() {},
		_enterButtonBlock: function() {
			this._showButtons()
		},
		_leaveButtonBlock: function() {
			if (this.options.columnsPanel.options.alwaysShowButtons != true && (!this._active || this.options.columnsPanel.options.accentActiveColumn != true)) {
				this._hideButtons()
			}
		},
		_showButtons: function() {},
		_hideButtons: function() {
			this._columnTypeButton.hide();
			this._deleteButton.hide();
			if (this._column.sorting === "None") {
				this._sortingButton.hide()
			}
		},
		internalActivate: function() {
			this._active = true;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		internalDeactivate: function() {
			this._active = false;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		adjustActiveClass: function() {
			if (this._active && this.options.columnsPanel.options.accentActiveColumn) {
				this.element.addClass("active")
			} else {
				this.element.removeClass("active")
			}
		},
		getColumnsPanel: function() {
			return this.options.columnsPanel
		},
		isActive: function() {
			return this._active
		},
		makeActive: function() {
			var c = this.getColumnsPanel();
			if (c) {
				c.setActiveColumnWidget(this)
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ColumnRow_ENTATTR", a.eqjs.ColumnRow, {
		_baseAttr: null,
		_menuFunctionsBlock: null,
		_initCssPrefixes: function() {
			this._panelCssPrefix = this.options.columnsPanel._getCssPrefix();
			this._classesToAdd = this._panelCssPrefix + "-row " + this._panelCssPrefix + "-row-column-entattr"
		},
		_baseExprMenuClick: function(c, g) {
			var d = this;
			var f = g.menuItem.data("id");
			var e = d.getModel().getAttributeById(f);
			d._column.expr.id = f;
			d._column.caption = "";
			d.refresh();
			d._fireColumnChange("change");
			return false
		},
		_getBaseExpr: function() {
			var c = this;
			var d = null;
			if (c._column.enabled !== false && !c._column.readOnly) {
				d = a("<a></a>").attr("href", "javascript:void(0)").text(c._getAttributeText(c._baseAttr)).click(function(f) {
					f.preventDefault();
					c.options.columnsPanel.options.entitiesMenu.PopupMenu("showMenu", {
						anchor: d,
						selectedIds: null,
						itemSelectedCallback: function(e, g) {
							return c._baseExprMenuClick(e, g)
						}
					})
				})
			} else {
				d = a("<span></span>").text(c._getAttributeText(c._baseAttr))
			}
			return d
		},
		_fillBaseBlock: function(e) {
			var d = this;
			e.addClass(this._panelCssPrefix + "-expr-block");
			var c = a("<div></div>").addClass(this._panelCssPrefix + "-colelement").addClass(this._panelCssPrefix + "-attrelement").appendTo(e);
			var f = d._getBaseExpr();
			f.appendTo(c);
			if (!d._column.readOnly) {
				d._createFunctionMenu()
			}
		},
		_refreshByColumn: function() {
			if (!this._column || this.isModelNullOrEmpty()) {
				return
			}
			var c = this;
			c._baseAttr = c._getAttribute();
			c.element.addClass(c._classesToAdd);
			if (c._column.readOnly) {
				this.element.addClass("eqjs-qp-readonly")
			}
			var f = a("<div></div>").appendTo(c.element);
			c._fillBaseBlock(f);
			if (c.options.columnsPanel.options.accentActiveColumn) {
				c.element.click(function() {
					if (!c._active) {
						c.makeActive()
					}
				})
			}
			if (c.options.columnsPanel.options.showColumnCaptions) {
				if (!c._column.caption || c._column.caption == "") {
					c._column.caption = c._getDefaultCaption()
				}
				if (!c._column.readOnly) {
					var e = a("<div></div>");
					e.appendTo(this.element);
					var g = function() {
							c._fireColumnChange("change")
						};
					e.ColumnRow_CaptionEditor({
						cssClassPrefix: this._panelCssPrefix
					});
					e.ColumnRow_CaptionEditor("init", c._column, c._column.caption, g)
				} else {
					var d = a("<span></span>").addClass(this._panelCssPrefix + "-colelement").addClass(this._panelCssPrefix + "-captionelement").text(c._column.caption).appendTo(this.element)
				}
			}
			c.adjustActiveClass()
		},
		_getDefaultCaption: function() {
			return this._getAttributeText(this._baseAttr)
		},
		_getAttribute: function() {
			return this.getModel().getAttributeById(this._column.expr.id)
		},
		_getAttributeText: function(c) {
			var d = this;
			if (!c) {
				return ""
			}
			var e = this.getModel();
			var f = d.options.columnsPanel.options.attrElementFormat;
			return e.getAttributeText(c, f)
		},
		_adjustButtonsVisibility: function() {
			var c = this;
			c._columnTypeButton.removeClass("aggregated").attr("title", EQ.core.getText("ButtonToAggr"));
			if (this.options.columnsPanel.options.alwaysShowButtons || (this.options.columnsPanel.options.accentActiveColumn && this._active)) {
				this._showButtons()
			}
		},
		_changeTypeToAggr: function(f) {
			var c = this;
			if (!f) {
				f = c._menuFunctionsBlock.PopupMenu("option", "items")[0].id
			}
			var g = c._column.expr.id;
			c._column.caption = "";
			c._column.expr = {
				func: f,
				distinct: false,
				typeName: "AGGRFUNC",
				argument: {
					typeName: "ENTATTR",
					id: g
				}
			};
			var e = c._column;
			var d = c._active;
			c.destroy();
			c._clear();
			c.element.ColumnRow_AGGRFUNC({
				columnsPanel: c.options.columnsPanel
			});
			c.element.ColumnRow_AGGRFUNC("init", e);
			c._fireColumnChange("change");
			if (d) {
				c.options.columnsPanel._activeColumn = null;
				c.element.ColumnRow_AGGRFUNC("makeActive")
			}
		},
		_createFunctionMenu: function() {
			var l = this;
			var f = [];
			var c = l.getModel().getAggrFunctions();
			var d = true;
			var h = true;
			var k = null;
			var e = l._getAttribute();
			var g;
			var j = c.length;
			for (var i = 0; i < j; i++) {
				if (!c[i]) {
					continue
				}
				d = true;
				if (c[i].id === "SUM" || c[i].id === "AVG") {
					d = a.inArray(e.dataType, ["Autoinc", "Byte", "Currency", "Float", "Int", "Int64", "Word"]) >= 0
				} else {
					if (c[i].id === "MIN" || c[i].id === "MAX") {
						d = a.inArray(e.dataType, ["Autoinc", "BCD", "Byte", "Currency", "Date", "DateTime", "Float", "Int", "Int64", "Time", "Word"]) >= 0
					}
				}
				if (l._column.expr.func === c[i].id && !d) {
					h = false
				}
				if (d) {
					g = l.getModel().getAggrFunctionCaption(c[i].id);
					k = {
						id: c[i].id,
						text: g
					};
					f.push(k)
				}
			}
			if (!h) {
				l._column.expr.func = f[0].id
			}
			l._menuFunctionsBlock = a("<div></div>").hide().appendTo(l.element);
			l._menuFunctionsBlock.PopupMenu({
				items: f
			});
			return l._menuFunctionsBlock
		},
		_showButtons: function() {
			if (this.options.columnsPanel.options.allowAggrColumns != false) {
				this._columnTypeButton.show()
			} else {
				this._columnTypeButton.attr("title", "")
			}
			this._deleteButton.show();
			if (this.options.columnsPanel.options.allowSorting != false) {
				this._sortingButton.show()
			}
		},
		_setupButtonListeners: function() {
			var c = this;
			if (c._columnTypeButton) {
				c._columnTypeButton.click(function(d) {
					if (c.options.columnsPanel.options.allowAggrColumns !== false && c._column.enabled !== false) {
						c._keepShowingButtons = true;
						c._menuFunctionsBlock.PopupMenu("showMenu", {
							anchor: c._columnTypeButton,
							selectedIds: null,
							itemSelectedCallback: function(e, f) {
								c._changeTypeToAggr(f.menuItem.id);
								return false
							},
							menuClosedCallback: function() {
								c._keepShowingButtons = false;
								if (!c._isMouseOverBlock) {
									c._columnTypeButton.trigger("mouseleave")
								}
							}
						})
					}
				})
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ColumnRow_AGGRFUNC", a.eqjs.ColumnRow_ENTATTR, {
		_displayFormatParser: {
			formatStr: "",
			pos: 0,
			token: "text",
			tokenText: "",
			start: function(c) {
				this.formatStr = c;
				this.pos = 0;
				this.tokenText = ""
			},
			skipSpaces: function() {
				while (this.pos < this.formatStr.length && this.formatStr.charAt(this.pos) === " ") {
					this.pos++
				}
			},
			next: function() {
				this.skipSpaces();
				if (this.pos >= this.formatStr.length) {
					return false
				}
				var e = 0;
				if (this.formatStr.charAt(this.pos) === "{") {
					e = this.formatStr.indexOf("}", this.pos);
					if (e < 0) {
						return false
					}
					this.tokenText = this.formatStr.substring(this.pos, e + 1);
					if (this.tokenText.indexOf("{attr") === 0) {
						this.token = "attribute"
					}
					this.pos = e + 1
				} else {
					if (this.formatStr.charAt(this.pos) === "[" && this.pos < this.formatStr.length - 1 && this.formatStr.charAt(this.pos + 1) === "[") {
						this.pos += 2;
						e = this.formatStr.indexOf("]]", this.pos);
						this.token = "function";
						this.tokenText = this.formatStr.substring(this.pos, e);
						this.pos = e + 2
					} else {
						this.token = "text";
						var d = this.formatStr.indexOf("{", this.pos);
						if (d < 0) {
							d = this.formatStr.length
						}
						var c = this.formatStr.indexOf("[[", this.pos);
						if (c < 0) {
							c = this.formatStr.length
						}
						e = Math.min(d, c);
						this.tokenText = a.trim(this.formatStr.substring(this.pos, e));
						this.pos = e
					}
				}
				return true
			}
		},
		_initCssPrefixes: function() {
			this._panelCssPrefix = this.options.columnsPanel._getCssPrefix();
			this._classesToAdd = this._panelCssPrefix + "-row " + this._panelCssPrefix + "-row-column-aggr"
		},
		_parseDisplayFormat: function(d) {
			if (!d) {
				return []
			}
			var c = [];
			var e = this._displayFormatParser;
			e.start(d);
			while (e.next()) {
				if (e.token === "function") {
					c.push({
						type: "function",
						text: e.tokenText
					})
				} else {
					if (e.token === "attribute") {
						c.push({
							type: "attribute"
						})
					} else {
						if (e.token === "text") {
							c.push({
								type: "text",
								text: e.tokenText
							})
						}
					}
				}
			}
			return c
		},
		_baseExprMenuClick: function(c, g) {
			var d = this;
			var f = g.menuItem.data("id");
			var e = d.getModel().getAttributeById(f);
			d._column.expr.argument.id = f;
			d._column.caption = "";
			d.refresh();
			d._fireColumnChange("change");
			return false
		},
		_fillBaseBlock: function(e) {
			var n = this;
			e.addClass(this._panelCssPrefix + "-expr-block " + this._panelCssPrefix + "-expr-block-aggr");
			var g, d;
			var l = a("<div></div>").addClass(this._panelCssPrefix + "-colelement").addClass(this._panelCssPrefix + "-aggrfuncelement");
			if (n._column.enabled !== false && !n._column.readOnly) {
				d = a("<a></a>", {
					href: "javascript:void(0)"
				}).appendTo(l);
				n._createFunctionMenu()
			} else {
				d = a("<span></span>").appendTo(l)
			}
			var i = n.getModel().getAggrFunctionFormat(n._column.expr.func);
			if (!i || i === "") {
				return
			}
			var c = n._parseDisplayFormat(i);
			if (c.length === 0) {
				return
			}
			var m = null;
			var f = c.length;
			for (var h = 0; h < f; h++) {
				m = c[h];
				if (m.type === "function") {
					d.text(m.text);
					l.appendTo(e);
					if (n._column.enabled !== false) {
						d.click(function(o) {
							n._menuFunctionsBlock.PopupMenu("showMenu", {
								anchor: d,
								selectedIds: null,
								itemSelectedCallback: function(q, r) {
									n._column.expr.func = r.menuItem.id;
									n._column.caption = "";
									n.refresh();
									n._fireColumnChange("change");
									return false
								}
							})
						})
					}
				} else {
					if (m.type === "attribute") {
						n._baseAttr = n._getAttribute();
						g = this._getBaseExpr();
						var k = a("<div></div>").addClass(this._panelCssPrefix + "-colelement").addClass(this._panelCssPrefix + "-attrelement").appendTo(e);
						g.appendTo(k)
					} else {
						if (m.type === "text") {
							var j = a("<span></span>").addClass(this._panelCssPrefix + "-colelement").text(m.text).appendTo(e)
						}
					}
				}
			}
		},
		_getDefaultCaption: function() {
			return this._getAttributeText(this._baseAttr) + " " + this.getModel().getAggrFunctionCaption(this._column.expr.func)
		},
		_getAttribute: function() {
			return this.getModel().getAttributeById(this._column.expr.argument.id)
		},
		_setupButtonListeners: function() {
			var c = this;
			c._columnTypeButton.click(function() {
				if (c._column.enabled !== false) {
					c._changeTypeToSimple();
					return false
				}
			})
		},
		_adjustButtonsVisibility: function() {
			var c = this;
			c._columnTypeButton.addClass("aggregated").attr("title", EQ.core.getText("ButtonToSimple"));
			if (this.options.columnsPanel.options.alwaysShowButtons || (this.options.columnsPanel.options.accentActiveColumn && this._active)) {
				this._showButtons()
			}
		},
		_changeTypeToSimple: function() {
			var c = this;
			var f = c._column.expr.argument.id;
			c._column.caption = "";
			c._column.expr = {
				typeName: "ENTATTR",
				id: f
			};
			var e = c._column;
			var d = c._active;
			c.destroy();
			c._clear();
			c.element.ColumnRow_ENTATTR({
				columnsPanel: c.options.columnsPanel
			});
			c.element.ColumnRow_ENTATTR("init", e);
			c._fireColumnChange("change");
			if (d) {
				c.options.columnsPanel._activeColumn = null;
				c.element.ColumnRow_ENTATTR("makeActive")
			}
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.ColumnRow_CaptionEditor", a.eqjs.ValueEditor_EDIT, {
		_column: null,
		_defaultValue: "",
		_editBoxClass: "eqjs-qc-ce-editbox",
		_onChange: null,
		options: {
			cssClassPrefix: "eqjs-qc"
		},
		init: function(e, c, d) {
			this._editBoxClass = this.options.cssClassPrefix + "-ce-editbox";
			this._expr.value = e.caption;
			this._expr.text = e.caption;
			this._column = e;
			this._defaultValue = c;
			this._onChange = d;
			this.refresh()
		},
		_render: function() {
			this.clear();
			if (this._column) {
				this._renderCommonPart();
				this._renderEditor();
				this._linkElement.text(this._getDisplayText())
			}
		},
		_renderCommonPart: function() {
			var c = this;
			c.element.addClass(c._getClassesToAdd());
			c._linkElement = a("<a></a>", {
				href: "javascript:void(0)",
				text: "-"
			}).appendTo(c.element);
			c._linkElement.click(function() {
				c._showEditor();
				return false
			})
		},
		_getClassesToAdd: function() {
			return this.options.cssClassPrefix + "-colelement " + this.options.cssClassPrefix + "-captionelement"
		},
		_setValue: function(c) {
			if (!c || c == "") {
				this._column.caption = this._defaultValue
			} else {
				this._column.caption = c
			}
			this._linkElement.text(this._column.caption);
			if (this._onChange) {
				this._onChange(c)
			}
		},
		_getValue: function() {
			return this._column.caption
		},
		_getText: function() {
			return this._column.caption
		},
		_getDisplayText: function() {
			return this._column.caption
		},
		_getZIndex: function() {
			return 100000
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.EntitiesPanel", {
		_rootEntityBlock: null,
		_model: null,
		_progressBlock: null,
		options: {
			queryPanelId: "QueryPanel",
			columnsPanelId: "ColumnsPanel",
			showToolbar: true,
			showSelectAllButton: false,
			showClearSelectionButton: true,
			showAddColumnButton: true,
			showAddConditionButton: true,
			showCheckboxes: true,
			clickableAttributes: 0,
			draggableAttributes: true,
			showAttributes: {
				usedInConditions: true,
				usedInColumns: true,
				usedInSorting: false
			},
			showFilterBox: false,
			showIndicatorOnLoad: true
		},
		getSelf: function() {
			return this
		},
		getModel: function() {
			return this._model
		},
		setModel: function(c) {
			this._model = c;
			this._render()
		},
		_create: function() {
			var c = this
		},
		_renderProgressBlock: function() {
			this._progressBlock = a('<div class="eqjs-progress-win8"><div class="wBall" id="wBall_1"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_2"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_3"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_4"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_5"><div class="wInnerBall"></div></div></div>')
		},
		_render: function() {
			var d = this,
				c;
			this._clear();
			var e = this.getModel();
			this.element.addClass("eqjs-ep-panel");
			if (e != null && !e.isEmpty()) {
				this._rootEntityBlock = a("<div></div>");
				c = this.element.append(this._renderEntity(e.getRootEntity(), this._rootEntityBlock, 0))
			}
			if (this.options.showFilterBox) {
				this._createFilterBox(c)
			} else {
				this._rootEntityBlock.css("top", "0")
			}
			if (this.options.showToolbar) {
				this._createToolPanel(c)
			} else {
				this._rootEntityBlock.css("bottom", "0")
			}
			this._renderProgressBlock()
		},
		_renderEntity: function(q, n, m) {
			var s = this;
			var r = "eqjs-ep-entity",
				k, g = a("<div></div>", {
					"class": r + "-node"
				}),
				t = a("<div></div>", {
					"class": r + "-children"
				}),
				z = a("<label></label>", {
					"class": r + "-node-label"
				}),
				C = a("<input />", {
					type: "checkbox"
				}),
				e = a("<a></a>", {
					href: "javascript:void(0)",
					"class": r + "-node-button"
				}),
				o, l, w, y, u, x, h = a("<div></div>"),
				A = m;
			var c = function(D, i) {
					var j = i.find("." + r + '-attr[data-id="' + D + '"]');
					return j.length > 0
				};
			var d = function(i) {
					return (s.options.showAttributes.usedInConditions && i.uic) || (s.options.showAttributes.usedInColumns && i.uir) || (s.options.showAttributes.usedInSorting && i.uis)
				};
			if (n) {
				k = n;
				k.html("").addClass(r)
			} else {
				k = a("<div></div>", {
					"class": r
				})
			}
			if (q.name && q.name != "") {
				x = EQ.core.getText("Entities", q.name);
				if (!x) {
					x = q.caption
				}
				z.text(x).appendTo(g);
				if (s.options.showCheckboxes) {
					z.prepend(C)
				}
				e.prependTo(g);
				for (var w = 0; w < A; w++) {
					g.prepend(a("<div></div>", {
						"class": r + "-offset"
					}))
				}
				k.append(g);
				t.hide();
				A++
			} else {} if (q.subEntities) {
				var B = q.subEntities.length;
				var w;
				for (w = 0; w < B; w++) {
					y = q.subEntities[w];
					if (d(y)) {
						t.append(s._renderEntity(y, null, A))
					}
				}
			}
			e.click(function(i) {
				t.toggle();
				a(this).toggleClass(r + "-node-button-open");
				i.preventDefault()
			});
			if (q.attributes) {
				var f = q.attributes.length;
				for (var w = 0; w < f; w++) {
					u = q.attributes[w];
					if (d(u)) {
						if (!u.lookupAttr || !(c(u.lookupAttr, t) || c(u.lookupAttr, this._rootEntityBlock))) {
							x = EQ.core.getText("Attributes", u.id);
							if (!x) {
								x = u.caption
							}
							l = a("<label></label>", {
								text: x,
								"class": r + "-attr-label"
							});
							if (s.options.showCheckboxes) {
								l.prepend('<input type="checkbox" />')
							}
							for (var v = 0; v < A + 1; v++) {
								l.prepend(a("<div></div>", {
									"class": r + "-offset"
								}))
							}
							o = a("<div></div>").attr("class", function() {
								var i = r + "-attr ";
								if (g.html().length == 0) {
									i += r + "-attr-root"
								}
								return i
							}).html(l).attr("data-id", u.id);
							if (s.options.draggableAttributes) {
								o.draggable({
									containment: "document",
									cursor: "move",
									helper: "clone",
									revert: "invalid",
									scope: "entityAttr",
									distance: 20,
									connectToSortable: ".ui-sortable",
									cursorAt: {
										bottom: 20,
										left: 10
									},
									start: function(i, j) {
										j.helper.find("input").hide()
									},
									appendTo: "body"
								})
							}
							if (s.options.clickableAttributes == 1) {
								o.click(function() {
									var i = a("#" + s.options.queryPanelId);
									i.QueryPanel("addNewConditionIntoActivePredicate", a(this).data("id"))
								})
							}
							t.append(o)
						}
					}
				}
			}
			if (t.html().length) {
				k.append(t)
			}
			if (t) {
				t.find("label input").click(function(i) {
					if (a(this).prop("checked") && !(C.prop("checked"))) {
						C.prop("checked", true)
					} else {
						if (t.find("input:checked").length == 0) {
							C.prop("checked", false)
						}
					}
				})
			}
			C.click(function() {
				if (a(this).prop("checked")) {
					t.find("label input").prop("checked", true)
				} else {
					t.find("label input").prop("checked", false)
				}
			});
			return k
		},
		_createFilterBox: function(e) {
			var d = this;
			var g = "eqjs-ep-filter-box",
				f = a("<div></div>", {
					"class": g
				}),
				c = a("<input></input>", {
					"class": g + "-input"
				});
			f.append(c);
			d.element.prepend(f)
		},
		_createToolPanel: function(d) {
			var l = this;
			var f = "eqjs-ep-tool-panel",
				m = a("<div></div>", {
					"class": f
				}),
				g = a("<div></div>", {
					"class": f + "-select-all",
					title: "Select all"
				}),
				c = a("<div></div>", {
					"class": f + "-deselect-all",
					title: "Clear selection"
				}),
				k = a("<div></div>", {
					"class": f + "-add-columns",
					title: "Add column"
				}),
				e = a("<div></div>", {
					"class": f + "-add-cond",
					title: "Add condition"
				}),
				j = a("<div></div>", {
					"class": f + "-left-side"
				}),
				i = a("<div></div>", {
					"class": f + "-right-side"
				});
			var h = l.getModel();
			if (this.options.showSelectAllButton) {
				j.append(g)
			}
			if (this.options.showClearSelectionButton) {
				j.append(c)
			}
			i.append(k, e);
			m.append(j, i);
			g.click(function() {
				d.find("input").prop("checked", true)
			});
			c.click(function() {
				d.find("input").prop("checked", false)
			});
			k.click(function() {
				var n = a("#" + l.options.columnsPanelId);
				var s = l.element.find(".eqjs-ep-entity-attr");
				var r = [];
				var q, o;
				a.each(s, function(u, v) {
					v = a(v);
					var t = v.find("input").first();
					if (t.prop("checked")) {
						q = v.data("id");
						if (h.checkAttrProperty(q, "uir")) {
							r.push(q)
						}
					}
				});
				n.ColumnsPanel("addNewColumn", r)
			});
			e.click(function() {
				var n = a("#" + l.options.queryPanelId);
				var s = l.element.find(".eqjs-ep-entity-attr");
				var r = [];
				var q, o;
				a.each(s, function(u, v) {
					v = a(v);
					var t = v.find("input").first();
					if (t.prop("checked")) {
						q = v.data("id");
						if (h.checkAttrProperty(q, "uic")) {
							r.push(q)
						}
					}
				});
				n.QueryPanel("addNewCondition", r)
			});
			this.element.append(m)
		},
		_setOption: function(c, d) {
			if (arguments.length == 2) {
				this.options[c] = d;
				this._render();
				return this
			} else {
				return this.options[c]
			}
		},
		_clear: function() {
			this.element.html("")
		},
		refresh: function() {
			this._render()
		},
		resize: function() {
			this._render()
		},
		startLoading: function() {
			if (this.options.showIndicatorOnLoad) {
				this.element.append(this._progressBlock)
			}
		},
		finishLoading: function() {
			if (this.options.showIndicatorOnLoad) {
				this.element.find(this._progressBlock).remove()
			}
		}
	})
})(jQuery);
(function(d, g) {
	var f = function(j, i, l) {
			if (i === l) {
				return
			}
			var k = j[i];
			j[i] = j[l];
			j[l] = k;
			delete k
		};
	d.widget("eqjs.ColumnsBarOld", {
		_query: null,
		_activeColumn: null,
		_activeColumnIndex: null,
		_contentBlockClass: "eqjs-cb-inner-wrapper",
		_colsBlockClass: "eqjs-cb-inner",
		_width: 0,
		_leftBtn: null,
		_rightBtn: null,
		_uiUpdaterId: null,
		options: {
			showAddButton: true,
			addButtonSide: "left",
			addButtonHTML: "+",
			innerPaddingCompensation: {
				right: 38,
				left: 35
			},
			allowAggrColumns: true,
			allowSorting: true,
			sortByList: ["None", "Ascending", "Descending"],
			placeholderHeight: 22,
			adjustEntitiesMenuHeight: true,
			attrElementFormat: "{entity} {attr}",
			alwaysShowButtons: false,
			accentActiveColumn: true,
			uiUpdateInterval: 200,
			scrollSpeed: 15,
			showScrollBar: true,
			scrollButtonsScrollBy: 500,
			scrollButtonsLeftHTML: "&lt; ...",
			scrollButtonsRightHTML: "... &gt;"
		},
		_setOption: function(i, j) {
			if (i == "query") {
				this.setQuery(j)
			} else {
				if (arguments.length == 2) {
					this.options[i] = j;
					this._render();
					return this
				} else {
					return this.options[i]
				}
			}
		},
		_create: function() {
			this._render()
		},
		_clear: function() {
			this.element.html("")
		},
		getModel: function() {
			var i = this.getQuery();
			return i ? i.getModel() : null
		},
		getQuery: function() {
			return this._query
		},
		setQuery: function(i) {
			this._query = i;
			this.refresh()
		},
		init: function(i) {
			this.setQuery(i)
		},
		refresh: function() {
			this._render()
		},
		resize: function() {
			this._render()
		},
		_render: function() {
			this._clear();
			if (!this.getModel()) {
				return
			}
			this.options.entitiesList = this.getModel().getEntitiesTree({
				addUIC: false,
				addUIR: true,
				addUIS: false
			});
			this.options.entitiesMenu = this._createEntitiesMenu();
			this._refreshByQuery();
			var i = "eqjs-cb-with-add-button-on-";
			this.element.removeClass(i + "left").removeClass(i + "right");
			if (this.options.showAddButton) {
				this.element.addClass(i + this.options.addButtonSide);
				this._showAddButton()
			}
		},
		_refreshByQuery: function() {
			if (!this.getQuery()) {
				return
			}
			var u = this;
			var t = d("<div></div>").addClass(u._colsBlockClass),
				j = d("<div></div>").addClass(u._contentBlockClass);
			var r = u.getQuery();
			var k = r ? r.getColumns() : null,
				i = function(x, z, v) {
					var y = k[colIdx];
					var w = z["ColumnsBarColumn_" + y.expr.typeName];
					w.call(z, {
						columnsBar: x,
						query: x.getQuery()
					});
					w.call(z, "init", y);
					return {
						wfn: w,
						element: z
					}
				};
			var l = (typeof u._activeColumnIndex) === "number";
			for (colIdx in k) {
				var q = i(u, d("<div></div>").appendTo(t), colIdx);
				if (l && +colIdx === u._activeColumnIndex) {
					q.wfn.call(q.element, "setActiveColumn");
					q.element.click()
				}
			}
			var o = t.children("div");
			t.appendTo(j);
			j.appendTo(u.element);
			if (!u.options.showScrollBar) {
				j.css("overflow-x", "hidden");
				u._leftBtn = u._makeScrollButton({
					html: u.options.scrollButtonsLeftHTML,
					t: "left",
					otherT: "right",
					scrollLeft: "-=" + u.options.scrollButtonsScrollBy
				});
				u._rightBtn = u._makeScrollButton({
					html: u.options.scrollButtonsRightHTML,
					t: "right",
					otherT: "left",
					scrollLeft: "+=" + u.options.scrollButtonsScrollBy
				});
				u.element.prepend(u._leftBtn.hide());
				u.element.prepend(u._rightBtn.hide())
			} else {
				j.css("overflow-x", "auto");
				u._leftBtn = null;
				u._rightBtn = null
			}
			if (u._uiUpdaterId) {
				clearInterval(u._uiUpdaterId)
			}
			u._uiUpdaterId = window.setInterval(function() {
				var v = 2;
				var w = v;
				o.each(function() {
					w += d(this).outerWidth(true)
				});
				if (w > v && w !== u._width) {
					u._width = w;
					u.element.find("." + u._colsBlockClass).css({
						width: w
					})
				}
				if (u._leftBtn && u._rightBtn) {
					u._updateScrollButtonVisibility(u._leftBtn, "left");
					u._updateScrollButtonVisibility(u._rightBtn, "right")
				}
			}, u.options.uiUpdateInterval);
			var n, s, m = false;
			t.sortable({
				cursor: "move",
				tolerance: "pointer",
				cancel: ".eqjs-cb-column-buttonsBlock, .eqjs-cb-colelement, .eqjs-cb-sortbutton, .eqjs-ce-editbox",
				placeholder: "eqjs-cb-column-placeholder",
				forcePlaceholderSize: true,
				scroll: true,
				scrollSpeed: this.options.scrollSpeed,
				delay: 100,
				distance: 13,
				forceHelperSize: true,
				start: function(v, w) {
					n = w.item.index();
					w.item.addClass("eqjs-cb-column-sort");
					w.placeholder.height(u.options.placeholderHeight)
				},
				update: function(v, w) {
					s = w.item.index();
					if (m) {
						m = false;
						k.splice(s, 0, k.pop());
						u.refresh()
					} else {
						f(k, n, s)
					}
				},
				stop: function(v, w) {
					w.item.removeClass("eqjs-cb-column-sort");
					w.item.click();
					u._fireQueryChange("change")
				}
			});
			u.element.droppable({
				tolerance: "touch",
				hoverClass: "eqjs-drophover",
				scope: "entityAttr",
				drop: function(v, w) {
					u.addNewColumn(w.draggable.attr("data-id"));
					m = true
				},
				over: function(v, w) {
					w.helper.addClass("eqjs-cb-column-drag")
				},
				out: function(v, w) {
					w.helper.removeClass("eqjs-cb-column-drag")
				}
			});
			(!t.children().length) ? j.hide() : j.show()
		},
		_makeScrollButton: function(n) {
			var i = this,
				l = n.t,
				j = n.otherT;
			var m = function(o) {
					return "eqjs-cb-button-" + o
				};
			var k = d("<span></span>").addClass(m(l)).html(n.html);
			k.click(function() {
				d(this).parent().find("." + i._contentBlockClass).animate({
					scrollLeft: n.scrollLeft
				})
			});
			return k
		},
		_updateScrollButtonVisibility: function(l, k) {
			var j = l.parent().find("." + this._contentBlockClass);
			var o = j.scrollLeft(),
				n = j.innerWidth(),
				i = this._width;
			if (this.options.showAddButton) {
				i += this.options.innerPaddingCompensation[this.options.addButtonSide]
			}
			if ((n >= i) || !n || o === null) {
				return l.hide()
			}
			var m = {
				left: function() {
					return o
				},
				right: function() {
					return i - (n + o)
				}
			}[k]();
			(m <= 0) ? l.hide() : l.show()
		},
		_showAddButton: function() {
			var k = this.options.addButtonSide;
			var l = d('<div class="eqjs-cb-add-button"></div>');
			l.prependTo(this.element).css(k, this.element.css("padding-" + k));
			var i = d('<a href="javascript:void(0)"></a>').html(this.options.addButtonHTML).appendTo(l);
			var j = this;
			i.click(function() {
				j.showEntitiesMenu({
					anchor: i,
					selectedIds: null,
					itemSelectedCallback: function(m, q) {
						var o = q.menuItem.id;
						var n = j.getModel().getAttributeById(o);
						j.addNewColumn(o);
						return false
					}
				})
			})
		},
		showEntitiesMenu: function(k, j) {
			var i = this;
			i.options.entitiesMenu.PopupMenu("showMenu", k)
		},
		clearColumns: function(i) {
			this.getQuery().clearColumns();
			if (i !== false) {
				this.refresh()
			}
		},
		_createEntitiesMenu: function() {
			if (!this.getModel()) {
				return null
			}
			var i = d("<div></div>").hide().appendTo(this.element);
			i.PopupMenu({
				items: this.options.entitiesList,
				adjustHeight: this.options.adjustEntitiesMenuHeight
			});
			return i
		},
		_fireQueryChange: function(i) {
			var j = this;
			this.getQuery().fireChangedEvent({
				source: j,
				changeType: "query." + i
			})
		},
		_fireColumnChange: function(i, k) {
			var j = this;
			k = k || j._column;
			this.getQuery().fireChangedEvent({
				source: j,
				changeType: "column." + i,
				column: k
			})
		},
		addNewColumn: function(o, l) {
			var j = this;
			var q = function(i) {
					var r = j.getModel().getAttributeById(i);
					if (!r) {
						return null
					}
					if (!r.uir) {
						if (r.lookupAttr) {
							i = r.lookupAttr;
							r = j.getModel().getAttributeById(i);
							if (!r || !r.uir) {
								return null
							}
						} else {
							return null
						}
					}
					return {
						caption: "",
						sorting: "None",
						sortIndex: -1,
						expr: {
							typeName: "ENTATTR",
							id: i
						}
					}
				};
			if (!j.getQuery()) {
				return
			}
			var n, k;
			if (d.isArray(o)) {
				n = [];
				for (var m = 0; m < o.length; m++) {
					k = q(o[m]);
					if (k) {
						n.push(k)
					}
				}
			} else {
				n = q(o)
			}
			j.addColumn(n, l);
			return n
		},
		addColumn: function(l, j) {
			var i = this;
			var m = this.getQuery();
			if (!m) {
				return
			}
			var k = m.getColumns();
			if (!l || (d.isArray(l) && l.length == 0)) {
				return
			}
			if (typeof j == "number") {
				k.splice.apply(k, [j, 0].concat(l))
			} else {
				k.push.apply(k, [].concat(l))
			}
			i._width += (i._initialWidth * 4);
			i.refresh();
			i._fireColumnChange("add", l)
		},
		removeColumn: function(l) {
			var i = this;
			var m = this.getQuery();
			if (!m) {
				return
			}
			var k = m.getColumns();
			var j = d.inArray(l, k);
			if (j >= 0) {
				if (j === i._activeColumnIndex) {
					i._activeColumnIndex = null
				}
				k.splice(j, 1);
				i.refresh();
				i._fireColumnChange("remove", l)
			}
		},
		removeColumnByAttrId: function(o) {
			var i = this;
			var n = this.getQuery();
			if (!n) {
				return
			}
			var l = n.getColumns();
			var k = 0;
			var m = l.length;
			while (k < m) {
				var j = l[k];
				if (j.expr.typeName == "ENTATTR" && j.expr.id == o) {
					break
				}
				k++
			}
			if (k < m) {
				l.splice(k, 1);
				i._fireColumnChange("remove", j);
				i.refresh()
			}
		},
		setActiveColumn: function(i) {
			if (this._activeColumn) {
				this._activeColumn.deactivate()
			}
			this._activeColumn = i;
			if (this._activeColumn) {
				this._activeColumn.activate()
			}
		},
		getActiveColumn: function() {
			return this._activeColumn
		},
		setActiveColumnIndex: function(i) {
			this._activeColumnIndex = i
		}
	});
	var h = function(k, j, n) {
			var l = k.self.options.columnsBar._query.getColumns();
			if (!l.length) {
				return
			}
			f(l, j, n);
			var m = k.self.options.columnsBar.getActiveColumn();
			if (m && m._active && m.element.length) {
				var i = m.element.index();
				if (i === j) {
					return n
				} else {
					if (i === n) {
						return j
					}
				}
			}
		};
	var c = function(k, j) {
			var i = j.parent().parent().parent();
			if ((typeof k) !== "undefined") {
				i.ColumnsBar("setActiveColumnIndex", k)
			}
			i.ColumnsBar("refresh")
		};
	var a = [{
		id: "|<-",
		text: EQ.core.getText("CmdMoveToStart"),
		fn: function(i) {
			c(h(i, 0, i.self.element.index()), i.self.element)
		}
	}, {
		id: "->",
		text: EQ.core.getText("CmdMoveRight"),
		fn: function(j) {
			var k = j.self.element;
			var i = k.next();
			if (!i.length) {
				return
			}
			c(h(j, i.index(), k.index()), k)
		}
	}, {
		id: "<-",
		text: EQ.core.getText("CmdMoveLeft"),
		fn: function(i) {
			var k = i.self.element;
			var j = k.prev();
			if (!j.length) {
				return
			}
			c(h(i, j.index(), k.index()), k)
		}
	}, {
		id: "->|",
		text: EQ.core.getText("CmdMoveToEnd"),
		fn: function(i) {
			var k = i.self.element;
			var j = k.parent().children().last();
			if (!j.length) {
				return
			}
			c(h(i, j.index(), k.index()), k)
		}
	}];
	var b = function(i, j) {
			var k = i.indexOf(j) + 1;
			return (k == i.length) ? i[0] : i[k]
		};
	d.widget("eqjs.ColumnsBarColumn", {
		_column: null,
		_sortingButton: null,
		_buttonsBlock: null,
		_menuButton: null,
		_menuButtonMenu: null,
		_deleteButton: null,
		_keepShowingButtons: false,
		_isMouseOverBlock: false,
		_classesToAdd: "",
		_active: false,
		options: {
			columnsBar: null,
			query: null
		},
		getQuery: function() {
			return this.options.columnsBar.getQuery()
		},
		getModel: function() {
			var i = this.getQuery();
			return i ? i.getModel() : null
		},
		init: function(i) {
			this._column = i;
			this.refresh()
		},
		_render: function() {
			this._clear();
			if (this.getModel() && this._column) {
				this._refreshByColumn();
				this._initButtons()
			}
		},
		_fireColumnChange: function(i, k) {
			var j = this;
			k = k || j._column;
			var l = this.qetQuery();
			if (!l) {
				return
			}
			l.fire({
				query: j.options.columnsBar.options.query,
				changeType: "column." + i,
				condition: k
			})
		},
		refresh: function() {
			this._render()
		},
		_setOption: function(i, j) {
			if (arguments.length == 2) {
				this.options[i] = j;
				if (i === "disabled") {
					this._column.enabled = !j
				}
				this._render();
				return this
			} else {
				if (i === "disabled") {
					return this._column.enabled === false
				} else {
					return this.options[i]
				}
			}
		},
		_clear: function() {
			this.element.unbind();
			this.element.html("");
			this.element.removeClass()
		},
		_refreshByColumn: function() {},
		remove: function() {
			var i = this;
			if (!i.options.columnsBar) {
				return
			}
			i.options.columnsBar.removeColumn(i._column);
			i._fireColumnChange("delete")
		},
		_initMenu: function() {
			var j = this._getMenuButtonMenuItems();
			var k = function(n, t, l) {
					for (var m = 0, q = n.length; m < q; m++) {
						var s = n[m];
						if (s.items) {
							var o = k(s.items, t, l);
							if (o) {
								return true
							}
						} else {
							if (t == s.id) {
								if (s.fn) {
									s.fn(l)
								}
								return true
							}
						}
					}
					return false
				};
			this._menuButtonMenu = d("<div></div>").hide().appendTo(this.element);
			this._menuButtonMenu.PopupMenu({
				items: j
			});
			var i = this;
			i._menuButton.click(function() {
				i._menuButtonMenu.PopupMenu("showMenu", {
					anchor: i._menuButton,
					selectedIds: null,
					itemSelectedCallback: function(l, m) {
						k(j, m.menuItem.id, {
							self: i,
							evt: l,
							data: m
						});
						return false
					},
					menuClosedCallback: function() {
						if (!i._isMouseOverBlock) {
							i._menuButtonMenu.trigger("mouseleave")
						}
					}
				})
			})
		},
		_initButtons: function() {
			var j = this;
			var i = j.element;
			if (!i) {
				return
			}
			j._buttonsBlock = d("<span></span>").addClass("eqjs-cb-column-buttonsBlock").appendTo(i);
			j._menuButton = d("<span></span>").addClass("eqjs-cb-column-button-menu").attr("title", EQ.core.getText("ButtonMenu")).appendTo(j._buttonsBlock);
			j._initMenu();
			j._deleteButton = d("<span></span>").addClass("eqjs-cb-column-button-delete").attr("title", EQ.core.getText("ButtonDelete")).appendTo(j._buttonsBlock).click(function() {
				j.remove()
			});
			j._sortingButton = d("<span></span>").addClass("eqjs-colelement eqjs-cb-button-sort").prependTo(j.element);
			if (j.options.columnsBar.options.allowSorting != false) {
				j._sortingButton.attr("title", EQ.core.getText("ButtonSorting")).click(function() {
					j._column.sorting = b(j.options.columnsBar.options.sortByList, j._column.sorting);
					j.refresh();
					j._fireColumnChange("change")
				});
				if (j._column.sorting === "None") {
					j._sortingButton.addClass("eqjs-cb-column-button-sort-none")
				}
				j._sortingButton.hover(function() {
					d(this).addClass("eqjs-cb-column-button-sort-active")
				}, function() {
					d(this).removeClass("eqjs-cb-column-button-sort-active")
				})
			}
			if (j._column.sorting === "Ascending") {
				j._sortingButton.addClass("eqjs-cb-column-button-sort-asc").attr("title", EQ.core.getText("ButtonSorting"))
			} else {
				if (j._column.sorting === "Descending") {
					j._sortingButton.addClass("eqjs-cb-column-button-sort-desc").attr("title", EQ.core.getText("ButtonSorting"))
				}
			}
			i.find("[class*=eqjs-column-button]").hover(function() {
				d(this).addClass("eqjs-cb-column-button-sort-active")
			}, function() {
				d(this).removeClass("eqjs-cb-column-button-sort-active")
			});
			i.bind("mouseenter", function(k) {
				j._isMouseOverBlock = true;
				j._enterButtonBlock();
				k.stopPropagation();
				return false
			}).bind("mouseleave", function(k) {
				j._isMouseOverBlock = false;
				if (!j._keepShowingButtons) {
					j._leaveButtonBlock()
				}
				k.stopPropagation();
				return false
			});
			j._hideButtons();
			j._adjustButtonsVisibility()
		},
		_adjustButtonsVisibility: function() {
			if (this.options.columnsBar.options.alwaysShowButtons || (this.options.columnsBar.options.accentActiveColumn && this._active)) {
				this._showButtons()
			}
		},
		_enterButtonBlock: function() {
			this._showButtons()
		},
		_leaveButtonBlock: function() {
			if (this.options.columnsBar.options.alwaysShowButtons != true && (!this._active || this.options.columnsBar.options.accentActiveColumn != true)) {
				this._hideButtons()
			}
		},
		_showButtons: function() {
			var i = function(j) {
					j.css("visibility", "visible")
				};
			i(this._deleteButton);
			i(this._menuButton);
			if (this.options.columnsBar.options.allowSorting != false) {
				i(this._sortingButton)
			}
		},
		_hideButtons: function() {
			var i = function(j) {
					j.css("visibility", "hidden")
				};
			i(this._deleteButton);
			i(this._menuButton);
			if (this._column.sorting === "None") {
				i(this._sortingButton)
			}
		},
		activate: function() {
			this._active = true;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		deactivate: function() {
			this._active = false;
			this.adjustActiveClass();
			this._hideButtons();
			this._adjustButtonsVisibility()
		},
		adjustActiveClass: function() {
			if (this._active) {
				this.element.addClass("active")
			} else {
				this.element.removeClass("active")
			}
		},
		isActive: function() {
			return this._active
		},
		setActiveColumn: function() {
			this.options.columnsBar.setActiveColumn(this)
		}
	});
	var e = function(i) {
			return [{
				id: "sep",
				text: "-------"
			}].concat(i)
		};
	d.widget("eqjs.ColumnsBarColumn_ENTATTR", d.eqjs.ColumnsBarColumn, {
		_classesToAdd: "eqjs-cb-column eqjs-cb-column-entattr",
		_baseAttr: null,
		_menuFunctionsBlock: null,
		_getMenuButtonMenuItems: function() {
			if (!this.options.columnsBar.options.allowAggrColumns) {
				return a
			}
			var i = this._createFunctionMenuItems(function(k) {
				k.self._changeTypeToAggr(k.data.menuItem.id)
			}),
				j = a;
			if (i) {
				j = e(j)
			}
			return i.concat(j)
		},
		_fillBaseBlock: function(i) {
			i.addClass("eqjs-expr-block");
			this._baseAttr = this._getAttribute();
			if (!this._column.caption) {
				this._column.caption = this._getDefaultCaption()
			}
		},
		_refreshByColumn: function() {
			if (!this._column || !this.getModel()) {
				return
			}
			var i = this;
			i.element.addClass(i._classesToAdd);
			var k = d("<span></span>").appendTo(i.element);
			i._fillBaseBlock(k);
			if (i.options.columnsBar.options.accentActiveColumn) {
				i.element.click(function() {
					if (!i._active) {
						i.setActiveColumn()
					}
				})
			}
			if (!i._column.caption || i._column.caption == "") {
				i._column.caption = i._getDefaultCaption()
			}
			var j = d("<span></span>");
			j.appendTo(this.element);
			var l = function() {
					i._fireColumnChange("change")
				};
			j.ColumnsBarColumn_CaptionEditor();
			j.ColumnsBarColumn_CaptionEditor("init", i._column, i._getDefaultCaption(), l);
			i.adjustActiveClass()
		},
		_getDefaultCaption: function() {
			return this._getAttributeText(this._baseAttr)
		},
		_getAttribute: function() {
			return this.getModel().getAttributeById(this._column.expr.id)
		},
		_getAttributeText: function(k) {
			var j = this;
			if (!k) {
				return ""
			}
			var n = EQ.core.getText("Attributes", k.id);
			if (!n) {
				n = k.caption
			}
			if (!j.options.columnsBar) {
				return n
			}
			var l = j.options.columnsBar.options.attrElementFormat;
			if (!l) {
				return n
			}
			var i = l.replace(new RegExp("{attr}", "g"), n);
			var m = j.getModel().getFullEntityPathByAttr(k.id, ".");
			i = i.replace(new RegExp("{entity}", "g"), m);
			return i
		},
		_changeTypeToAggr: function(l) {
			var i = this;
			if (!l) {
				l = i._menuFunctionsBlock.PopupMenu("option", "items")[0].id
			}
			var m = i._column.expr.id;
			i._column.expr = {
				func: l,
				distinct: false,
				typeName: "AGGRFUNC",
				argument: {
					typeName: "ENTATTR",
					id: m
				}
			};
			var k = i._column;
			var j = i._active;
			i.destroy();
			i._clear();
			i.element.ColumnsBarColumn_AGGRFUNC({
				columnsBar: i.options.columnsBar,
				model: i.getModel()
			});
			i.element.ColumnsBarColumn_AGGRFUNC("init", k);
			i._fireColumnChange("change");
			if (j) {
				i.options.columnsBar._activeColumn = null;
				i.element.ColumnsBarColumn_AGGRFUNC("setActiveColumn")
			}
		},
		_createFunctionMenuItems: function(n) {
			var s = this;
			var m = [];
			var k = s.getModel().aggrFunctions;
			var i = true;
			var o = true;
			var r = null;
			var j = s._getAttribute();
			var l;
			for (var q in k) {
				if (!k[q]) {
					continue
				}
				i = true;
				if (k[q].id === "SUM" || k[q].id === "AVG") {
					i = d.inArray(j.dataType, ["Autoinc", "Byte", "Currency", "Float", "Int", "Int64", "Word"]) >= 0
				} else {
					if (k[q].id === "MIN" || k[q].id === "MAX") {
						i = d.inArray(j.dataType, ["Autoinc", "BCD", "Byte", "Currency", "Date", "DateTime", "Float", "Int", "Int64", "Time", "Word"]) >= 0
					}
				}
				if (s._column.expr.func === k[q].id && !i) {
					o = false
				}
				if (i) {
					l = s.getModel().getAggrFunctionCaption(k[q].id);
					r = {
						id: k[q].id,
						text: l,
						fn: n
					};
					if (s._column.expr.func !== r.id) {
						m.push(r)
					}
				}
			}
			if (m && !o) {
				s._column.expr.func = m[0].id
			}
			return m
		}
	});
	d.widget("eqjs.ColumnsBarColumn_AGGRFUNC", d.eqjs.ColumnsBarColumn_ENTATTR, {
		_classesToAdd: "eqjs-cb-column eqjs-cb-column-aggr",
		_getMenuButtonMenuItems: function() {
			return [{
				id: "to-simple",
				text: EQ.core.getText("CmdToSimple"),
				fn: function(i) {
					i.self._changeTypeToSimple()
				}
			}].concat(this._createFunctionMenuItems(function(i) {
				i.self._changeTypeToSimple();
				i.self._changeTypeToAggr(i.data.menuItem.id);
				i.self.refresh();
				i.self._fireColumnChange("change")
			})).concat(e(a))
		},
		_displayFormatParser: {
			formatStr: "",
			pos: 0,
			token: "text",
			tokenText: "",
			start: function(i) {
				this.formatStr = i;
				this.pos = 0;
				this.tokenText = ""
			},
			skipSpaces: function() {
				while (this.pos < this.formatStr.length && this.formatStr.charAt(this.pos) === " ") {
					this.pos++
				}
			},
			next: function() {
				this.skipSpaces();
				if (this.pos >= this.formatStr.length) {
					return false
				}
				var k = 0;
				if (this.formatStr.charAt(this.pos) === "{") {
					k = this.formatStr.indexOf("}", this.pos);
					if (k < 0) {
						return false
					}
					this.tokenText = this.formatStr.substring(this.pos, k + 1);
					if (this.tokenText.indexOf("{attr") === 0) {
						this.token = "attribute"
					}
					this.pos = k + 1
				} else {
					if (this.formatStr.charAt(this.pos) === "[" && this.pos < this.formatStr.length - 1 && this.formatStr.charAt(this.pos + 1) === "[") {
						this.pos += 2;
						k = this.formatStr.indexOf("]]", this.pos);
						this.token = "function";
						this.tokenText = this.formatStr.substring(this.pos, k);
						this.pos = k + 2
					} else {
						this.token = "text";
						var j = this.formatStr.indexOf("{", this.pos);
						if (j < 0) {
							j = this.formatStr.length
						}
						var i = this.formatStr.indexOf("[[", this.pos);
						if (i < 0) {
							i = this.formatStr.length
						}
						k = Math.min(j, i);
						this.tokenText = d.trim(this.formatStr.substring(this.pos, k));
						this.pos = k
					}
				}
				return true
			}
		},
		_parseDisplayFormat: function(j) {
			if (!j) {
				return []
			}
			var i = [];
			var k = this._displayFormatParser;
			k.start(j);
			while (k.next()) {
				if (k.token === "function") {
					i.push({
						type: "function",
						text: k.tokenText
					})
				} else {
					if (k.token === "attribute") {
						i.push({
							type: "attribute"
						})
					} else {
						if (k.token === "text") {
							i.push({
								type: "text",
								text: k.tokenText
							})
						}
					}
				}
			}
			return i
		},
		_fillBaseBlock: function(n) {
			var s = this;
			n.addClass("eqjs-expr-block eqjs-expr-block-aggr");
			var q = s.getModel().getAggrFunctionFormat(s._column.expr.func);
			if (!q || q === "") {
				return
			}
			var k = s._parseDisplayFormat(q);
			if (k.length === 0) {
				return
			}
			var m = [];
			var r, o;
			for (var l = 0, j = k.length; l < j; l++) {
				r = k[l];
				o = r.type;
				if (o === "function" || o === "text") {
					m.push(r.text)
				} else {
					if (o === "attribute") {
						s._baseAttr = s._getAttribute();
						m.push(s._getAttributeText(s._baseAttr))
					}
				}
			}
			this._column.caption = m.join(" ")
		},
		_getDefaultCaption: function() {
			return this._getAttributeText(this._baseAttr) + " " + this.getModel().getAggrFunctionCaption(this._column.expr.func)
		},
		_getAttribute: function() {
			return this.getModel().getAttributeById(this._column.expr.argument.id)
		},
		_changeTypeToSimple: function() {
			var i = this;
			var l = i._column.expr.argument.id;
			i._column.caption = "";
			i._column.expr = {
				typeName: "ENTATTR",
				id: l
			};
			var k = i._column;
			var j = i._active;
			i.destroy();
			i._clear();
			i.element.ColumnsBarColumn_ENTATTR({
				columnsBar: i.options.columnsBar,
				model: i.getModel()
			});
			i.element.ColumnsBarColumn_ENTATTR("init", k);
			i._fireColumnChange("change");
			if (j) {
				i.options.columnsBar._activeColumn = null;
				i.element.ColumnsBarColumn_ENTATTR("setActiveColumn")
			}
		}
	});
	d.widget("eqjs.ColumnsBarColumn_CaptionEditor", d.eqjs.ValueEditor_EDIT, {
		_column: null,
		_defaultValue: "",
		_editBoxClass: "eqjs-ce-editbox",
		_onChange: null,
		init: function(k, i, j) {
			this._expr.value = k.caption;
			this._expr.text = k.caption;
			this._column = k;
			this._defaultValue = i;
			this._onChange = j;
			this.refresh()
		},
		_render: function() {
			this.clear();
			if (this._column) {
				this._renderCommonPart();
				this._renderEditor();
				this._linkElement.text(this._getDisplayText())
			}
		},
		_renderCommonPart: function() {
			var i = this;
			i.element.addClass(i._getClassesToAdd());
			i._linkElement = d("<span></span>", {
				text: "-"
			}).appendTo(i.element);
			i._linkElement.dblclick(function() {
				i._showEditor();
				return false
			})
		},
		_getClassesToAdd: function() {
			return "eqjs-colelement eqjs-captionelement"
		},
		_setValue: function(i) {
			if (!i || i == "") {
				this._column.caption = this._defaultValue
			} else {
				this._column.caption = i
			}
			this._linkElement.text(this._column.caption);
			if (this._onChange) {
				this._onChange(i)
			}
		},
		_getValue: function() {
			return this._column.caption
		},
		_getText: function() {
			return this._column.caption
		},
		_getDisplayText: function() {
			return this._column.caption
		},
		_getZIndex: function() {
			return 100000
		}
	})
})(jQuery);
(function(a, b) {
	a.widget("eqjs.FilterBar", {
		_queryPanelWidget: null,
		_query: null,
		_queryIsChanged: false,
		_headerElement: null,
		_headerIconElement: null,
		_headerTextBlock: null,
		_headerTextElement: null,
		_headerLinkElement: null,
		_headerArrowBlock: null,
		_headerArrowElement: null,
		_qpBlock: null,
		_qpElement: null,
		_buttonsBlock: null,
		_btnApply: null,
		_btnClear: null,
		options: {
			applyOnClose: true,
			showApplyButton: true,
			showClearButton: true,
			useBootstrapIcons: true,
			applyFilterCallback: null,
			queryPanel: {
				showAddRow: true,
				showCheckboxes: true,
				alwaysShowButtonsInPredicates: true
			}
		},
		getQuery: function() {
			return this._query
		},
		setQuery: function(c) {
			if (this._query) {
				this._query.removeChangedCallback(a.proxy(this._queryChangedHandler, this))
			}
			this._query = c;
			this._query.addChangedCallback(a.proxy(this._queryChangedHandler, this));
			this._queryIsChanged = true;
			this._qpElement.QueryPanel("setQuery", this._query);
			this._updateHeader()
		},
		_showQueryPanel: function(d) {
			var c = this;
			c._qpBlock.slideDown(400, function() {
				c._updateHeader();
				if (d) {
					d()
				}
			})
		},
		_hideQueryPanel: function() {
			var c = this;
			c._qpBlock.slideUp(400, function() {
				c._qpBlock.hide();
				c._updateHeader();
				if (c.options.applyOnClose) {
					c.applyFilter()
				}
			})
		},
		applyFilter: function(c) {
			if (this._queryIsChanged || c == true) {
				if (this.options.applyFilterCallback) {
					this.options.applyFilterCallback();
					this._queryIsChanged = false
				}
			}
		},
		clearFilter: function() {
			if (this._query) {
				this._query.clearConditions()
			}
		},
		_queryChangedHandler: function(c) {
			this._updateHeader();
			this._queryIsChanged = true;
			if (c && c.changeType == "condition.add") {
				this._queryPanelWidget.editConditionValue(c.condition)
			}
		},
		_headerClickHandler: function() {
			var c = this;
			if (c._qpBlock.is(":visible")) {
				c._hideQueryPanel()
			} else {
				c._showQueryPanel()
			}
		},
		_create: function() {
			var c = this;
			this.element.addClass("eqjs-fb-container");
			this._headerElement = a("<div></div>").addClass("eqjs-fb-header");
			this.element.append(this._headerElement);
			this._headerIconElement = a("<div></div>").addClass("eqjs-fb-header-icon");
			this._headerElement.append(this._headerIconElement);
			this._headerTextBlock = a("<div></div>").addClass("eqjs-fb-header-textblock");
			this._headerElement.append(this._headerTextBlock);
			this._headerTextElement = a("<span></span>").addClass("eqjs-fb-header-text");
			this._headerTextBlock.append(this._headerTextElement);
			this._headerLinkElement = a('<a href="javascript:void(0)">' + EQ.core.getText("StrNoFilterClickToAdd") + "</a>").addClass("eqjs-fb-header-link").hide().click(function() {
				c._queryPanelWidget.showEntitiesMenu({
					anchor: c._headerLinkElement,
					selectedIds: null,
					itemSelectedCallback: function(d, f) {
						var e = f.menuItem.data("id");
						c._showQueryPanel(function() {
							c._queryPanelWidget.addNewCondition(e)
						})
					}
				})
			});
			this._headerTextBlock.append(this._headerLinkElement);
			this._headerArrowBlock = a("<div></div>").addClass("eqjs-fb-header-arrowblock");
			this._headerElement.append(this._headerArrowBlock);
			this._headerArrowElement = a("<div></div>").addClass("eqjs-fb-header-arrow");
			this._headerArrowBlock.append(this._headerArrowElement);
			this._qpBlock = a("<div></div>").hide();
			this._qpBlock.addClass("eqjs-fb-querypanelblock");
			this.element.append(this._qpBlock);
			this._qpElement = a("<div></div>");
			this._qpElement.addClass("query-panel eqjs-fb-querypanel");
			this._qpElement.QueryPanel(this.options.queryPanel);
			this._qpElement.QueryPanel("setQuery", this._query);
			this._qpBlock.append(this._qpElement);
			this._queryPanelWidget = this._qpElement.data("QueryPanel");
			if (!this._queryPanelWidget) {
				this._queryPanelWidget = this._qpElement.data("eqjs-QueryPanel")
			}
			if (this.options.showApplyButton || this.options.showClearButton) {
				this._buttonsBlock = a("<div></div>").addClass("eqjs-fb-buttonsblock");
				this._qpBlock.append(this._buttonsBlock)
			}
			if (this.options.showApplyButton) {
				this._btnApply = a('<a href="javascript:void(0)"></a>').addClass("eqjs-fb-button eqjs-fb-button-apply").text(EQ.core.getText("ButtonApply")).on("click", a.proxy(this.applyFilter, this));
				this._buttonsBlock.append(this._btnApply)
			}
			if (this.options.showClearButton) {
				this._btnClear = a('<a href="javascript:void(0)"></a>').addClass("eqjs-fb-button eqjs-fb-button-clear").text(EQ.core.getText("ButtonClear")).on("click", a.proxy(this.clearFilter, this));
				this._buttonsBlock.append(this._btnClear)
			}
			a(window).resize(function() {
				c.textResize(c)
			});
			this._render()
		},
		textResize: function(c) {
			c._headerTextBlock.css("width", c.element.width() - c._headerIconElement.outerWidth(true) - (c._headerArrowBlock.is(":visible") ? c._headerArrowBlock.outerWidth(true) : 0) + "px")
		},
		_render: function() {
			var c = this;
			this._headerIconElement.empty();
			if (this.options.useBootstrapIcons) {
				this._headerIconElement.append(a("<span></span>").addClass("glyphicon glyphicon-filter"))
			}
			this._updateHeader();
			this._qpElement.QueryPanel("refresh");
			this.textResize(c)
		},
		refresh: function() {
			this._render()
		},
		_updateHeader: function() {
			var c = this._query ? this._query.getConditionsText() : "";
			if (c == "") {
				c = EQ.core.getText("StrNoFilterDefined")
			}
			this._headerTextElement.text(c).attr("title", c);
			if (!this._query || this._query.isEmptyConditions()) {
				this._headerTextElement.hide();
				this._headerLinkElement.show();
				if (!this._qpBlock.is(":visible")) {
					this._headerArrowBlock.hide();
					this._headerElement.off("click.FilterBar").css("cursor", "")
				}
			} else {
				this._headerElement.off("click.FilterBar").on("click.FilterBar", a.proxy(this._headerClickHandler, this)).css("cursor", "pointer");
				this._headerTextElement.show();
				this._headerLinkElement.hide();
				this._headerArrowBlock.show()
			}
			if (this._qpBlock.is(":visible")) {
				this._headerArrowElement.addClass("eqjs-fb-header-arrowUp")
			} else {
				this._headerArrowElement.removeClass("eqjs-fb-header-arrowUp")
			}
			this.textResize(this)
		}
	})
})(jQuery);
(function($, window) {
	var EQ = window.EQ = window.EQ || {};
	EQ.view = {
		EqDataTable: function(data) {
			if (typeof data === "string") {
				this.table = JSON.parse(data)
			} else {
				this.table = data
			}
		},
		beforeTableRendering: null,
		formatColumnHeader: null,
		formatGridCell: null,
		applyCommonOptions: function(options) {
			if (options.beforeTableRendering) {
				this.beforeTableRendering = options.beforeTableRendering
			}
			if (options.formatColumnHeader) {
				this.formatColumnHeader = options.formatColumnHeader
			}
			if (options.formatGridCell) {
				this.formatGridCell = options.formatGridCell
			}
		},
		isGoogleVisualizationDefined: function() {
			return (typeof google != "undefined") && (typeof google.visualization != "undefined")
		},
		isGoogleChartDefined: function() {
			return this.isGoogleVisualizationDefined() && (typeof google.visualization.PieChart != "undefined")
		},
		getDataTableClass: function() {
			var result = this.EqDataTable;
			if (this.isGoogleVisualizationDefined()) {
				result = google.visualization.DataTable
			}
			return result
		},
		renderGridByDataTable: function(dataTable) {
			if (this.beforeTableRendering) {
				this.beforeTableRendering(dataTable)
			}
			var tbl = $("<table></table>").css("width", "100%");
			var colCount = dataTable.getNumberOfColumns();
			for (var i = 0; i < colCount; i++) {
				var colLabel = dataTable.getColumnLabel(i);
				if (this.formatColumnHeader) {
					colLabel = this.formatColumnHeader(dataTable, i, colLabel)
				}
				tbl.append("<th>" + colLabel + "</th>")
			}
			tbl.wrapInner('<tr class="result-grid-header"></tr>');
			var rowCount = dataTable.getNumberOfRows();
			for (i = 0; i < rowCount; i++) {
				var trbody = "";
				for (var j = 0; j < colCount; j++) {
					var val = dataTable.getFormattedValue(i, j);
					if (this.formatGridCell) {
						val = this.formatGridCell(dataTable, i, j, val)
					}
					var td = "<td>" + val + "</td>";
					trbody += td
				}
				tbl.append("<tr>" + trbody + "</tr>")
			}
			return tbl
		},
		renderGridOldStyle: function(resultSet) {
			var tbl = $("<table />").css("width", "100%");
			for (var i = 0; i < resultSet.cols.length; i++) {
				tbl.append("<th>" + resultSet.cols[i] + "</th>")
			}
			tbl.wrapInner('<tr class="result-grid-header"></tr>');
			for (i = 0; i < resultSet.rows.length; i++) {
				var trbody = "";
				var row = resultSet.rows[i];
				for (var j = 0; j < row.length; j++) {
					trbody += "<td>" + row[j] + "</td>"
				}
				tbl.append("<tr>" + trbody + "</tr>")
			}
			return tbl
		},
		renderPageNavigator: function(options) {
			var pageIndex = options.pageIndex || 1;
			var pageCount = options.pageCount || 1;
			var buttonClick = function() {
					var pageNum = $(this).data("page");
					if (options.pageSelectedCallback) {
						options.pageSelectedCallback(pageNum)
					}
				};
			var maxButtonCount = options.maxButtonCount || 10;
			var zeroBasedIndex = pageIndex - 1;
			var firstPageIndex = zeroBasedIndex - (zeroBasedIndex % maxButtonCount) + 1;
			var lastPageIndex = firstPageIndex + maxButtonCount - 1;
			if (lastPageIndex > pageCount) {
				lastPageIndex = pageCount
			}
			var ul = $("<ul></ul>");
			if (EQ.client.useBootstrap) {
				ul.addClass("pagination")
			} else {
				ul.addClass("eqview-pagination")
			}
			if (options.cssClass) {
				ul.addClass(options.cssClass)
			}
			var li = $("<li></li>");
			var a = $("<span aria-hidden='true'>&laquo;</span>");
			if (firstPageIndex == 1) {
				li.addClass("disabled")
			} else {
				a = $("<a href='javascript:void(0)' data-page='" + (firstPageIndex - 1) + "'></a>").append(a);
				a.on("click", buttonClick)
			}
			li.append(a);
			ul.append(li);
			for (var i = firstPageIndex; i <= lastPageIndex; i++) {
				li = $("<li></li>");
				if (i == pageIndex) {
					li.addClass("active")
				}
				a = $("<a href='javascript:void(0)' data-page='" + i + "'>" + i + "</a>");
				a.on("click", buttonClick);
				li.append(a);
				ul.append(li)
			}
			li = $("<li></li>");
			a = $("<span aria-hidden='true'>&raquo;</span>");
			if (lastPageIndex == pageCount) {
				li.addClass("disabled")
			} else {
				a = $("<a href='javascript:void(0)' data-page='" + (lastPageIndex + 1) + "'></a>").append(a);
				a.on("click", buttonClick)
			}
			li.append(a);
			ul.append(li);
			return ul
		},
		_prepareForChart: function(dataTable) {
			if (!this.isGoogleChartDefined()) {
				return false
			}
			if (dataTable.getNumberOfColumns() < 2) {
				return false
			}
			var type1 = dataTable.getColumnType(0);
			if (type1 != "string") {
				return false
			}
			if (dataTable.getColumnType(1) != "number") {
				return false
			}
			return true
		},
		drawChart: function(dataTable, placeHolder, options) {
			if (this._prepareForChart(dataTable)) {
				options = options || {
					width: 300
				};
				var chart = new google.visualization.PieChart(placeHolder);
				chart.draw(dataTable, options)
			}
		}
	};
	EQ.view.EqDataTable.prototype = {
		getNumberOfColumns: function() {
			return this.table.cols.length
		},
		getColumnObject: function(colIndex) {
			return colIndex < this.table.cols.length ? this.table.cols[colIndex] : null
		},
		getColumnId: function(colIndex) {
			var col = this.getColumnObject(colIndex);
			return col ? col.id : null
		},
		getColumnLabel: function(colIndex) {
			var col = this.getColumnObject(colIndex);
			return col ? col.label : null
		},
		getColumnType: function(colIndex) {
			var col = this.getColumnObject(colIndex);
			return col ? col.type : null
		},
		getColumnProperties: function(colIndex) {
			var col = this.getColumnObject(colIndex);
			return col ? col.p : null
		},
		getNumberOfRows: function() {
			return this.table.rows.length
		},
		getFormattedValue: function(rowIndex, colIndex) {
			var row = rowIndex < this.table.rows.length ? this.table.rows[rowIndex] : null;
			if (row) {
				var cell = colIndex < this.table.cols.length ? row.c[colIndex] : null;
				if (cell) {
					if (typeof cell.f != "undefined") {
						return cell.f
					}
					var v = cell.v;
					if (typeof v != "undefined" && v !== null) {
						var colType = this.getColumnType(colIndex);
						if (colType == "date" || colType == "datetime") {
							dt = eval("new " + v);
							if (colType == "date") {
								v = dt.toLocaleDateString()
							} else {
								v = dt.toLocaleString()
							}
						} else {
							if (colType == "timeofday") {
								dt = new Date();
								dt.setHours(v[0], v[1], v[2], v[3]);
								v = dt.toLocaleTimeString()
							}
						}
					}
					return v
				}
			}
			return null
		}
	}
})(jQuery, window);